
  <!DOCTYPE html>
<html lang="en" data-accent-color="violet" data-content_root="../../../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>sentry_sdk.integrations.logging - sentry-python 1.39.2 documentation</title>
    <link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />

  <script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(sessionStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=aecf457f" />
    <link rel="stylesheet" type="text/css" href="../../../_static/shibuya.css?v=5d7d6ab7" />
    <link media="print" rel="stylesheet" type="text/css" href="../../../_static/print.css?v=20ff2c19" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="sentry_sdk.integrations.logging"/>
<meta name="twitter:card" content="summary"/></head>
<body><div class="document"><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand mr-4" href="../../../index.html">
      
      
      <strong>sentry-python</strong>
    </a>
    <div class="sy-head-links" id="NavLinks">
      <nav class="sy-head-nav"></nav>
      <div class="sy-head-extra flex items-center print:hidden">
<form class="searchbox flex items-center" action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form>
        
        
        <div class="sy-head-social flex items-center">
            <a class="flex items-center" href="https://github.com/getsentry/sentry-python" aria-label="GitHub">
              <i class="i-icon github"></i>
            </a>
        </div>
      </div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden">
      <button class="js-theme theme-switch flex items-center"
        data-aria-auto="Switch to light color mode"
        data-aria-light="Switch to dark color mode"
        data-aria-dark="Switch to auto color mode">
        <i class="i-icon theme-icon"></i>
      </button>
      <button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="NavLinks" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2 -translate-x-2"></span>
          <span class="hamburger_3 -translate-x-1"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">Top Level API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../integrations.html">Integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apidocs.html">API Docs</a></li>
</ul>

        </div>
      </div>
      
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-icon close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div>
    </div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
    <div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-icon menu"></i>
      </button>
    </div>
    <ul class="flex-1">
      
      
      <li><a href="../../../index.html">sentry-python</a><span>/</span></li>
      
      <li><a href="../../index.html">Module code</a><span>/</span></li>
      
      <li><strong>sentry_sdk.integrations.logging</strong></li>
      
      
    </ul>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-icon outdent"></i>
      </button>
    </div>
  </div>
</div>
    <div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <h1>Source code for sentry_sdk.integrations.logging</h1><div class="highlight"><pre>
<span></span><span id="1-1"><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>
</span><span id="1-2">
</span><span id="1-3"><span class="kn">import</span> <span class="nn">logging</span>
</span><span id="1-4"><span class="kn">from</span> <span class="nn">fnmatch</span> <span class="kn">import</span> <span class="n">fnmatch</span>
</span><span id="1-5">
</span><span id="1-6"><span class="kn">from</span> <span class="nn">sentry_sdk.hub</span> <span class="kn">import</span> <span class="n">Hub</span>
</span><span id="1-7"><span class="kn">from</span> <span class="nn">sentry_sdk.utils</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="1-8">    <span class="n">to_string</span><span class="p">,</span>
</span><span id="1-9">    <span class="n">event_from_exception</span><span class="p">,</span>
</span><span id="1-10">    <span class="n">current_stacktrace</span><span class="p">,</span>
</span><span id="1-11">    <span class="n">capture_internal_exceptions</span><span class="p">,</span>
</span><span id="1-12"><span class="p">)</span>
</span><span id="1-13"><span class="kn">from</span> <span class="nn">sentry_sdk.integrations</span> <span class="kn">import</span> <span class="n">Integration</span>
</span><span id="1-14"><span class="kn">from</span> <span class="nn">sentry_sdk._compat</span> <span class="kn">import</span> <span class="n">iteritems</span><span class="p">,</span> <span class="n">utc_from_timestamp</span>
</span><span id="1-15">
</span><span id="1-16"><span class="kn">from</span> <span class="nn">sentry_sdk._types</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span>
</span><span id="1-17">
</span><span id="1-18"><span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="1-19">    <span class="kn">from</span> <span class="nn">logging</span> <span class="kn">import</span> <span class="n">LogRecord</span>
</span><span id="1-20">    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>
</span><span id="1-21">    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span>
</span><span id="1-22">    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>
</span><span id="1-23">
</span><span id="1-24"><span class="n">DEFAULT_LEVEL</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
</span><span id="1-25"><span class="n">DEFAULT_EVENT_LEVEL</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span>
</span><span id="1-26"><span class="n">LOGGING_TO_EVENT_LEVEL</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="1-27">    <span class="n">logging</span><span class="o">.</span><span class="n">NOTSET</span><span class="p">:</span> <span class="s2">&quot;notset&quot;</span><span class="p">,</span>
</span><span id="1-28">    <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span>
</span><span id="1-29">    <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">:</span> <span class="s2">&quot;info&quot;</span><span class="p">,</span>
</span><span id="1-30">    <span class="n">logging</span><span class="o">.</span><span class="n">WARN</span><span class="p">:</span> <span class="s2">&quot;warning&quot;</span><span class="p">,</span>  <span class="c1"># WARN is same a WARNING</span>
</span><span id="1-31">    <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">:</span> <span class="s2">&quot;warning&quot;</span><span class="p">,</span>
</span><span id="1-32">    <span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
</span><span id="1-33">    <span class="n">logging</span><span class="o">.</span><span class="n">FATAL</span><span class="p">:</span> <span class="s2">&quot;fatal&quot;</span><span class="p">,</span>
</span><span id="1-34">    <span class="n">logging</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">:</span> <span class="s2">&quot;fatal&quot;</span><span class="p">,</span>  <span class="c1"># CRITICAL is same as FATAL</span>
</span><span id="1-35"><span class="p">}</span>
</span><span id="1-36">
</span><span id="1-37"><span class="c1"># Capturing events from those loggers causes recursion errors. We cannot allow</span>
</span><span id="1-38"><span class="c1"># the user to unconditionally create events from those loggers under any</span>
</span><span id="1-39"><span class="c1"># circumstances.</span>
</span><span id="1-40"><span class="c1">#</span>
</span><span id="1-41"><span class="c1"># Note: Ignoring by logger name here is better than mucking with thread-locals.</span>
</span><span id="1-42"><span class="c1"># We do not necessarily know whether thread-locals work 100% correctly in the user&#39;s environment.</span>
</span><span id="1-43"><span class="n">_IGNORED_LOGGERS</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
</span><span id="1-44">    <span class="p">[</span><span class="s2">&quot;sentry_sdk.errors&quot;</span><span class="p">,</span> <span class="s2">&quot;urllib3.connectionpool&quot;</span><span class="p">,</span> <span class="s2">&quot;urllib3.connection&quot;</span><span class="p">]</span>
</span><span id="1-45"><span class="p">)</span>
</span><span id="1-46">
</span><span id="1-47">
<div class="viewcode-block" id="ignore_logger">
<a class="viewcode-back" href="../../../integrations.html#sentry_sdk.integrations.logging.ignore_logger">[docs]</a>
</span><span id="1-48"><span class="k">def</span> <span class="nf">ignore_logger</span><span class="p">(</span>
</span><span id="1-49">    <span class="n">name</span><span class="p">,</span>  <span class="c1"># type: str</span>
</span><span id="1-50"><span class="p">):</span>
</span><span id="1-51">    <span class="c1"># type: (...) -&gt; None</span>
</span><span id="1-52"><span class="w">    </span><span class="sd">&quot;&quot;&quot;This disables recording (both in breadcrumbs and as events) calls to</span>
</span><span id="1-53"><span class="sd">    a logger of a specific name.  Among other uses, many of our integrations</span>
</span><span id="1-54"><span class="sd">    use this to prevent their actions being recorded as breadcrumbs. Exposed</span>
</span><span id="1-55"><span class="sd">    to users as a way to quiet spammy loggers.</span>
</span><span id="1-56">
</span><span id="1-57"><span class="sd">    :param name: The name of the logger to ignore (same string you would pass to ``logging.getLogger``).</span>
</span><span id="1-58"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-59">    <span class="n">_IGNORED_LOGGERS</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

</span><span id="1-60">
</span><span id="1-61">
</span><span id="1-62"><span class="k">class</span> <span class="nc">LoggingIntegration</span><span class="p">(</span><span class="n">Integration</span><span class="p">):</span>
</span><span id="1-63">    <span class="n">identifier</span> <span class="o">=</span> <span class="s2">&quot;logging&quot;</span>
</span><span id="1-64">
</span><span id="1-65">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">DEFAULT_LEVEL</span><span class="p">,</span> <span class="n">event_level</span><span class="o">=</span><span class="n">DEFAULT_EVENT_LEVEL</span><span class="p">):</span>
</span><span id="1-66">        <span class="c1"># type: (Optional[int], Optional[int]) -&gt; None</span>
</span><span id="1-67">        <span class="bp">self</span><span class="o">.</span><span class="n">_handler</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-68">        <span class="bp">self</span><span class="o">.</span><span class="n">_breadcrumb_handler</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-69">
</span><span id="1-70">        <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-71">            <span class="bp">self</span><span class="o">.</span><span class="n">_breadcrumb_handler</span> <span class="o">=</span> <span class="n">BreadcrumbHandler</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">)</span>
</span><span id="1-72">
</span><span id="1-73">        <span class="k">if</span> <span class="n">event_level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-74">            <span class="bp">self</span><span class="o">.</span><span class="n">_handler</span> <span class="o">=</span> <span class="n">EventHandler</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">event_level</span><span class="p">)</span>
</span><span id="1-75">
</span><span id="1-76">    <span class="k">def</span> <span class="nf">_handle_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
</span><span id="1-77">        <span class="c1"># type: (LogRecord) -&gt; None</span>
</span><span id="1-78">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">record</span><span class="o">.</span><span class="n">levelno</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handler</span><span class="o">.</span><span class="n">level</span><span class="p">:</span>
</span><span id="1-79">            <span class="bp">self</span><span class="o">.</span><span class="n">_handler</span><span class="o">.</span><span class="n">handle</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</span><span id="1-80">
</span><span id="1-81">        <span class="k">if</span> <span class="p">(</span>
</span><span id="1-82">            <span class="bp">self</span><span class="o">.</span><span class="n">_breadcrumb_handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="1-83">            <span class="ow">and</span> <span class="n">record</span><span class="o">.</span><span class="n">levelno</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_breadcrumb_handler</span><span class="o">.</span><span class="n">level</span>
</span><span id="1-84">        <span class="p">):</span>
</span><span id="1-85">            <span class="bp">self</span><span class="o">.</span><span class="n">_breadcrumb_handler</span><span class="o">.</span><span class="n">handle</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</span><span id="1-86">
</span><span id="1-87">    <span class="nd">@staticmethod</span>
</span><span id="1-88">    <span class="k">def</span> <span class="nf">setup_once</span><span class="p">():</span>
</span><span id="1-89">        <span class="c1"># type: () -&gt; None</span>
</span><span id="1-90">        <span class="n">old_callhandlers</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="o">.</span><span class="n">callHandlers</span>
</span><span id="1-91">
</span><span id="1-92">        <span class="k">def</span> <span class="nf">sentry_patched_callhandlers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
</span><span id="1-93">            <span class="c1"># type: (Any, LogRecord) -&gt; Any</span>
</span><span id="1-94">            <span class="c1"># keeping a local reference because the</span>
</span><span id="1-95">            <span class="c1"># global might be discarded on shutdown</span>
</span><span id="1-96">            <span class="n">ignored_loggers</span> <span class="o">=</span> <span class="n">_IGNORED_LOGGERS</span>
</span><span id="1-97">
</span><span id="1-98">            <span class="k">try</span><span class="p">:</span>
</span><span id="1-99">                <span class="k">return</span> <span class="n">old_callhandlers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">)</span>
</span><span id="1-100">            <span class="k">finally</span><span class="p">:</span>
</span><span id="1-101">                <span class="c1"># This check is done twice, once also here before we even get</span>
</span><span id="1-102">                <span class="c1"># the integration.  Otherwise we have a high chance of getting</span>
</span><span id="1-103">                <span class="c1"># into a recursion error when the integration is resolved</span>
</span><span id="1-104">                <span class="c1"># (this also is slower).</span>
</span><span id="1-105">                <span class="k">if</span> <span class="n">ignored_loggers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">record</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignored_loggers</span><span class="p">:</span>
</span><span id="1-106">                    <span class="n">integration</span> <span class="o">=</span> <span class="n">Hub</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">get_integration</span><span class="p">(</span><span class="n">LoggingIntegration</span><span class="p">)</span>
</span><span id="1-107">                    <span class="k">if</span> <span class="n">integration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-108">                        <span class="n">integration</span><span class="o">.</span><span class="n">_handle_record</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</span><span id="1-109">
</span><span id="1-110">        <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="o">.</span><span class="n">callHandlers</span> <span class="o">=</span> <span class="n">sentry_patched_callhandlers</span>  <span class="c1"># type: ignore</span>
</span><span id="1-111">
</span><span id="1-112">
</span><span id="1-113"><span class="k">class</span> <span class="nc">_BaseHandler</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Handler</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
</span><span id="1-114">    <span class="n">COMMON_RECORD_ATTRS</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span>
</span><span id="1-115">        <span class="p">(</span>
</span><span id="1-116">            <span class="s2">&quot;args&quot;</span><span class="p">,</span>
</span><span id="1-117">            <span class="s2">&quot;created&quot;</span><span class="p">,</span>
</span><span id="1-118">            <span class="s2">&quot;exc_info&quot;</span><span class="p">,</span>
</span><span id="1-119">            <span class="s2">&quot;exc_text&quot;</span><span class="p">,</span>
</span><span id="1-120">            <span class="s2">&quot;filename&quot;</span><span class="p">,</span>
</span><span id="1-121">            <span class="s2">&quot;funcName&quot;</span><span class="p">,</span>
</span><span id="1-122">            <span class="s2">&quot;levelname&quot;</span><span class="p">,</span>
</span><span id="1-123">            <span class="s2">&quot;levelno&quot;</span><span class="p">,</span>
</span><span id="1-124">            <span class="s2">&quot;linenno&quot;</span><span class="p">,</span>
</span><span id="1-125">            <span class="s2">&quot;lineno&quot;</span><span class="p">,</span>
</span><span id="1-126">            <span class="s2">&quot;message&quot;</span><span class="p">,</span>
</span><span id="1-127">            <span class="s2">&quot;module&quot;</span><span class="p">,</span>
</span><span id="1-128">            <span class="s2">&quot;msecs&quot;</span><span class="p">,</span>
</span><span id="1-129">            <span class="s2">&quot;msg&quot;</span><span class="p">,</span>
</span><span id="1-130">            <span class="s2">&quot;name&quot;</span><span class="p">,</span>
</span><span id="1-131">            <span class="s2">&quot;pathname&quot;</span><span class="p">,</span>
</span><span id="1-132">            <span class="s2">&quot;process&quot;</span><span class="p">,</span>
</span><span id="1-133">            <span class="s2">&quot;processName&quot;</span><span class="p">,</span>
</span><span id="1-134">            <span class="s2">&quot;relativeCreated&quot;</span><span class="p">,</span>
</span><span id="1-135">            <span class="s2">&quot;stack&quot;</span><span class="p">,</span>
</span><span id="1-136">            <span class="s2">&quot;tags&quot;</span><span class="p">,</span>
</span><span id="1-137">            <span class="s2">&quot;taskName&quot;</span><span class="p">,</span>
</span><span id="1-138">            <span class="s2">&quot;thread&quot;</span><span class="p">,</span>
</span><span id="1-139">            <span class="s2">&quot;threadName&quot;</span><span class="p">,</span>
</span><span id="1-140">            <span class="s2">&quot;stack_info&quot;</span><span class="p">,</span>
</span><span id="1-141">        <span class="p">)</span>
</span><span id="1-142">    <span class="p">)</span>
</span><span id="1-143">
</span><span id="1-144">    <span class="k">def</span> <span class="nf">_can_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
</span><span id="1-145">        <span class="c1"># type: (LogRecord) -&gt; bool</span>
</span><span id="1-146"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Prevents ignored loggers from recording&quot;&quot;&quot;</span>
</span><span id="1-147">        <span class="k">for</span> <span class="n">logger</span> <span class="ow">in</span> <span class="n">_IGNORED_LOGGERS</span><span class="p">:</span>
</span><span id="1-148">            <span class="k">if</span> <span class="n">fnmatch</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
</span><span id="1-149">                <span class="k">return</span> <span class="kc">False</span>
</span><span id="1-150">        <span class="k">return</span> <span class="kc">True</span>
</span><span id="1-151">
</span><span id="1-152">    <span class="k">def</span> <span class="nf">_logging_to_event_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
</span><span id="1-153">        <span class="c1"># type: (LogRecord) -&gt; str</span>
</span><span id="1-154">        <span class="k">return</span> <span class="n">LOGGING_TO_EVENT_LEVEL</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="1-155">            <span class="n">record</span><span class="o">.</span><span class="n">levelno</span><span class="p">,</span> <span class="n">record</span><span class="o">.</span><span class="n">levelname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">levelname</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="1-156">        <span class="p">)</span>
</span><span id="1-157">
</span><span id="1-158">    <span class="k">def</span> <span class="nf">_extra_from_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
</span><span id="1-159">        <span class="c1"># type: (LogRecord) -&gt; Dict[str, None]</span>
</span><span id="1-160">        <span class="k">return</span> <span class="p">{</span>
</span><span id="1-161">            <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
</span><span id="1-162">            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="n">record</span><span class="p">))</span>
</span><span id="1-163">            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">COMMON_RECORD_ATTRS</span>
</span><span id="1-164">            <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">))</span>
</span><span id="1-165">        <span class="p">}</span>
</span><span id="1-166">
</span><span id="1-167">
<div class="viewcode-block" id="EventHandler">
<a class="viewcode-back" href="../../../integrations.html#sentry_sdk.integrations.logging.EventHandler">[docs]</a>
</span><span id="1-168"><span class="k">class</span> <span class="nc">EventHandler</span><span class="p">(</span><span class="n">_BaseHandler</span><span class="p">):</span>
</span><span id="1-169"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-170"><span class="sd">    A logging handler that emits Sentry events for each log record</span>
</span><span id="1-171">
</span><span id="1-172"><span class="sd">    Note that you do not have to use this class if the logging integration is enabled, which it is by default.</span>
</span><span id="1-173"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-174">
</span><span id="1-175">    <span class="k">def</span> <span class="nf">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
</span><span id="1-176">        <span class="c1"># type: (LogRecord) -&gt; Any</span>
</span><span id="1-177">        <span class="k">with</span> <span class="n">capture_internal_exceptions</span><span class="p">():</span>
</span><span id="1-178">            <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</span><span id="1-179">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emit</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</span><span id="1-180">
</span><span id="1-181">    <span class="k">def</span> <span class="nf">_emit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
</span><span id="1-182">        <span class="c1"># type: (LogRecord) -&gt; None</span>
</span><span id="1-183">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_can_record</span><span class="p">(</span><span class="n">record</span><span class="p">):</span>
</span><span id="1-184">            <span class="k">return</span>
</span><span id="1-185">
</span><span id="1-186">        <span class="n">hub</span> <span class="o">=</span> <span class="n">Hub</span><span class="o">.</span><span class="n">current</span>
</span><span id="1-187">        <span class="k">if</span> <span class="n">hub</span><span class="o">.</span><span class="n">client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-188">            <span class="k">return</span>
</span><span id="1-189">
</span><span id="1-190">        <span class="n">client_options</span> <span class="o">=</span> <span class="n">hub</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">options</span>
</span><span id="1-191">
</span><span id="1-192">        <span class="c1"># exc_info might be None or (None, None, None)</span>
</span><span id="1-193">        <span class="c1">#</span>
</span><span id="1-194">        <span class="c1"># exc_info may also be any falsy value due to Python stdlib being</span>
</span><span id="1-195">        <span class="c1"># liberal with what it receives and Celery&#39;s billiard being &quot;liberal&quot;</span>
</span><span id="1-196">        <span class="c1"># with what it sends. See</span>
</span><span id="1-197">        <span class="c1"># https://github.com/getsentry/sentry-python/issues/904</span>
</span><span id="1-198">        <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">exc_info</span> <span class="ow">and</span> <span class="n">record</span><span class="o">.</span><span class="n">exc_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-199">            <span class="n">event</span><span class="p">,</span> <span class="n">hint</span> <span class="o">=</span> <span class="n">event_from_exception</span><span class="p">(</span>
</span><span id="1-200">                <span class="n">record</span><span class="o">.</span><span class="n">exc_info</span><span class="p">,</span>
</span><span id="1-201">                <span class="n">client_options</span><span class="o">=</span><span class="n">client_options</span><span class="p">,</span>
</span><span id="1-202">                <span class="n">mechanism</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;logging&quot;</span><span class="p">,</span> <span class="s2">&quot;handled&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span><span id="1-203">            <span class="p">)</span>
</span><span id="1-204">        <span class="k">elif</span> <span class="n">record</span><span class="o">.</span><span class="n">exc_info</span> <span class="ow">and</span> <span class="n">record</span><span class="o">.</span><span class="n">exc_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-205">            <span class="n">event</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="1-206">            <span class="n">hint</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="1-207">            <span class="k">with</span> <span class="n">capture_internal_exceptions</span><span class="p">():</span>
</span><span id="1-208">                <span class="n">event</span><span class="p">[</span><span class="s2">&quot;threads&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="1-209">                    <span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="1-210">                        <span class="p">{</span>
</span><span id="1-211">                            <span class="s2">&quot;stacktrace&quot;</span><span class="p">:</span> <span class="n">current_stacktrace</span><span class="p">(</span>
</span><span id="1-212">                                <span class="n">include_local_variables</span><span class="o">=</span><span class="n">client_options</span><span class="p">[</span>
</span><span id="1-213">                                    <span class="s2">&quot;include_local_variables&quot;</span>
</span><span id="1-214">                                <span class="p">],</span>
</span><span id="1-215">                                <span class="n">max_value_length</span><span class="o">=</span><span class="n">client_options</span><span class="p">[</span><span class="s2">&quot;max_value_length&quot;</span><span class="p">],</span>
</span><span id="1-216">                            <span class="p">),</span>
</span><span id="1-217">                            <span class="s2">&quot;crashed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="1-218">                            <span class="s2">&quot;current&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="1-219">                        <span class="p">}</span>
</span><span id="1-220">                    <span class="p">]</span>
</span><span id="1-221">                <span class="p">}</span>
</span><span id="1-222">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-223">            <span class="n">event</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="1-224">            <span class="n">hint</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="1-225">
</span><span id="1-226">        <span class="n">hint</span><span class="p">[</span><span class="s2">&quot;log_record&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">record</span>
</span><span id="1-227">
</span><span id="1-228">        <span class="n">event</span><span class="p">[</span><span class="s2">&quot;level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logging_to_event_level</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</span><span id="1-229">        <span class="n">event</span><span class="p">[</span><span class="s2">&quot;logger&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">name</span>
</span><span id="1-230">
</span><span id="1-231">        <span class="c1"># Log records from `warnings` module as separate issues</span>
</span><span id="1-232">        <span class="n">record_caputured_from_warnings_module</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-233">            <span class="n">record</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;py.warnings&quot;</span> <span class="ow">and</span> <span class="n">record</span><span class="o">.</span><span class="n">msg</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span>
</span><span id="1-234">        <span class="p">)</span>
</span><span id="1-235">        <span class="k">if</span> <span class="n">record_caputured_from_warnings_module</span><span class="p">:</span>
</span><span id="1-236">            <span class="c1"># use the actual message and not &quot;%s&quot; as the message</span>
</span><span id="1-237">            <span class="c1"># this prevents grouping all warnings under one &quot;%s&quot; issue</span>
</span><span id="1-238">            <span class="n">msg</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
</span><span id="1-239">
</span><span id="1-240">            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;logentry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="1-241">                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span>
</span><span id="1-242">                <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">(),</span>
</span><span id="1-243">            <span class="p">}</span>
</span><span id="1-244">
</span><span id="1-245">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-246">            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;logentry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="1-247">                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">to_string</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">msg</span><span class="p">),</span>
</span><span id="1-248">                <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">args</span><span class="p">,</span>
</span><span id="1-249">            <span class="p">}</span>
</span><span id="1-250">
</span><span id="1-251">        <span class="n">event</span><span class="p">[</span><span class="s2">&quot;extra&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extra_from_record</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</span><span id="1-252">
</span><span id="1-253">        <span class="n">hub</span><span class="o">.</span><span class="n">capture_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="n">hint</span><span class="p">)</span></div>

</span><span id="1-254">
</span><span id="1-255">
</span><span id="1-256"><span class="c1"># Legacy name</span>
</span><span id="1-257"><span class="n">SentryHandler</span> <span class="o">=</span> <span class="n">EventHandler</span>
</span><span id="1-258">
</span><span id="1-259">
<div class="viewcode-block" id="BreadcrumbHandler">
<a class="viewcode-back" href="../../../integrations.html#sentry_sdk.integrations.logging.BreadcrumbHandler">[docs]</a>
</span><span id="1-260"><span class="k">class</span> <span class="nc">BreadcrumbHandler</span><span class="p">(</span><span class="n">_BaseHandler</span><span class="p">):</span>
</span><span id="1-261"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-262"><span class="sd">    A logging handler that records breadcrumbs for each log record.</span>
</span><span id="1-263">
</span><span id="1-264"><span class="sd">    Note that you do not have to use this class if the logging integration is enabled, which it is by default.</span>
</span><span id="1-265"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-266">
</span><span id="1-267">    <span class="k">def</span> <span class="nf">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
</span><span id="1-268">        <span class="c1"># type: (LogRecord) -&gt; Any</span>
</span><span id="1-269">        <span class="k">with</span> <span class="n">capture_internal_exceptions</span><span class="p">():</span>
</span><span id="1-270">            <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</span><span id="1-271">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emit</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
</span><span id="1-272">
</span><span id="1-273">    <span class="k">def</span> <span class="nf">_emit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
</span><span id="1-274">        <span class="c1"># type: (LogRecord) -&gt; None</span>
</span><span id="1-275">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_can_record</span><span class="p">(</span><span class="n">record</span><span class="p">):</span>
</span><span id="1-276">            <span class="k">return</span>
</span><span id="1-277">
</span><span id="1-278">        <span class="n">Hub</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">add_breadcrumb</span><span class="p">(</span>
</span><span id="1-279">            <span class="bp">self</span><span class="o">.</span><span class="n">_breadcrumb_from_record</span><span class="p">(</span><span class="n">record</span><span class="p">),</span> <span class="n">hint</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;log_record&quot;</span><span class="p">:</span> <span class="n">record</span><span class="p">}</span>
</span><span id="1-280">        <span class="p">)</span>
</span><span id="1-281">
</span><span id="1-282">    <span class="k">def</span> <span class="nf">_breadcrumb_from_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
</span><span id="1-283">        <span class="c1"># type: (LogRecord) -&gt; Dict[str, Any]</span>
</span><span id="1-284">        <span class="k">return</span> <span class="p">{</span>
</span><span id="1-285">            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;log&quot;</span><span class="p">,</span>
</span><span id="1-286">            <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logging_to_event_level</span><span class="p">(</span><span class="n">record</span><span class="p">),</span>
</span><span id="1-287">            <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="1-288">            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
</span><span id="1-289">            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">utc_from_timestamp</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">created</span><span class="p">),</span>
</span><span id="1-290">            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extra_from_record</span><span class="p">(</span><span class="n">record</span><span class="p">),</span>
</span><span id="1-291">        <span class="p">}</span></div>

</span></pre></div>
        </article>
        
        <div class="navigation flex print:hidden">
  
  
</div>
        
      </div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2019-2024, Sentry Team and Contributors</p>
        
        <p>
          Made with
          
          <a href="https://www.sphinx-doc.org/">Sphinx</a> and
          
          <a href="https://shibuya.lepture.com">Shibuya theme</a>.
        </p>
      </div>
      <div class="sy-foot-socials">
          <a href="https://github.com/getsentry/sentry-python" aria-label="GitHub"><i class="i-icon github"></i></a>
      </div>
    </div>
  </div>
</footer></div>
      <script src="../../../_static/documentation_options.js?v=e2b5d38d"></script>
      <script src="../../../_static/doctools.js?v=888ff710"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/shibuya.js?v=ccb09f80"></script>
    
</body>
</html>