
  <!DOCTYPE html>
<html lang="en" data-accent-color="violet" data-content_root="../../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>sentry_sdk.scope - sentry-python 2.0.0rc4 documentation</title>
    <link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

  <script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(sessionStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=aecf457f" />
    <link rel="stylesheet" type="text/css" href="../../_static/shibuya.css?v=d42a0c83" />
    <link media="print" rel="stylesheet" type="text/css" href="../../_static/print.css?v=20ff2c19" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="sentry_sdk.scope"/>
<meta name="twitter:card" content="summary"/>
  </head>
<body><div class="document"><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand mr-4" href="../../index.html">
      
      
      <strong>sentry-python</strong>
    </a>
    <div class="sy-head-links" id="NavLinks">
      <nav class="sy-head-nav"></nav>
      <div class="sy-head-extra flex items-center print:hidden">
<form class="searchbox flex items-center" action="../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form>
        
        
        <div class="sy-head-social flex items-center">
            <a class="flex items-center" href="https://github.com/getsentry/sentry-python" aria-label="GitHub">
              <i class="i-icon github"></i>
            </a>
        </div>
      </div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden">
      <button class="js-theme theme-switch flex items-center"
        data-aria-auto="Switch to light color mode"
        data-aria-light="Switch to dark color mode"
        data-aria-dark="Switch to auto color mode">
        <i class="i-icon theme-icon"></i>
      </button>
      <button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="NavLinks" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2 -translate-x-2"></span>
          <span class="hamburger_3 -translate-x-1"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">Top Level API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../integrations.html">Integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../apidocs.html">API Docs</a></li>
</ul>

        </div>
      </div>
      
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-icon close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div>
    </div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
    <div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-icon menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList">
      
      
      <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../../index.html"><span itemprop="name">sentry-python</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li>
      
      <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">Module code</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li>
      
      <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">sentry_sdk.scope</strong>
        <meta itemprop="position" content="3" />
      </li>
      
      
    </ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-icon outdent"></i>
      </button>
    </div>
  </div>
</div>
    <div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <h1>Source code for sentry_sdk.scope</h1><div class="highlight"><pre>
<span></span><span id="1-1"><span class="kn">import</span> <span class="nn">os</span>
</span><span id="1-2"><span class="kn">import</span> <span class="nn">sys</span>
</span><span id="1-3"><span class="kn">import</span> <span class="nn">uuid</span>
</span><span id="1-4"><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
</span><span id="1-5"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>
</span><span id="1-6"><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
</span><span id="1-7"><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
</span><span id="1-8"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
</span><span id="1-9"><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
</span><span id="1-10"><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
</span><span id="1-11">
</span><span id="1-12"><span class="kn">from</span> <span class="nn">sentry_sdk.attachments</span> <span class="kn">import</span> <span class="n">Attachment</span>
</span><span id="1-13"><span class="kn">from</span> <span class="nn">sentry_sdk.consts</span> <span class="kn">import</span> <span class="n">DEFAULT_MAX_BREADCRUMBS</span><span class="p">,</span> <span class="n">FALSE_VALUES</span><span class="p">,</span> <span class="n">INSTRUMENTER</span>
</span><span id="1-14"><span class="kn">from</span> <span class="nn">sentry_sdk.profiler</span> <span class="kn">import</span> <span class="n">Profile</span>
</span><span id="1-15"><span class="kn">from</span> <span class="nn">sentry_sdk.session</span> <span class="kn">import</span> <span class="n">Session</span>
</span><span id="1-16"><span class="kn">from</span> <span class="nn">sentry_sdk.tracing_utils</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="1-17">    <span class="n">Baggage</span><span class="p">,</span>
</span><span id="1-18">    <span class="n">extract_sentrytrace_data</span><span class="p">,</span>
</span><span id="1-19">    <span class="n">has_tracing_enabled</span><span class="p">,</span>
</span><span id="1-20">    <span class="n">normalize_incoming_data</span><span class="p">,</span>
</span><span id="1-21"><span class="p">)</span>
</span><span id="1-22"><span class="kn">from</span> <span class="nn">sentry_sdk.tracing</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="1-23">    <span class="n">BAGGAGE_HEADER_NAME</span><span class="p">,</span>
</span><span id="1-24">    <span class="n">SENTRY_TRACE_HEADER_NAME</span><span class="p">,</span>
</span><span id="1-25">    <span class="n">NoOpSpan</span><span class="p">,</span>
</span><span id="1-26">    <span class="n">Span</span><span class="p">,</span>
</span><span id="1-27">    <span class="n">Transaction</span><span class="p">,</span>
</span><span id="1-28"><span class="p">)</span>
</span><span id="1-29"><span class="kn">from</span> <span class="nn">sentry_sdk._types</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span>
</span><span id="1-30"><span class="kn">from</span> <span class="nn">sentry_sdk.utils</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="1-31">    <span class="n">capture_internal_exceptions</span><span class="p">,</span>
</span><span id="1-32">    <span class="n">ContextVar</span><span class="p">,</span>
</span><span id="1-33">    <span class="n">event_from_exception</span><span class="p">,</span>
</span><span id="1-34">    <span class="n">exc_info_from_error</span><span class="p">,</span>
</span><span id="1-35">    <span class="n">logger</span><span class="p">,</span>
</span><span id="1-36"><span class="p">)</span>
</span><span id="1-37">
</span><span id="1-38"><span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="1-39">    <span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableMapping</span>
</span><span id="1-40">
</span><span id="1-41">    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>
</span><span id="1-42">    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span>
</span><span id="1-43">    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Deque</span>
</span><span id="1-44">    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span>
</span><span id="1-45">    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Generator</span>
</span><span id="1-46">    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterator</span>
</span><span id="1-47">    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
</span><span id="1-48">    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>
</span><span id="1-49">    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">ParamSpec</span>
</span><span id="1-50">    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>
</span><span id="1-51">    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span>
</span><span id="1-52">    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>
</span><span id="1-53">
</span><span id="1-54">    <span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Unpack</span>
</span><span id="1-55">
</span><span id="1-56">    <span class="kn">from</span> <span class="nn">sentry_sdk._types</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="1-57">        <span class="n">Breadcrumb</span><span class="p">,</span>
</span><span id="1-58">        <span class="n">BreadcrumbHint</span><span class="p">,</span>
</span><span id="1-59">        <span class="n">ErrorProcessor</span><span class="p">,</span>
</span><span id="1-60">        <span class="n">Event</span><span class="p">,</span>
</span><span id="1-61">        <span class="n">EventProcessor</span><span class="p">,</span>
</span><span id="1-62">        <span class="n">ExcInfo</span><span class="p">,</span>
</span><span id="1-63">        <span class="n">Hint</span><span class="p">,</span>
</span><span id="1-64">        <span class="n">LogLevelStr</span><span class="p">,</span>
</span><span id="1-65">        <span class="n">SamplingContext</span><span class="p">,</span>
</span><span id="1-66">        <span class="n">Type</span><span class="p">,</span>
</span><span id="1-67">    <span class="p">)</span>
</span><span id="1-68">
</span><span id="1-69">    <span class="kn">from</span> <span class="nn">sentry_sdk.tracing</span> <span class="kn">import</span> <span class="n">TransactionKwargs</span>
</span><span id="1-70">
</span><span id="1-71">    <span class="kn">import</span> <span class="nn">sentry_sdk</span>
</span><span id="1-72">
</span><span id="1-73">    <span class="n">P</span> <span class="o">=</span> <span class="n">ParamSpec</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">)</span>
</span><span id="1-74">    <span class="n">R</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">)</span>
</span><span id="1-75">
</span><span id="1-76">    <span class="n">F</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span>
</span><span id="1-77">    <span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
</span><span id="1-78">
</span><span id="1-79">
</span><span id="1-80"><span class="c1"># Holds data that will be added to **all** events sent by this process.</span>
</span><span id="1-81"><span class="c1"># In case this is a http server (think web framework) with multiple users</span>
</span><span id="1-82"><span class="c1"># the data will be added to events of all users.</span>
</span><span id="1-83"><span class="c1"># Typically this is used for process wide data such as the release.</span>
</span><span id="1-84"><span class="n">_global_scope</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[Scope]</span>
</span><span id="1-85">
</span><span id="1-86"><span class="c1"># Holds data for the active request.</span>
</span><span id="1-87"><span class="c1"># This is used to isolate data for different requests or users.</span>
</span><span id="1-88"><span class="c1"># The isolation scope is usually created by integrations, but may also</span>
</span><span id="1-89"><span class="c1"># be created manually</span>
</span><span id="1-90"><span class="n">_isolation_scope</span> <span class="o">=</span> <span class="n">ContextVar</span><span class="p">(</span><span class="s2">&quot;isolation_scope&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="1-91">
</span><span id="1-92"><span class="c1"># Holds data for the active span.</span>
</span><span id="1-93"><span class="c1"># This can be used to manually add additional data to a span.</span>
</span><span id="1-94"><span class="n">_current_scope</span> <span class="o">=</span> <span class="n">ContextVar</span><span class="p">(</span><span class="s2">&quot;current_scope&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="1-95">
</span><span id="1-96"><span class="n">global_event_processors</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[EventProcessor]</span>
</span><span id="1-97">
</span><span id="1-98">
</span><span id="1-99"><span class="k">class</span> <span class="nc">ScopeType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="1-100">    <span class="n">CURRENT</span> <span class="o">=</span> <span class="s2">&quot;current&quot;</span>
</span><span id="1-101">    <span class="n">ISOLATION</span> <span class="o">=</span> <span class="s2">&quot;isolation&quot;</span>
</span><span id="1-102">    <span class="n">GLOBAL</span> <span class="o">=</span> <span class="s2">&quot;global&quot;</span>
</span><span id="1-103">    <span class="n">MERGED</span> <span class="o">=</span> <span class="s2">&quot;merged&quot;</span>
</span><span id="1-104">
</span><span id="1-105">
</span><span id="1-106"><span class="k">class</span> <span class="nc">_ScopeManager</span><span class="p">:</span>
</span><span id="1-107">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hub</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="1-108">        <span class="c1"># type: (Optional[Any]) -&gt; None</span>
</span><span id="1-109">        <span class="bp">self</span><span class="o">.</span><span class="n">_old_scopes</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[Scope]</span>
</span><span id="1-110">
</span><span id="1-111">    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-112">        <span class="c1"># type: () -&gt; Scope</span>
</span><span id="1-113">        <span class="n">isolation_scope</span> <span class="o">=</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_isolation_scope</span><span class="p">()</span>
</span><span id="1-114">
</span><span id="1-115">        <span class="bp">self</span><span class="o">.</span><span class="n">_old_scopes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">isolation_scope</span><span class="p">)</span>
</span><span id="1-116">
</span><span id="1-117">        <span class="n">forked_scope</span> <span class="o">=</span> <span class="n">isolation_scope</span><span class="o">.</span><span class="n">fork</span><span class="p">()</span>
</span><span id="1-118">        <span class="n">_isolation_scope</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">forked_scope</span><span class="p">)</span>
</span><span id="1-119">
</span><span id="1-120">        <span class="k">return</span> <span class="n">forked_scope</span>
</span><span id="1-121">
</span><span id="1-122">    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">tb</span><span class="p">):</span>
</span><span id="1-123">        <span class="c1"># type: (Any, Any, Any) -&gt; None</span>
</span><span id="1-124">        <span class="n">old_scope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_old_scopes</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</span><span id="1-125">        <span class="n">_isolation_scope</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">old_scope</span><span class="p">)</span>
</span><span id="1-126">
</span><span id="1-127">
</span><span id="1-128"><span class="k">def</span> <span class="nf">add_global_event_processor</span><span class="p">(</span><span class="n">processor</span><span class="p">):</span>
</span><span id="1-129">    <span class="c1"># type: (EventProcessor) -&gt; None</span>
</span><span id="1-130">    <span class="n">global_event_processors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processor</span><span class="p">)</span>
</span><span id="1-131">
</span><span id="1-132">
</span><span id="1-133"><span class="k">def</span> <span class="nf">_attr_setter</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
</span><span id="1-134">    <span class="c1"># type: (Any) -&gt; Any</span>
</span><span id="1-135">    <span class="k">return</span> <span class="nb">property</span><span class="p">(</span><span class="n">fset</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="n">fn</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</span><span id="1-136">
</span><span id="1-137">
</span><span id="1-138"><span class="k">def</span> <span class="nf">_disable_capture</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
</span><span id="1-139">    <span class="c1"># type: (F) -&gt; F</span>
</span><span id="1-140">    <span class="nd">@wraps</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="1-141">    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="1-142">        <span class="c1"># type: (Any, *Dict[str, Any], **Any) -&gt; Any</span>
</span><span id="1-143">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_capture</span><span class="p">:</span>
</span><span id="1-144">            <span class="k">return</span>
</span><span id="1-145">        <span class="k">try</span><span class="p">:</span>
</span><span id="1-146">            <span class="bp">self</span><span class="o">.</span><span class="n">_should_capture</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-147">            <span class="k">return</span> <span class="n">fn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="1-148">        <span class="k">finally</span><span class="p">:</span>
</span><span id="1-149">            <span class="bp">self</span><span class="o">.</span><span class="n">_should_capture</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-150">
</span><span id="1-151">    <span class="k">return</span> <span class="n">wrapper</span>  <span class="c1"># type: ignore</span>
</span><span id="1-152">
</span><span id="1-153">
<div class="viewcode-block" id="Scope">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope">[docs]</a>
</span><span id="1-154"><span class="k">class</span> <span class="nc">Scope</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="1-155"><span class="w">    </span><span class="sd">&quot;&quot;&quot;The scope holds extra information that should be sent with all</span>
</span><span id="1-156"><span class="sd">    events that belong to it.</span>
</span><span id="1-157"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-158">
</span><span id="1-159">    <span class="c1"># NOTE: Even though it should not happen, the scope needs to not crash when</span>
</span><span id="1-160">    <span class="c1"># accessed by multiple threads. It&#39;s fine if it&#39;s full of races, but those</span>
</span><span id="1-161">    <span class="c1"># races should never make the user application crash.</span>
</span><span id="1-162">    <span class="c1">#</span>
</span><span id="1-163">    <span class="c1"># The same needs to hold for any accesses of the scope the SDK makes.</span>
</span><span id="1-164">
</span><span id="1-165">    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-166">        <span class="s2">&quot;_level&quot;</span><span class="p">,</span>
</span><span id="1-167">        <span class="s2">&quot;_name&quot;</span><span class="p">,</span>
</span><span id="1-168">        <span class="s2">&quot;_fingerprint&quot;</span><span class="p">,</span>
</span><span id="1-169">        <span class="c1"># note that for legacy reasons, _transaction is the transaction *name*,</span>
</span><span id="1-170">        <span class="c1"># not a Transaction object (the object is stored in _span)</span>
</span><span id="1-171">        <span class="s2">&quot;_transaction&quot;</span><span class="p">,</span>
</span><span id="1-172">        <span class="s2">&quot;_transaction_info&quot;</span><span class="p">,</span>
</span><span id="1-173">        <span class="s2">&quot;_user&quot;</span><span class="p">,</span>
</span><span id="1-174">        <span class="s2">&quot;_tags&quot;</span><span class="p">,</span>
</span><span id="1-175">        <span class="s2">&quot;_contexts&quot;</span><span class="p">,</span>
</span><span id="1-176">        <span class="s2">&quot;_extras&quot;</span><span class="p">,</span>
</span><span id="1-177">        <span class="s2">&quot;_breadcrumbs&quot;</span><span class="p">,</span>
</span><span id="1-178">        <span class="s2">&quot;_event_processors&quot;</span><span class="p">,</span>
</span><span id="1-179">        <span class="s2">&quot;_error_processors&quot;</span><span class="p">,</span>
</span><span id="1-180">        <span class="s2">&quot;_should_capture&quot;</span><span class="p">,</span>
</span><span id="1-181">        <span class="s2">&quot;_span&quot;</span><span class="p">,</span>
</span><span id="1-182">        <span class="s2">&quot;_session&quot;</span><span class="p">,</span>
</span><span id="1-183">        <span class="s2">&quot;_attachments&quot;</span><span class="p">,</span>
</span><span id="1-184">        <span class="s2">&quot;_force_auto_session_tracking&quot;</span><span class="p">,</span>
</span><span id="1-185">        <span class="s2">&quot;_profile&quot;</span><span class="p">,</span>
</span><span id="1-186">        <span class="s2">&quot;_propagation_context&quot;</span><span class="p">,</span>
</span><span id="1-187">        <span class="s2">&quot;client&quot;</span><span class="p">,</span>
</span><span id="1-188">        <span class="s2">&quot;_type&quot;</span><span class="p">,</span>
</span><span id="1-189">    <span class="p">)</span>
</span><span id="1-190">
</span><span id="1-191">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ty</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="1-192">        <span class="c1"># type: (Optional[ScopeType], Optional[sentry_sdk.Client]) -&gt; None</span>
</span><span id="1-193">        <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="n">ty</span>
</span><span id="1-194">
</span><span id="1-195">        <span class="bp">self</span><span class="o">.</span><span class="n">_event_processors</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[EventProcessor]</span>
</span><span id="1-196">        <span class="bp">self</span><span class="o">.</span><span class="n">_error_processors</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[ErrorProcessor]</span>
</span><span id="1-197">
</span><span id="1-198">        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[str]</span>
</span><span id="1-199">        <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[Dict[str, Any]]</span>
</span><span id="1-200">
</span><span id="1-201">        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">NonRecordingClient</span><span class="p">()</span>  <span class="c1"># type: sentry_sdk.client.BaseClient</span>
</span><span id="1-202">
</span><span id="1-203">        <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-204">            <span class="bp">self</span><span class="o">.</span><span class="n">set_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
</span><span id="1-205">
</span><span id="1-206">        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="1-207">
</span><span id="1-208">        <span class="n">incoming_trace_information</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_trace_data_from_env</span><span class="p">()</span>
</span><span id="1-209">        <span class="bp">self</span><span class="o">.</span><span class="n">generate_propagation_context</span><span class="p">(</span><span class="n">incoming_data</span><span class="o">=</span><span class="n">incoming_trace_information</span><span class="p">)</span>
</span><span id="1-210">
</span><span id="1-211">    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-212">        <span class="c1"># type: () -&gt; Scope</span>
</span><span id="1-213"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-214"><span class="sd">        Returns a copy of this scope.</span>
</span><span id="1-215"><span class="sd">        This also creates a copy of all referenced data structures.</span>
</span><span id="1-216"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-217">        <span class="n">rv</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>  <span class="c1"># type: Scope</span>
</span><span id="1-218">
</span><span id="1-219">        <span class="n">rv</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span>
</span><span id="1-220">        <span class="n">rv</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_level</span>
</span><span id="1-221">        <span class="n">rv</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
</span><span id="1-222">        <span class="n">rv</span><span class="o">.</span><span class="n">_fingerprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span>
</span><span id="1-223">        <span class="n">rv</span><span class="o">.</span><span class="n">_transaction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transaction</span>
</span><span id="1-224">        <span class="n">rv</span><span class="o">.</span><span class="n">_transaction_info</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_transaction_info</span><span class="p">)</span>
</span><span id="1-225">        <span class="n">rv</span><span class="o">.</span><span class="n">_user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span>
</span><span id="1-226">
</span><span id="1-227">        <span class="n">rv</span><span class="o">.</span><span class="n">_tags</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="p">)</span>
</span><span id="1-228">        <span class="n">rv</span><span class="o">.</span><span class="n">_contexts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="p">)</span>
</span><span id="1-229">        <span class="n">rv</span><span class="o">.</span><span class="n">_extras</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_extras</span><span class="p">)</span>
</span><span id="1-230">
</span><span id="1-231">        <span class="n">rv</span><span class="o">.</span><span class="n">_breadcrumbs</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_breadcrumbs</span><span class="p">)</span>
</span><span id="1-232">        <span class="n">rv</span><span class="o">.</span><span class="n">_event_processors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_event_processors</span><span class="p">)</span>
</span><span id="1-233">        <span class="n">rv</span><span class="o">.</span><span class="n">_error_processors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_error_processors</span><span class="p">)</span>
</span><span id="1-234">        <span class="n">rv</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span>
</span><span id="1-235">
</span><span id="1-236">        <span class="n">rv</span><span class="o">.</span><span class="n">_should_capture</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_capture</span>
</span><span id="1-237">        <span class="n">rv</span><span class="o">.</span><span class="n">_span</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span>
</span><span id="1-238">        <span class="n">rv</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span>
</span><span id="1-239">        <span class="n">rv</span><span class="o">.</span><span class="n">_force_auto_session_tracking</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_force_auto_session_tracking</span>
</span><span id="1-240">        <span class="n">rv</span><span class="o">.</span><span class="n">_attachments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attachments</span><span class="p">)</span>
</span><span id="1-241">
</span><span id="1-242">        <span class="n">rv</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span>
</span><span id="1-243">
</span><span id="1-244">        <span class="k">return</span> <span class="n">rv</span>
</span><span id="1-245">
<div class="viewcode-block" id="Scope.get_current_scope">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.get_current_scope">[docs]</a>
</span><span id="1-246">    <span class="nd">@classmethod</span>
</span><span id="1-247">    <span class="k">def</span> <span class="nf">get_current_scope</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span id="1-248">        <span class="c1"># type: () -&gt; Scope</span>
</span><span id="1-249"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-250"><span class="sd">        .. versionadded:: 2.0.0</span>
</span><span id="1-251">
</span><span id="1-252"><span class="sd">        Returns the current scope.</span>
</span><span id="1-253"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-254">        <span class="n">current_scope</span> <span class="o">=</span> <span class="n">_current_scope</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="1-255">        <span class="k">if</span> <span class="n">current_scope</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-256">            <span class="n">current_scope</span> <span class="o">=</span> <span class="n">Scope</span><span class="p">(</span><span class="n">ty</span><span class="o">=</span><span class="n">ScopeType</span><span class="o">.</span><span class="n">CURRENT</span><span class="p">)</span>
</span><span id="1-257">            <span class="n">_current_scope</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">current_scope</span><span class="p">)</span>
</span><span id="1-258">
</span><span id="1-259">        <span class="k">return</span> <span class="n">current_scope</span></div>

</span><span id="1-260">
<div class="viewcode-block" id="Scope.set_current_scope">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.set_current_scope">[docs]</a>
</span><span id="1-261">    <span class="nd">@classmethod</span>
</span><span id="1-262">    <span class="k">def</span> <span class="nf">set_current_scope</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">new_current_scope</span><span class="p">):</span>
</span><span id="1-263">        <span class="c1"># type: (Scope) -&gt; None</span>
</span><span id="1-264"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-265"><span class="sd">        .. versionadded:: 2.0.0</span>
</span><span id="1-266">
</span><span id="1-267"><span class="sd">        Sets the given scope as the new current scope overwriting the existing current scope.</span>
</span><span id="1-268"><span class="sd">        :param new_current_scope: The scope to set as the new current scope.</span>
</span><span id="1-269"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-270">        <span class="n">_current_scope</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">new_current_scope</span><span class="p">)</span></div>

</span><span id="1-271">
<div class="viewcode-block" id="Scope.get_isolation_scope">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.get_isolation_scope">[docs]</a>
</span><span id="1-272">    <span class="nd">@classmethod</span>
</span><span id="1-273">    <span class="k">def</span> <span class="nf">get_isolation_scope</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span id="1-274">        <span class="c1"># type: () -&gt; Scope</span>
</span><span id="1-275"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-276"><span class="sd">        .. versionadded:: 2.0.0</span>
</span><span id="1-277">
</span><span id="1-278"><span class="sd">        Returns the isolation scope.</span>
</span><span id="1-279"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-280">        <span class="n">isolation_scope</span> <span class="o">=</span> <span class="n">_isolation_scope</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="1-281">        <span class="k">if</span> <span class="n">isolation_scope</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-282">            <span class="n">isolation_scope</span> <span class="o">=</span> <span class="n">Scope</span><span class="p">(</span><span class="n">ty</span><span class="o">=</span><span class="n">ScopeType</span><span class="o">.</span><span class="n">ISOLATION</span><span class="p">)</span>
</span><span id="1-283">            <span class="n">_isolation_scope</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">isolation_scope</span><span class="p">)</span>
</span><span id="1-284">
</span><span id="1-285">        <span class="k">return</span> <span class="n">isolation_scope</span></div>

</span><span id="1-286">
<div class="viewcode-block" id="Scope.set_isolation_scope">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.set_isolation_scope">[docs]</a>
</span><span id="1-287">    <span class="nd">@classmethod</span>
</span><span id="1-288">    <span class="k">def</span> <span class="nf">set_isolation_scope</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">new_isolation_scope</span><span class="p">):</span>
</span><span id="1-289">        <span class="c1"># type: (Scope) -&gt; None</span>
</span><span id="1-290"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-291"><span class="sd">        .. versionadded:: 2.0.0</span>
</span><span id="1-292">
</span><span id="1-293"><span class="sd">        Sets the given scope as the new isolation scope overwriting the existing isolation scope.</span>
</span><span id="1-294"><span class="sd">        :param new_isolation_scope: The scope to set as the new isolation scope.</span>
</span><span id="1-295"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-296">        <span class="n">_isolation_scope</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">new_isolation_scope</span><span class="p">)</span></div>

</span><span id="1-297">
<div class="viewcode-block" id="Scope.get_global_scope">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.get_global_scope">[docs]</a>
</span><span id="1-298">    <span class="nd">@classmethod</span>
</span><span id="1-299">    <span class="k">def</span> <span class="nf">get_global_scope</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span id="1-300">        <span class="c1"># type: () -&gt; Scope</span>
</span><span id="1-301"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-302"><span class="sd">        .. versionadded:: 2.0.0</span>
</span><span id="1-303">
</span><span id="1-304"><span class="sd">        Returns the global scope.</span>
</span><span id="1-305"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-306">        <span class="k">global</span> <span class="n">_global_scope</span>
</span><span id="1-307">        <span class="k">if</span> <span class="n">_global_scope</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-308">            <span class="n">_global_scope</span> <span class="o">=</span> <span class="n">Scope</span><span class="p">(</span><span class="n">ty</span><span class="o">=</span><span class="n">ScopeType</span><span class="o">.</span><span class="n">GLOBAL</span><span class="p">)</span>
</span><span id="1-309">
</span><span id="1-310">        <span class="k">return</span> <span class="n">_global_scope</span></div>

</span><span id="1-311">
</span><span id="1-312">    <span class="k">def</span> <span class="nf">_merge_scopes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">additional_scope</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">additional_scope_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="1-313">        <span class="c1"># type: (Optional[Scope], Optional[Dict[str, Any]]) -&gt; Scope</span>
</span><span id="1-314"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-315"><span class="sd">        Merges global, isolation and current scope into a new scope and</span>
</span><span id="1-316"><span class="sd">        adds the given additional scope or additional scope kwargs to it.</span>
</span><span id="1-317"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-318">        <span class="k">if</span> <span class="n">additional_scope</span> <span class="ow">and</span> <span class="n">additional_scope_kwargs</span><span class="p">:</span>
</span><span id="1-319">            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;cannot provide scope and kwargs&quot;</span><span class="p">)</span>
</span><span id="1-320">
</span><span id="1-321">        <span class="n">final_scope</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">_global_scope</span><span class="p">)</span> <span class="k">if</span> <span class="n">_global_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Scope</span><span class="p">()</span>
</span><span id="1-322">        <span class="n">final_scope</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="n">ScopeType</span><span class="o">.</span><span class="n">MERGED</span>
</span><span id="1-323">
</span><span id="1-324">        <span class="n">isolation_scope</span> <span class="o">=</span> <span class="n">_isolation_scope</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="1-325">        <span class="k">if</span> <span class="n">isolation_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-326">            <span class="n">final_scope</span><span class="o">.</span><span class="n">update_from_scope</span><span class="p">(</span><span class="n">isolation_scope</span><span class="p">)</span>
</span><span id="1-327">
</span><span id="1-328">        <span class="n">current_scope</span> <span class="o">=</span> <span class="n">_current_scope</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="1-329">        <span class="k">if</span> <span class="n">current_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-330">            <span class="n">final_scope</span><span class="o">.</span><span class="n">update_from_scope</span><span class="p">(</span><span class="n">current_scope</span><span class="p">)</span>
</span><span id="1-331">
</span><span id="1-332">        <span class="k">if</span> <span class="bp">self</span> <span class="o">!=</span> <span class="n">current_scope</span> <span class="ow">and</span> <span class="bp">self</span> <span class="o">!=</span> <span class="n">isolation_scope</span><span class="p">:</span>
</span><span id="1-333">            <span class="n">final_scope</span><span class="o">.</span><span class="n">update_from_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-334">
</span><span id="1-335">        <span class="k">if</span> <span class="n">additional_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-336">            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">additional_scope</span><span class="p">):</span>
</span><span id="1-337">                <span class="n">additional_scope</span><span class="p">(</span><span class="n">final_scope</span><span class="p">)</span>
</span><span id="1-338">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-339">                <span class="n">final_scope</span><span class="o">.</span><span class="n">update_from_scope</span><span class="p">(</span><span class="n">additional_scope</span><span class="p">)</span>
</span><span id="1-340">
</span><span id="1-341">        <span class="k">elif</span> <span class="n">additional_scope_kwargs</span><span class="p">:</span>
</span><span id="1-342">            <span class="n">final_scope</span><span class="o">.</span><span class="n">update_from_kwargs</span><span class="p">(</span><span class="o">**</span><span class="n">additional_scope_kwargs</span><span class="p">)</span>
</span><span id="1-343">
</span><span id="1-344">        <span class="k">return</span> <span class="n">final_scope</span>
</span><span id="1-345">
<div class="viewcode-block" id="Scope.get_client">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.get_client">[docs]</a>
</span><span id="1-346">    <span class="nd">@classmethod</span>
</span><span id="1-347">    <span class="k">def</span> <span class="nf">get_client</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span id="1-348">        <span class="c1"># type: () -&gt; sentry_sdk.client.BaseClient</span>
</span><span id="1-349"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-350"><span class="sd">        .. versionadded:: 2.0.0</span>
</span><span id="1-351">
</span><span id="1-352"><span class="sd">        Returns the currently used :py:class:`sentry_sdk.Client`.</span>
</span><span id="1-353"><span class="sd">        This checks the current scope, the isolation scope and the global scope for a client.</span>
</span><span id="1-354"><span class="sd">        If no client is available a :py:class:`sentry_sdk.client.NonRecordingClient` is returned.</span>
</span><span id="1-355"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-356">        <span class="n">current_scope</span> <span class="o">=</span> <span class="n">_current_scope</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="1-357">        <span class="k">try</span><span class="p">:</span>
</span><span id="1-358">            <span class="n">client</span> <span class="o">=</span> <span class="n">current_scope</span><span class="o">.</span><span class="n">client</span>
</span><span id="1-359">        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="1-360">            <span class="n">client</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-361">
</span><span id="1-362">        <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">client</span><span class="o">.</span><span class="n">is_active</span><span class="p">():</span>
</span><span id="1-363">            <span class="k">return</span> <span class="n">client</span>
</span><span id="1-364">
</span><span id="1-365">        <span class="n">isolation_scope</span> <span class="o">=</span> <span class="n">_isolation_scope</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="1-366">        <span class="k">try</span><span class="p">:</span>
</span><span id="1-367">            <span class="n">client</span> <span class="o">=</span> <span class="n">isolation_scope</span><span class="o">.</span><span class="n">client</span>
</span><span id="1-368">        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="1-369">            <span class="n">client</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-370">
</span><span id="1-371">        <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">client</span><span class="o">.</span><span class="n">is_active</span><span class="p">():</span>
</span><span id="1-372">            <span class="k">return</span> <span class="n">client</span>
</span><span id="1-373">
</span><span id="1-374">        <span class="k">try</span><span class="p">:</span>
</span><span id="1-375">            <span class="n">client</span> <span class="o">=</span> <span class="n">_global_scope</span><span class="o">.</span><span class="n">client</span>  <span class="c1"># type: ignore</span>
</span><span id="1-376">        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="1-377">            <span class="n">client</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-378">
</span><span id="1-379">        <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">client</span><span class="o">.</span><span class="n">is_active</span><span class="p">():</span>
</span><span id="1-380">            <span class="k">return</span> <span class="n">client</span>
</span><span id="1-381">
</span><span id="1-382">        <span class="k">return</span> <span class="n">NonRecordingClient</span><span class="p">()</span></div>

</span><span id="1-383">
<div class="viewcode-block" id="Scope.set_client">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.set_client">[docs]</a>
</span><span id="1-384">    <span class="k">def</span> <span class="nf">set_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="1-385">        <span class="c1"># type: (Optional[sentry_sdk.client.BaseClient]) -&gt; None</span>
</span><span id="1-386"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-387"><span class="sd">        .. versionadded:: 2.0.0</span>
</span><span id="1-388">
</span><span id="1-389"><span class="sd">        Sets the client for this scope.</span>
</span><span id="1-390">
</span><span id="1-391"><span class="sd">        :param client: The client to use in this scope.</span>
</span><span id="1-392"><span class="sd">            If `None` the client of the scope will be replaced by a :py:class:`sentry_sdk.NonRecordingClient`.</span>
</span><span id="1-393">
</span><span id="1-394"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-395">        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">client</span> <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">NonRecordingClient</span><span class="p">()</span></div>

</span><span id="1-396">
<div class="viewcode-block" id="Scope.fork">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.fork">[docs]</a>
</span><span id="1-397">    <span class="k">def</span> <span class="nf">fork</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-398">        <span class="c1"># type: () -&gt; Scope</span>
</span><span id="1-399"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-400"><span class="sd">        .. versionadded:: 2.0.0</span>
</span><span id="1-401">
</span><span id="1-402"><span class="sd">        Returns a fork of this scope.</span>
</span><span id="1-403"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-404">        <span class="n">forked_scope</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-405">        <span class="k">return</span> <span class="n">forked_scope</span></div>

</span><span id="1-406">
</span><span id="1-407">    <span class="k">def</span> <span class="nf">_load_trace_data_from_env</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-408">        <span class="c1"># type: () -&gt; Optional[Dict[str, str]]</span>
</span><span id="1-409"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-410"><span class="sd">        Load Sentry trace id and baggage from environment variables.</span>
</span><span id="1-411"><span class="sd">        Can be disabled by setting SENTRY_USE_ENVIRONMENT to &quot;false&quot;.</span>
</span><span id="1-412"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-413">        <span class="n">incoming_trace_information</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-414">
</span><span id="1-415">        <span class="n">sentry_use_environment</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-416">            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SENTRY_USE_ENVIRONMENT&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
</span><span id="1-417">        <span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="1-418">        <span class="n">use_environment</span> <span class="o">=</span> <span class="n">sentry_use_environment</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">FALSE_VALUES</span>
</span><span id="1-419">        <span class="k">if</span> <span class="n">use_environment</span><span class="p">:</span>
</span><span id="1-420">            <span class="n">incoming_trace_information</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="1-421">
</span><span id="1-422">            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SENTRY_TRACE&quot;</span><span class="p">):</span>
</span><span id="1-423">                <span class="n">incoming_trace_information</span><span class="p">[</span><span class="n">SENTRY_TRACE_HEADER_NAME</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-424">                    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SENTRY_TRACE&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
</span><span id="1-425">                <span class="p">)</span>
</span><span id="1-426">
</span><span id="1-427">            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SENTRY_BAGGAGE&quot;</span><span class="p">):</span>
</span><span id="1-428">                <span class="n">incoming_trace_information</span><span class="p">[</span><span class="n">BAGGAGE_HEADER_NAME</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-429">                    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SENTRY_BAGGAGE&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
</span><span id="1-430">                <span class="p">)</span>
</span><span id="1-431">
</span><span id="1-432">        <span class="k">return</span> <span class="n">incoming_trace_information</span> <span class="ow">or</span> <span class="kc">None</span>
</span><span id="1-433">
</span><span id="1-434">    <span class="k">def</span> <span class="nf">_extract_propagation_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="1-435">        <span class="c1"># type: (Dict[str, Any]) -&gt; Optional[Dict[str, Any]]</span>
</span><span id="1-436">        <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: Dict[str, Any]</span>
</span><span id="1-437">        <span class="n">normalized_data</span> <span class="o">=</span> <span class="n">normalize_incoming_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="1-438">
</span><span id="1-439">        <span class="n">baggage_header</span> <span class="o">=</span> <span class="n">normalized_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">BAGGAGE_HEADER_NAME</span><span class="p">)</span>
</span><span id="1-440">        <span class="k">if</span> <span class="n">baggage_header</span><span class="p">:</span>
</span><span id="1-441">            <span class="n">context</span><span class="p">[</span><span class="s2">&quot;dynamic_sampling_context&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Baggage</span><span class="o">.</span><span class="n">from_incoming_header</span><span class="p">(</span>
</span><span id="1-442">                <span class="n">baggage_header</span>
</span><span id="1-443">            <span class="p">)</span><span class="o">.</span><span class="n">dynamic_sampling_context</span><span class="p">()</span>
</span><span id="1-444">
</span><span id="1-445">        <span class="n">sentry_trace_header</span> <span class="o">=</span> <span class="n">normalized_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SENTRY_TRACE_HEADER_NAME</span><span class="p">)</span>
</span><span id="1-446">        <span class="k">if</span> <span class="n">sentry_trace_header</span><span class="p">:</span>
</span><span id="1-447">            <span class="n">sentrytrace_data</span> <span class="o">=</span> <span class="n">extract_sentrytrace_data</span><span class="p">(</span><span class="n">sentry_trace_header</span><span class="p">)</span>
</span><span id="1-448">            <span class="k">if</span> <span class="n">sentrytrace_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-449">                <span class="n">context</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sentrytrace_data</span><span class="p">)</span>
</span><span id="1-450">
</span><span id="1-451">        <span class="n">only_baggage_no_sentry_trace</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-452">            <span class="s2">&quot;dynamic_sampling_context&quot;</span> <span class="ow">in</span> <span class="n">context</span> <span class="ow">and</span> <span class="s2">&quot;trace_id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">context</span>
</span><span id="1-453">        <span class="p">)</span>
</span><span id="1-454">        <span class="k">if</span> <span class="n">only_baggage_no_sentry_trace</span><span class="p">:</span>
</span><span id="1-455">            <span class="n">context</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_create_new_propagation_context</span><span class="p">())</span>
</span><span id="1-456">
</span><span id="1-457">        <span class="k">if</span> <span class="n">context</span><span class="p">:</span>
</span><span id="1-458">            <span class="k">if</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;span_id&quot;</span><span class="p">):</span>
</span><span id="1-459">                <span class="n">context</span><span class="p">[</span><span class="s2">&quot;span_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">[</span><span class="mi">16</span><span class="p">:]</span>
</span><span id="1-460">
</span><span id="1-461">            <span class="k">return</span> <span class="n">context</span>
</span><span id="1-462">
</span><span id="1-463">        <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-464">
</span><span id="1-465">    <span class="k">def</span> <span class="nf">_create_new_propagation_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-466">        <span class="c1"># type: () -&gt; Dict[str, Any]</span>
</span><span id="1-467">        <span class="k">return</span> <span class="p">{</span>
</span><span id="1-468">            <span class="s2">&quot;trace_id&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">,</span>
</span><span id="1-469">            <span class="s2">&quot;span_id&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">[</span><span class="mi">16</span><span class="p">:],</span>
</span><span id="1-470">            <span class="s2">&quot;parent_span_id&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-471">            <span class="s2">&quot;dynamic_sampling_context&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-472">        <span class="p">}</span>
</span><span id="1-473">
<div class="viewcode-block" id="Scope.set_new_propagation_context">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.set_new_propagation_context">[docs]</a>
</span><span id="1-474">    <span class="k">def</span> <span class="nf">set_new_propagation_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-475">        <span class="c1"># type: () -&gt; None</span>
</span><span id="1-476"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-477"><span class="sd">        Creates a new propagation context and sets it as `_propagation_context`. Overwriting existing one.</span>
</span><span id="1-478"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-479">        <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_new_propagation_context</span><span class="p">()</span>
</span><span id="1-480">        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="1-481">            <span class="s2">&quot;[Tracing] Create new propagation context: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="1-482">            <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="p">,</span>
</span><span id="1-483">        <span class="p">)</span></div>

</span><span id="1-484">
<div class="viewcode-block" id="Scope.generate_propagation_context">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.generate_propagation_context">[docs]</a>
</span><span id="1-485">    <span class="k">def</span> <span class="nf">generate_propagation_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">incoming_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="1-486">        <span class="c1"># type: (Optional[Dict[str, str]]) -&gt; None</span>
</span><span id="1-487"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-488"><span class="sd">        Makes sure the propagation context (`_propagation_context`) is set.</span>
</span><span id="1-489"><span class="sd">        The propagation context only lives on the current scope.</span>
</span><span id="1-490"><span class="sd">        If there is `incoming_data` overwrite existing `_propagation_context`.</span>
</span><span id="1-491"><span class="sd">        if there is no `incoming_data` create new `_propagation_context`, but do NOT overwrite if already existing.</span>
</span><span id="1-492"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-493">        <span class="k">if</span> <span class="n">incoming_data</span><span class="p">:</span>
</span><span id="1-494">            <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_propagation_context</span><span class="p">(</span><span class="n">incoming_data</span><span class="p">)</span>
</span><span id="1-495">
</span><span id="1-496">            <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-497">                <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="o">=</span> <span class="n">context</span>
</span><span id="1-498">                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="1-499">                    <span class="s2">&quot;[Tracing] Extracted propagation context from incoming data: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="1-500">                    <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="p">,</span>
</span><span id="1-501">                <span class="p">)</span>
</span><span id="1-502">
</span><span id="1-503">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">!=</span> <span class="n">ScopeType</span><span class="o">.</span><span class="n">CURRENT</span><span class="p">:</span>
</span><span id="1-504">            <span class="bp">self</span><span class="o">.</span><span class="n">set_new_propagation_context</span><span class="p">()</span></div>

</span><span id="1-505">
<div class="viewcode-block" id="Scope.get_dynamic_sampling_context">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.get_dynamic_sampling_context">[docs]</a>
</span><span id="1-506">    <span class="k">def</span> <span class="nf">get_dynamic_sampling_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-507">        <span class="c1"># type: () -&gt; Optional[Dict[str, str]]</span>
</span><span id="1-508"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-509"><span class="sd">        Returns the Dynamic Sampling Context from the Propagation Context.</span>
</span><span id="1-510"><span class="sd">        If not existing, creates a new one.</span>
</span><span id="1-511"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-512">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-513">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-514">
</span><span id="1-515">        <span class="n">baggage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_baggage</span><span class="p">()</span>
</span><span id="1-516">        <span class="k">if</span> <span class="n">baggage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-517">            <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="p">[</span><span class="s2">&quot;dynamic_sampling_context&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-518">                <span class="n">baggage</span><span class="o">.</span><span class="n">dynamic_sampling_context</span><span class="p">()</span>
</span><span id="1-519">            <span class="p">)</span>
</span><span id="1-520">
</span><span id="1-521">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="p">[</span><span class="s2">&quot;dynamic_sampling_context&quot;</span><span class="p">]</span></div>

</span><span id="1-522">
<div class="viewcode-block" id="Scope.get_traceparent">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.get_traceparent">[docs]</a>
</span><span id="1-523">    <span class="k">def</span> <span class="nf">get_traceparent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="1-524">        <span class="c1"># type: (Any, Any) -&gt; Optional[str]</span>
</span><span id="1-525"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-526"><span class="sd">        Returns the Sentry &quot;sentry-trace&quot; header (aka the traceparent) from the</span>
</span><span id="1-527"><span class="sd">        currently active span or the scopes Propagation Context.</span>
</span><span id="1-528"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-529">        <span class="n">client</span> <span class="o">=</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span>
</span><span id="1-530">
</span><span id="1-531">        <span class="c1"># If we have an active span, return traceparent from there</span>
</span><span id="1-532">        <span class="k">if</span> <span class="n">has_tracing_enabled</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">span</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-533">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">to_traceparent</span><span class="p">()</span>
</span><span id="1-534">
</span><span id="1-535">        <span class="c1"># If this scope has a propagation context, return traceparent from there</span>
</span><span id="1-536">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-537">            <span class="n">traceparent</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
</span><span id="1-538">                <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="p">[</span><span class="s2">&quot;trace_id&quot;</span><span class="p">],</span>
</span><span id="1-539">                <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="p">[</span><span class="s2">&quot;span_id&quot;</span><span class="p">],</span>
</span><span id="1-540">            <span class="p">)</span>
</span><span id="1-541">            <span class="k">return</span> <span class="n">traceparent</span>
</span><span id="1-542">
</span><span id="1-543">        <span class="c1"># Fall back to isolation scope&#39;s traceparent. It always has one</span>
</span><span id="1-544">        <span class="k">return</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_isolation_scope</span><span class="p">()</span><span class="o">.</span><span class="n">get_traceparent</span><span class="p">()</span></div>

</span><span id="1-545">
<div class="viewcode-block" id="Scope.get_baggage">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.get_baggage">[docs]</a>
</span><span id="1-546">    <span class="k">def</span> <span class="nf">get_baggage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="1-547">        <span class="c1"># type: (Any, Any) -&gt; Optional[Baggage]</span>
</span><span id="1-548"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-549"><span class="sd">        Returns the Sentry &quot;baggage&quot; header containing trace information from the</span>
</span><span id="1-550"><span class="sd">        currently active span or the scopes Propagation Context.</span>
</span><span id="1-551"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-552">        <span class="n">client</span> <span class="o">=</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span>
</span><span id="1-553">
</span><span id="1-554">        <span class="c1"># If we have an active span, return baggage from there</span>
</span><span id="1-555">        <span class="k">if</span> <span class="n">has_tracing_enabled</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">span</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-556">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">to_baggage</span><span class="p">()</span>
</span><span id="1-557">
</span><span id="1-558">        <span class="c1"># If this scope has a propagation context, return baggage from there</span>
</span><span id="1-559">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-560">            <span class="n">dynamic_sampling_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="1-561">                <span class="s2">&quot;dynamic_sampling_context&quot;</span>
</span><span id="1-562">            <span class="p">)</span>
</span><span id="1-563">            <span class="k">if</span> <span class="n">dynamic_sampling_context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-564">                <span class="k">return</span> <span class="n">Baggage</span><span class="o">.</span><span class="n">from_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-565">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-566">                <span class="k">return</span> <span class="n">Baggage</span><span class="p">(</span><span class="n">dynamic_sampling_context</span><span class="p">)</span>
</span><span id="1-567">
</span><span id="1-568">        <span class="c1"># Fall back to isolation scope&#39;s baggage. It always has one</span>
</span><span id="1-569">        <span class="k">return</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_isolation_scope</span><span class="p">()</span><span class="o">.</span><span class="n">get_baggage</span><span class="p">()</span></div>

</span><span id="1-570">
<div class="viewcode-block" id="Scope.get_trace_context">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.get_trace_context">[docs]</a>
</span><span id="1-571">    <span class="k">def</span> <span class="nf">get_trace_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-572">        <span class="c1"># type: () -&gt; Any</span>
</span><span id="1-573"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-574"><span class="sd">        Returns the Sentry &quot;trace&quot; context from the Propagation Context.</span>
</span><span id="1-575"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-576">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-577">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-578">
</span><span id="1-579">        <span class="n">trace_context</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="1-580">            <span class="s2">&quot;trace_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="p">[</span><span class="s2">&quot;trace_id&quot;</span><span class="p">],</span>
</span><span id="1-581">            <span class="s2">&quot;span_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="p">[</span><span class="s2">&quot;span_id&quot;</span><span class="p">],</span>
</span><span id="1-582">            <span class="s2">&quot;parent_span_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="p">[</span><span class="s2">&quot;parent_span_id&quot;</span><span class="p">],</span>
</span><span id="1-583">            <span class="s2">&quot;dynamic_sampling_context&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dynamic_sampling_context</span><span class="p">(),</span>
</span><span id="1-584">        <span class="p">}</span>  <span class="c1"># type: Dict[str, Any]</span>
</span><span id="1-585">
</span><span id="1-586">        <span class="k">return</span> <span class="n">trace_context</span></div>

</span><span id="1-587">
<div class="viewcode-block" id="Scope.trace_propagation_meta">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.trace_propagation_meta">[docs]</a>
</span><span id="1-588">    <span class="k">def</span> <span class="nf">trace_propagation_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="1-589">        <span class="c1"># type: (*Any, **Any) -&gt; str</span>
</span><span id="1-590"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-591"><span class="sd">        Return meta tags which should be injected into HTML templates</span>
</span><span id="1-592"><span class="sd">        to allow propagation of trace information.</span>
</span><span id="1-593"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-594">        <span class="n">span</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;span&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-595">        <span class="k">if</span> <span class="n">span</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-596">            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="1-597">                <span class="s2">&quot;The parameter `span` in trace_propagation_meta() is deprecated and will be removed in the future.&quot;</span>
</span><span id="1-598">            <span class="p">)</span>
</span><span id="1-599">
</span><span id="1-600">        <span class="n">meta</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="1-601">
</span><span id="1-602">        <span class="n">sentry_trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traceparent</span><span class="p">()</span>
</span><span id="1-603">        <span class="k">if</span> <span class="n">sentry_trace</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-604">            <span class="n">meta</span> <span class="o">+=</span> <span class="s1">&#39;&lt;meta name=&quot;</span><span class="si">%s</span><span class="s1">&quot; content=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span>
</span><span id="1-605">                <span class="n">SENTRY_TRACE_HEADER_NAME</span><span class="p">,</span>
</span><span id="1-606">                <span class="n">sentry_trace</span><span class="p">,</span>
</span><span id="1-607">            <span class="p">)</span>
</span><span id="1-608">
</span><span id="1-609">        <span class="n">baggage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_baggage</span><span class="p">()</span>
</span><span id="1-610">        <span class="k">if</span> <span class="n">baggage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-611">            <span class="n">meta</span> <span class="o">+=</span> <span class="s1">&#39;&lt;meta name=&quot;</span><span class="si">%s</span><span class="s1">&quot; content=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span>
</span><span id="1-612">                <span class="n">BAGGAGE_HEADER_NAME</span><span class="p">,</span>
</span><span id="1-613">                <span class="n">baggage</span><span class="o">.</span><span class="n">serialize</span><span class="p">(),</span>
</span><span id="1-614">            <span class="p">)</span>
</span><span id="1-615">
</span><span id="1-616">        <span class="k">return</span> <span class="n">meta</span></div>

</span><span id="1-617">
<div class="viewcode-block" id="Scope.iter_headers">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.iter_headers">[docs]</a>
</span><span id="1-618">    <span class="k">def</span> <span class="nf">iter_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-619">        <span class="c1"># type: () -&gt; Iterator[Tuple[str, str]]</span>
</span><span id="1-620"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-621"><span class="sd">        Creates a generator which returns the `sentry-trace` and `baggage` headers from the Propagation Context.</span>
</span><span id="1-622"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-623">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-624">            <span class="n">traceparent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traceparent</span><span class="p">()</span>
</span><span id="1-625">            <span class="k">if</span> <span class="n">traceparent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-626">                <span class="k">yield</span> <span class="n">SENTRY_TRACE_HEADER_NAME</span><span class="p">,</span> <span class="n">traceparent</span>
</span><span id="1-627">
</span><span id="1-628">            <span class="n">dsc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dynamic_sampling_context</span><span class="p">()</span>
</span><span id="1-629">            <span class="k">if</span> <span class="n">dsc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-630">                <span class="n">baggage</span> <span class="o">=</span> <span class="n">Baggage</span><span class="p">(</span><span class="n">dsc</span><span class="p">)</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span>
</span><span id="1-631">                <span class="k">yield</span> <span class="n">BAGGAGE_HEADER_NAME</span><span class="p">,</span> <span class="n">baggage</span></div>

</span><span id="1-632">
<div class="viewcode-block" id="Scope.iter_trace_propagation_headers">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.iter_trace_propagation_headers">[docs]</a>
</span><span id="1-633">    <span class="k">def</span> <span class="nf">iter_trace_propagation_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="1-634">        <span class="c1"># type: (Any, Any) -&gt; Generator[Tuple[str, str], None, None]</span>
</span><span id="1-635"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-636"><span class="sd">        Return HTTP headers which allow propagation of trace data. Data taken</span>
</span><span id="1-637"><span class="sd">        from the span representing the request, if available, or the current</span>
</span><span id="1-638"><span class="sd">        span on the scope if not.</span>
</span><span id="1-639"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-640">        <span class="n">client</span> <span class="o">=</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span>
</span><span id="1-641">        <span class="k">if</span> <span class="ow">not</span> <span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;propagate_traces&quot;</span><span class="p">):</span>
</span><span id="1-642">            <span class="k">return</span>
</span><span id="1-643">
</span><span id="1-644">        <span class="n">span</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;span&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-645">        <span class="n">span</span> <span class="o">=</span> <span class="n">span</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">span</span>
</span><span id="1-646">
</span><span id="1-647">        <span class="k">if</span> <span class="n">has_tracing_enabled</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="p">)</span> <span class="ow">and</span> <span class="n">span</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-648">            <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">span</span><span class="o">.</span><span class="n">iter_headers</span><span class="p">():</span>
</span><span id="1-649">                <span class="k">yield</span> <span class="n">header</span>
</span><span id="1-650">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-651">            <span class="c1"># If this scope has a propagation context, return headers from there</span>
</span><span id="1-652">            <span class="c1"># (it could be that self is not the current scope nor the isolation scope)</span>
</span><span id="1-653">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-654">                <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_headers</span><span class="p">():</span>
</span><span id="1-655">                    <span class="k">yield</span> <span class="n">header</span>
</span><span id="1-656">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-657">                <span class="c1"># otherwise try headers from current scope</span>
</span><span id="1-658">                <span class="n">current_scope</span> <span class="o">=</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_current_scope</span><span class="p">()</span>
</span><span id="1-659">                <span class="k">if</span> <span class="n">current_scope</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-660">                    <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">current_scope</span><span class="o">.</span><span class="n">iter_headers</span><span class="p">():</span>
</span><span id="1-661">                        <span class="k">yield</span> <span class="n">header</span>
</span><span id="1-662">                <span class="k">else</span><span class="p">:</span>
</span><span id="1-663">                    <span class="c1"># otherwise fall back to headers from isolation scope</span>
</span><span id="1-664">                    <span class="n">isolation_scope</span> <span class="o">=</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_isolation_scope</span><span class="p">()</span>
</span><span id="1-665">                    <span class="k">if</span> <span class="n">isolation_scope</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-666">                        <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">isolation_scope</span><span class="o">.</span><span class="n">iter_headers</span><span class="p">():</span>
</span><span id="1-667">                            <span class="k">yield</span> <span class="n">header</span></div>

</span><span id="1-668">
</span><span id="1-669">    <span class="k">def</span> <span class="nf">get_active_propagation_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-670">        <span class="c1"># type: () -&gt; Dict[str, Any]</span>
</span><span id="1-671">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-672">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span>
</span><span id="1-673">
</span><span id="1-674">        <span class="n">current_scope</span> <span class="o">=</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_current_scope</span><span class="p">()</span>
</span><span id="1-675">        <span class="k">if</span> <span class="n">current_scope</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-676">            <span class="k">return</span> <span class="n">current_scope</span><span class="o">.</span><span class="n">_propagation_context</span>
</span><span id="1-677">
</span><span id="1-678">        <span class="n">isolation_scope</span> <span class="o">=</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_isolation_scope</span><span class="p">()</span>
</span><span id="1-679">        <span class="k">if</span> <span class="n">isolation_scope</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-680">            <span class="k">return</span> <span class="n">isolation_scope</span><span class="o">.</span><span class="n">_propagation_context</span>
</span><span id="1-681">
</span><span id="1-682">        <span class="k">return</span> <span class="p">{}</span>
</span><span id="1-683">
<div class="viewcode-block" id="Scope.clear">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.clear">[docs]</a>
</span><span id="1-684">    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-685">        <span class="c1"># type: () -&gt; None</span>
</span><span id="1-686"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clears the entire scope.&quot;&quot;&quot;</span>
</span><span id="1-687">        <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[LogLevelStr]</span>
</span><span id="1-688">        <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[List[str]]</span>
</span><span id="1-689">        <span class="bp">self</span><span class="o">.</span><span class="n">_transaction</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[str]</span>
</span><span id="1-690">        <span class="bp">self</span><span class="o">.</span><span class="n">_transaction_info</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: MutableMapping[str, str]</span>
</span><span id="1-691">        <span class="bp">self</span><span class="o">.</span><span class="n">_user</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[Dict[str, Any]]</span>
</span><span id="1-692">
</span><span id="1-693">        <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: Dict[str, Any]</span>
</span><span id="1-694">        <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: Dict[str, Dict[str, Any]]</span>
</span><span id="1-695">        <span class="bp">self</span><span class="o">.</span><span class="n">_extras</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: MutableMapping[str, Any]</span>
</span><span id="1-696">        <span class="bp">self</span><span class="o">.</span><span class="n">_attachments</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[Attachment]</span>
</span><span id="1-697">
</span><span id="1-698">        <span class="bp">self</span><span class="o">.</span><span class="n">clear_breadcrumbs</span><span class="p">()</span>
</span><span id="1-699">        <span class="bp">self</span><span class="o">.</span><span class="n">_should_capture</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># type: bool</span>
</span><span id="1-700">
</span><span id="1-701">        <span class="bp">self</span><span class="o">.</span><span class="n">_span</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[Span]</span>
</span><span id="1-702">        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[Session]</span>
</span><span id="1-703">        <span class="bp">self</span><span class="o">.</span><span class="n">_force_auto_session_tracking</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[bool]</span>
</span><span id="1-704">
</span><span id="1-705">        <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[Profile]</span>
</span><span id="1-706">
</span><span id="1-707">        <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="o">=</span> <span class="kc">None</span></div>

</span><span id="1-708">
</span><span id="1-709">    <span class="nd">@_attr_setter</span>
</span><span id="1-710">    <span class="k">def</span> <span class="nf">level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="1-711">        <span class="c1"># type: (LogLevelStr) -&gt; None</span>
</span><span id="1-712"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-713"><span class="sd">        When set this overrides the level.</span>
</span><span id="1-714">
</span><span id="1-715"><span class="sd">        .. deprecated:: 1.0.0</span>
</span><span id="1-716"><span class="sd">            Use :func:`set_level` instead.</span>
</span><span id="1-717">
</span><span id="1-718"><span class="sd">        :param value: The level to set.</span>
</span><span id="1-719"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-720">        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="1-721">            <span class="s2">&quot;Deprecated: use .set_level() instead. This will be removed in the future.&quot;</span>
</span><span id="1-722">        <span class="p">)</span>
</span><span id="1-723">
</span><span id="1-724">        <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="1-725">
<div class="viewcode-block" id="Scope.set_level">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.set_level">[docs]</a>
</span><span id="1-726">    <span class="k">def</span> <span class="nf">set_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="1-727">        <span class="c1"># type: (LogLevelStr) -&gt; None</span>
</span><span id="1-728"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-729"><span class="sd">        Sets the level for the scope.</span>
</span><span id="1-730">
</span><span id="1-731"><span class="sd">        :param value: The level to set.</span>
</span><span id="1-732"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-733">        <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="n">value</span></div>

</span><span id="1-734">
</span><span id="1-735">    <span class="nd">@_attr_setter</span>
</span><span id="1-736">    <span class="k">def</span> <span class="nf">fingerprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="1-737">        <span class="c1"># type: (Optional[List[str]]) -&gt; None</span>
</span><span id="1-738"><span class="w">        </span><span class="sd">&quot;&quot;&quot;When set this overrides the default fingerprint.&quot;&quot;&quot;</span>
</span><span id="1-739">        <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="1-740">
</span><span id="1-741">    <span class="nd">@property</span>
</span><span id="1-742">    <span class="k">def</span> <span class="nf">transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-743">        <span class="c1"># type: () -&gt; Any</span>
</span><span id="1-744">        <span class="c1"># would be type: () -&gt; Optional[Transaction], see https://github.com/python/mypy/issues/3004</span>
</span><span id="1-745"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the transaction (root span) in the scope, if any.&quot;&quot;&quot;</span>
</span><span id="1-746">
</span><span id="1-747">        <span class="c1"># there is no span/transaction on the scope</span>
</span><span id="1-748">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-749">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-750">
</span><span id="1-751">        <span class="c1"># there is an orphan span on the scope</span>
</span><span id="1-752">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span><span class="o">.</span><span class="n">containing_transaction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-753">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-754">
</span><span id="1-755">        <span class="c1"># there is either a transaction (which is its own containing</span>
</span><span id="1-756">        <span class="c1"># transaction) or a non-orphan span on the scope</span>
</span><span id="1-757">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span><span class="o">.</span><span class="n">containing_transaction</span>
</span><span id="1-758">
</span><span id="1-759">    <span class="nd">@transaction</span><span class="o">.</span><span class="n">setter</span>
</span><span id="1-760">    <span class="k">def</span> <span class="nf">transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="1-761">        <span class="c1"># type: (Any) -&gt; None</span>
</span><span id="1-762">        <span class="c1"># would be type: (Optional[str]) -&gt; None, see https://github.com/python/mypy/issues/3004</span>
</span><span id="1-763"><span class="w">        </span><span class="sd">&quot;&quot;&quot;When set this forces a specific transaction name to be set.</span>
</span><span id="1-764">
</span><span id="1-765"><span class="sd">        Deprecated: use set_transaction_name instead.&quot;&quot;&quot;</span>
</span><span id="1-766">
</span><span id="1-767">        <span class="c1"># XXX: the docstring above is misleading. The implementation of</span>
</span><span id="1-768">        <span class="c1"># apply_to_event prefers an existing value of event.transaction over</span>
</span><span id="1-769">        <span class="c1"># anything set in the scope.</span>
</span><span id="1-770">        <span class="c1"># XXX: note that with the introduction of the Scope.transaction getter,</span>
</span><span id="1-771">        <span class="c1"># there is a semantic and type mismatch between getter and setter. The</span>
</span><span id="1-772">        <span class="c1"># getter returns a Transaction, the setter sets a transaction name.</span>
</span><span id="1-773">        <span class="c1"># Without breaking version compatibility, we could make the setter set a</span>
</span><span id="1-774">        <span class="c1"># transaction name or transaction (self._span) depending on the type of</span>
</span><span id="1-775">        <span class="c1"># the value argument.</span>
</span><span id="1-776">
</span><span id="1-777">        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="1-778">            <span class="s2">&quot;Assigning to scope.transaction directly is deprecated: use scope.set_transaction_name() instead.&quot;</span>
</span><span id="1-779">        <span class="p">)</span>
</span><span id="1-780">        <span class="bp">self</span><span class="o">.</span><span class="n">_transaction</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="1-781">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span><span class="o">.</span><span class="n">containing_transaction</span><span class="p">:</span>
</span><span id="1-782">            <span class="bp">self</span><span class="o">.</span><span class="n">_span</span><span class="o">.</span><span class="n">containing_transaction</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="1-783">
<div class="viewcode-block" id="Scope.set_transaction_name">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.set_transaction_name">[docs]</a>
</span><span id="1-784">    <span class="k">def</span> <span class="nf">set_transaction_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="1-785">        <span class="c1"># type: (str, Optional[str]) -&gt; None</span>
</span><span id="1-786"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the transaction name and optionally the transaction source.&quot;&quot;&quot;</span>
</span><span id="1-787">        <span class="bp">self</span><span class="o">.</span><span class="n">_transaction</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="1-788">
</span><span id="1-789">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span><span class="o">.</span><span class="n">containing_transaction</span><span class="p">:</span>
</span><span id="1-790">            <span class="bp">self</span><span class="o">.</span><span class="n">_span</span><span class="o">.</span><span class="n">containing_transaction</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="1-791">            <span class="k">if</span> <span class="n">source</span><span class="p">:</span>
</span><span id="1-792">                <span class="bp">self</span><span class="o">.</span><span class="n">_span</span><span class="o">.</span><span class="n">containing_transaction</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span>
</span><span id="1-793">
</span><span id="1-794">        <span class="k">if</span> <span class="n">source</span><span class="p">:</span>
</span><span id="1-795">            <span class="bp">self</span><span class="o">.</span><span class="n">_transaction_info</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">source</span></div>

</span><span id="1-796">
</span><span id="1-797">    <span class="nd">@_attr_setter</span>
</span><span id="1-798">    <span class="k">def</span> <span class="nf">user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="1-799">        <span class="c1"># type: (Optional[Dict[str, Any]]) -&gt; None</span>
</span><span id="1-800"><span class="w">        </span><span class="sd">&quot;&quot;&quot;When set a specific user is bound to the scope. Deprecated in favor of set_user.&quot;&quot;&quot;</span>
</span><span id="1-801">        <span class="bp">self</span><span class="o">.</span><span class="n">set_user</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="1-802">
<div class="viewcode-block" id="Scope.set_user">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.set_user">[docs]</a>
</span><span id="1-803">    <span class="k">def</span> <span class="nf">set_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="1-804">        <span class="c1"># type: (Optional[Dict[str, Any]]) -&gt; None</span>
</span><span id="1-805"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets a user for the scope.&quot;&quot;&quot;</span>
</span><span id="1-806">        <span class="bp">self</span><span class="o">.</span><span class="n">_user</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="1-807">        <span class="n">session</span> <span class="o">=</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_isolation_scope</span><span class="p">()</span><span class="o">.</span><span class="n">_session</span>
</span><span id="1-808">        <span class="k">if</span> <span class="n">session</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-809">            <span class="n">session</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">value</span><span class="p">)</span></div>

</span><span id="1-810">
</span><span id="1-811">    <span class="nd">@property</span>
</span><span id="1-812">    <span class="k">def</span> <span class="nf">span</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-813">        <span class="c1"># type: () -&gt; Optional[Span]</span>
</span><span id="1-814"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get/set current tracing span or transaction.&quot;&quot;&quot;</span>
</span><span id="1-815">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span>
</span><span id="1-816">
</span><span id="1-817">    <span class="nd">@span</span><span class="o">.</span><span class="n">setter</span>
</span><span id="1-818">    <span class="k">def</span> <span class="nf">span</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">span</span><span class="p">):</span>
</span><span id="1-819">        <span class="c1"># type: (Optional[Span]) -&gt; None</span>
</span><span id="1-820">        <span class="bp">self</span><span class="o">.</span><span class="n">_span</span> <span class="o">=</span> <span class="n">span</span>
</span><span id="1-821">        <span class="c1"># XXX: this differs from the implementation in JS, there Scope.setSpan</span>
</span><span id="1-822">        <span class="c1"># does not set Scope._transactionName.</span>
</span><span id="1-823">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">span</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">):</span>
</span><span id="1-824">            <span class="n">transaction</span> <span class="o">=</span> <span class="n">span</span>
</span><span id="1-825">            <span class="k">if</span> <span class="n">transaction</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="1-826">                <span class="bp">self</span><span class="o">.</span><span class="n">_transaction</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="n">name</span>
</span><span id="1-827">                <span class="k">if</span> <span class="n">transaction</span><span class="o">.</span><span class="n">source</span><span class="p">:</span>
</span><span id="1-828">                    <span class="bp">self</span><span class="o">.</span><span class="n">_transaction_info</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="n">source</span>
</span><span id="1-829">
</span><span id="1-830">    <span class="nd">@property</span>
</span><span id="1-831">    <span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-832">        <span class="c1"># type: () -&gt; Optional[Profile]</span>
</span><span id="1-833">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span>
</span><span id="1-834">
</span><span id="1-835">    <span class="nd">@profile</span><span class="o">.</span><span class="n">setter</span>
</span><span id="1-836">    <span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">profile</span><span class="p">):</span>
</span><span id="1-837">        <span class="c1"># type: (Optional[Profile]) -&gt; None</span>
</span><span id="1-838">
</span><span id="1-839">        <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="n">profile</span>
</span><span id="1-840">
<div class="viewcode-block" id="Scope.set_tag">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.set_tag">[docs]</a>
</span><span id="1-841">    <span class="k">def</span> <span class="nf">set_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="1-842">        <span class="c1"># type: (str, Any) -&gt; None</span>
</span><span id="1-843"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-844"><span class="sd">        Sets a tag for a key to a specific value.</span>
</span><span id="1-845">
</span><span id="1-846"><span class="sd">        :param key: Key of the tag to set.</span>
</span><span id="1-847">
</span><span id="1-848"><span class="sd">        :param value: Value of the tag to set.</span>
</span><span id="1-849"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-850">        <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

</span><span id="1-851">
<div class="viewcode-block" id="Scope.remove_tag">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.remove_tag">[docs]</a>
</span><span id="1-852">    <span class="k">def</span> <span class="nf">remove_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span id="1-853">        <span class="c1"># type: (str) -&gt; None</span>
</span><span id="1-854"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-855"><span class="sd">        Removes a specific tag.</span>
</span><span id="1-856">
</span><span id="1-857"><span class="sd">        :param key: Key of the tag to remove.</span>
</span><span id="1-858"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-859">        <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

</span><span id="1-860">
<div class="viewcode-block" id="Scope.set_context">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.set_context">[docs]</a>
</span><span id="1-861">    <span class="k">def</span> <span class="nf">set_context</span><span class="p">(</span>
</span><span id="1-862">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-863">        <span class="n">key</span><span class="p">,</span>  <span class="c1"># type: str</span>
</span><span id="1-864">        <span class="n">value</span><span class="p">,</span>  <span class="c1"># type: Dict[str, Any]</span>
</span><span id="1-865">    <span class="p">):</span>
</span><span id="1-866">        <span class="c1"># type: (...) -&gt; None</span>
</span><span id="1-867"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-868"><span class="sd">        Binds a context at a certain key to a specific value.</span>
</span><span id="1-869"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-870">        <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

</span><span id="1-871">
<div class="viewcode-block" id="Scope.remove_context">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.remove_context">[docs]</a>
</span><span id="1-872">    <span class="k">def</span> <span class="nf">remove_context</span><span class="p">(</span>
</span><span id="1-873">        <span class="bp">self</span><span class="p">,</span> <span class="n">key</span>  <span class="c1"># type: str</span>
</span><span id="1-874">    <span class="p">):</span>
</span><span id="1-875">        <span class="c1"># type: (...) -&gt; None</span>
</span><span id="1-876"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Removes a context.&quot;&quot;&quot;</span>
</span><span id="1-877">        <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

</span><span id="1-878">
<div class="viewcode-block" id="Scope.set_extra">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.set_extra">[docs]</a>
</span><span id="1-879">    <span class="k">def</span> <span class="nf">set_extra</span><span class="p">(</span>
</span><span id="1-880">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-881">        <span class="n">key</span><span class="p">,</span>  <span class="c1"># type: str</span>
</span><span id="1-882">        <span class="n">value</span><span class="p">,</span>  <span class="c1"># type: Any</span>
</span><span id="1-883">    <span class="p">):</span>
</span><span id="1-884">        <span class="c1"># type: (...) -&gt; None</span>
</span><span id="1-885"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets an extra key to a specific value.&quot;&quot;&quot;</span>
</span><span id="1-886">        <span class="bp">self</span><span class="o">.</span><span class="n">_extras</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

</span><span id="1-887">
<div class="viewcode-block" id="Scope.remove_extra">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.remove_extra">[docs]</a>
</span><span id="1-888">    <span class="k">def</span> <span class="nf">remove_extra</span><span class="p">(</span>
</span><span id="1-889">        <span class="bp">self</span><span class="p">,</span> <span class="n">key</span>  <span class="c1"># type: str</span>
</span><span id="1-890">    <span class="p">):</span>
</span><span id="1-891">        <span class="c1"># type: (...) -&gt; None</span>
</span><span id="1-892"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Removes a specific extra key.&quot;&quot;&quot;</span>
</span><span id="1-893">        <span class="bp">self</span><span class="o">.</span><span class="n">_extras</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

</span><span id="1-894">
<div class="viewcode-block" id="Scope.clear_breadcrumbs">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.clear_breadcrumbs">[docs]</a>
</span><span id="1-895">    <span class="k">def</span> <span class="nf">clear_breadcrumbs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-896">        <span class="c1"># type: () -&gt; None</span>
</span><span id="1-897"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clears breadcrumb buffer.&quot;&quot;&quot;</span>
</span><span id="1-898">        <span class="bp">self</span><span class="o">.</span><span class="n">_breadcrumbs</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>  <span class="c1"># type: Deque[Breadcrumb]</span></div>

</span><span id="1-899">
<div class="viewcode-block" id="Scope.add_attachment">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.add_attachment">[docs]</a>
</span><span id="1-900">    <span class="k">def</span> <span class="nf">add_attachment</span><span class="p">(</span>
</span><span id="1-901">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-902">        <span class="nb">bytes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[bytes]</span>
</span><span id="1-903">        <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[str]</span>
</span><span id="1-904">        <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[str]</span>
</span><span id="1-905">        <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[str]</span>
</span><span id="1-906">        <span class="n">add_to_transactions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># type: bool</span>
</span><span id="1-907">    <span class="p">):</span>
</span><span id="1-908">        <span class="c1"># type: (...) -&gt; None</span>
</span><span id="1-909"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds an attachment to future events sent.&quot;&quot;&quot;</span>
</span><span id="1-910">        <span class="bp">self</span><span class="o">.</span><span class="n">_attachments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="1-911">            <span class="n">Attachment</span><span class="p">(</span>
</span><span id="1-912">                <span class="nb">bytes</span><span class="o">=</span><span class="nb">bytes</span><span class="p">,</span>
</span><span id="1-913">                <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
</span><span id="1-914">                <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
</span><span id="1-915">                <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span>
</span><span id="1-916">                <span class="n">add_to_transactions</span><span class="o">=</span><span class="n">add_to_transactions</span><span class="p">,</span>
</span><span id="1-917">            <span class="p">)</span>
</span><span id="1-918">        <span class="p">)</span></div>

</span><span id="1-919">
<div class="viewcode-block" id="Scope.add_breadcrumb">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.add_breadcrumb">[docs]</a>
</span><span id="1-920">    <span class="k">def</span> <span class="nf">add_breadcrumb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crumb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="1-921">        <span class="c1"># type: (Optional[Breadcrumb], Optional[BreadcrumbHint], Any) -&gt; None</span>
</span><span id="1-922"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-923"><span class="sd">        Adds a breadcrumb.</span>
</span><span id="1-924">
</span><span id="1-925"><span class="sd">        :param crumb: Dictionary with the data as the sentry v7/v8 protocol expects.</span>
</span><span id="1-926">
</span><span id="1-927"><span class="sd">        :param hint: An optional value that can be used by `before_breadcrumb`</span>
</span><span id="1-928"><span class="sd">            to customize the breadcrumbs that are emitted.</span>
</span><span id="1-929"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-930">        <span class="n">client</span> <span class="o">=</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span>
</span><span id="1-931">
</span><span id="1-932">        <span class="k">if</span> <span class="ow">not</span> <span class="n">client</span><span class="o">.</span><span class="n">is_active</span><span class="p">():</span>
</span><span id="1-933">            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dropped breadcrumb because no client bound&quot;</span><span class="p">)</span>
</span><span id="1-934">            <span class="k">return</span>
</span><span id="1-935">
</span><span id="1-936">        <span class="n">before_breadcrumb</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;before_breadcrumb&quot;</span><span class="p">)</span>
</span><span id="1-937">        <span class="n">max_breadcrumbs</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_breadcrumbs&quot;</span><span class="p">,</span> <span class="n">DEFAULT_MAX_BREADCRUMBS</span><span class="p">)</span>
</span><span id="1-938">
</span><span id="1-939">        <span class="n">crumb</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">crumb</span> <span class="ow">or</span> <span class="p">())</span>  <span class="c1"># type: Breadcrumb</span>
</span><span id="1-940">        <span class="n">crumb</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="1-941">        <span class="k">if</span> <span class="ow">not</span> <span class="n">crumb</span><span class="p">:</span>
</span><span id="1-942">            <span class="k">return</span>
</span><span id="1-943">
</span><span id="1-944">        <span class="n">hint</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">hint</span> <span class="ow">or</span> <span class="p">())</span>  <span class="c1"># type: Hint</span>
</span><span id="1-945">
</span><span id="1-946">        <span class="k">if</span> <span class="n">crumb</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-947">            <span class="n">crumb</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
</span><span id="1-948">        <span class="k">if</span> <span class="n">crumb</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-949">            <span class="n">crumb</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
</span><span id="1-950">
</span><span id="1-951">        <span class="k">if</span> <span class="n">before_breadcrumb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-952">            <span class="n">new_crumb</span> <span class="o">=</span> <span class="n">before_breadcrumb</span><span class="p">(</span><span class="n">crumb</span><span class="p">,</span> <span class="n">hint</span><span class="p">)</span>
</span><span id="1-953">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-954">            <span class="n">new_crumb</span> <span class="o">=</span> <span class="n">crumb</span>
</span><span id="1-955">
</span><span id="1-956">        <span class="k">if</span> <span class="n">new_crumb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-957">            <span class="bp">self</span><span class="o">.</span><span class="n">_breadcrumbs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_crumb</span><span class="p">)</span>
</span><span id="1-958">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-959">            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;before breadcrumb dropped breadcrumb (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">crumb</span><span class="p">)</span>
</span><span id="1-960">
</span><span id="1-961">        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_breadcrumbs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_breadcrumbs</span><span class="p">:</span>
</span><span id="1-962">            <span class="bp">self</span><span class="o">.</span><span class="n">_breadcrumbs</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span></div>

</span><span id="1-963">
<div class="viewcode-block" id="Scope.start_transaction">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.start_transaction">[docs]</a>
</span><span id="1-964">    <span class="k">def</span> <span class="nf">start_transaction</span><span class="p">(</span>
</span><span id="1-965">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-966">        <span class="n">transaction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="1-967">        <span class="n">instrumenter</span><span class="o">=</span><span class="n">INSTRUMENTER</span><span class="o">.</span><span class="n">SENTRY</span><span class="p">,</span>
</span><span id="1-968">        <span class="n">custom_sampling_context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="1-969">        <span class="o">**</span><span class="n">kwargs</span>
</span><span id="1-970">    <span class="p">):</span>
</span><span id="1-971">        <span class="c1"># type: (Optional[Transaction], str, Optional[SamplingContext], Unpack[TransactionKwargs]) -&gt; Union[Transaction, NoOpSpan]</span>
</span><span id="1-972"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-973"><span class="sd">        Start and return a transaction.</span>
</span><span id="1-974">
</span><span id="1-975"><span class="sd">        Start an existing transaction if given, otherwise create and start a new</span>
</span><span id="1-976"><span class="sd">        transaction with kwargs.</span>
</span><span id="1-977">
</span><span id="1-978"><span class="sd">        This is the entry point to manual tracing instrumentation.</span>
</span><span id="1-979">
</span><span id="1-980"><span class="sd">        A tree structure can be built by adding child spans to the transaction,</span>
</span><span id="1-981"><span class="sd">        and child spans to other spans. To start a new child span within the</span>
</span><span id="1-982"><span class="sd">        transaction or any span, call the respective `.start_child()` method.</span>
</span><span id="1-983">
</span><span id="1-984"><span class="sd">        Every child span must be finished before the transaction is finished,</span>
</span><span id="1-985"><span class="sd">        otherwise the unfinished spans are discarded.</span>
</span><span id="1-986">
</span><span id="1-987"><span class="sd">        When used as context managers, spans and transactions are automatically</span>
</span><span id="1-988"><span class="sd">        finished at the end of the `with` block. If not using context managers,</span>
</span><span id="1-989"><span class="sd">        call the `.finish()` method.</span>
</span><span id="1-990">
</span><span id="1-991"><span class="sd">        When the transaction is finished, it will be sent to Sentry with all its</span>
</span><span id="1-992"><span class="sd">        finished child spans.</span>
</span><span id="1-993">
</span><span id="1-994"><span class="sd">        :param transaction: The transaction to start. If omitted, we create and</span>
</span><span id="1-995"><span class="sd">            start a new transaction.</span>
</span><span id="1-996"><span class="sd">        :param instrumenter: This parameter is meant for internal use only.</span>
</span><span id="1-997"><span class="sd">        :param custom_sampling_context: The transaction&#39;s custom sampling context.</span>
</span><span id="1-998"><span class="sd">        :param kwargs: Optional keyword arguments to be passed to the Transaction</span>
</span><span id="1-999"><span class="sd">            constructor. See :py:class:`sentry_sdk.tracing.Transaction` for</span>
</span><span id="1-1000"><span class="sd">            available arguments.</span>
</span><span id="1-1001"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1002">        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;scope&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="1-1003">
</span><span id="1-1004">        <span class="n">client</span> <span class="o">=</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span>
</span><span id="1-1005">
</span><span id="1-1006">        <span class="n">configuration_instrumenter</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;instrumenter&quot;</span><span class="p">]</span>
</span><span id="1-1007">
</span><span id="1-1008">        <span class="k">if</span> <span class="n">instrumenter</span> <span class="o">!=</span> <span class="n">configuration_instrumenter</span><span class="p">:</span>
</span><span id="1-1009">            <span class="k">return</span> <span class="n">NoOpSpan</span><span class="p">()</span>
</span><span id="1-1010">
</span><span id="1-1011">        <span class="n">custom_sampling_context</span> <span class="o">=</span> <span class="n">custom_sampling_context</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="1-1012">
</span><span id="1-1013">        <span class="c1"># kwargs at this point has type TransactionKwargs, since we have removed</span>
</span><span id="1-1014">        <span class="c1"># the client and custom_sampling_context from it.</span>
</span><span id="1-1015">        <span class="n">transaction_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>  <span class="c1"># type: TransactionKwargs</span>
</span><span id="1-1016">
</span><span id="1-1017">        <span class="c1"># if we haven&#39;t been given a transaction, make one</span>
</span><span id="1-1018">        <span class="k">if</span> <span class="n">transaction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1019">            <span class="n">transaction</span> <span class="o">=</span> <span class="n">Transaction</span><span class="p">(</span><span class="o">**</span><span class="n">transaction_kwargs</span><span class="p">)</span>
</span><span id="1-1020">
</span><span id="1-1021">        <span class="c1"># use traces_sample_rate, traces_sampler, and/or inheritance to make a</span>
</span><span id="1-1022">        <span class="c1"># sampling decision</span>
</span><span id="1-1023">        <span class="n">sampling_context</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="1-1024">            <span class="s2">&quot;transaction_context&quot;</span><span class="p">:</span> <span class="n">transaction</span><span class="o">.</span><span class="n">to_json</span><span class="p">(),</span>
</span><span id="1-1025">            <span class="s2">&quot;parent_sampled&quot;</span><span class="p">:</span> <span class="n">transaction</span><span class="o">.</span><span class="n">parent_sampled</span><span class="p">,</span>
</span><span id="1-1026">        <span class="p">}</span>
</span><span id="1-1027">        <span class="n">sampling_context</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">custom_sampling_context</span><span class="p">)</span>
</span><span id="1-1028">        <span class="n">transaction</span><span class="o">.</span><span class="n">_set_initial_sampling_decision</span><span class="p">(</span><span class="n">sampling_context</span><span class="o">=</span><span class="n">sampling_context</span><span class="p">)</span>
</span><span id="1-1029">
</span><span id="1-1030">        <span class="n">profile</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span>
</span><span id="1-1031">        <span class="n">profile</span><span class="o">.</span><span class="n">_set_initial_sampling_decision</span><span class="p">(</span><span class="n">sampling_context</span><span class="o">=</span><span class="n">sampling_context</span><span class="p">)</span>
</span><span id="1-1032">
</span><span id="1-1033">        <span class="c1"># we don&#39;t bother to keep spans if we already know we&#39;re not going to</span>
</span><span id="1-1034">        <span class="c1"># send the transaction</span>
</span><span id="1-1035">        <span class="k">if</span> <span class="n">transaction</span><span class="o">.</span><span class="n">sampled</span><span class="p">:</span>
</span><span id="1-1036">            <span class="n">max_spans</span> <span class="o">=</span> <span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;_experiments&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_spans&quot;</span><span class="p">))</span> <span class="ow">or</span> <span class="mi">1000</span>
</span><span id="1-1037">            <span class="n">transaction</span><span class="o">.</span><span class="n">init_span_recorder</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="n">max_spans</span><span class="p">)</span>
</span><span id="1-1038">
</span><span id="1-1039">        <span class="k">return</span> <span class="n">transaction</span></div>

</span><span id="1-1040">
<div class="viewcode-block" id="Scope.start_span">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.start_span">[docs]</a>
</span><span id="1-1041">    <span class="k">def</span> <span class="nf">start_span</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrumenter</span><span class="o">=</span><span class="n">INSTRUMENTER</span><span class="o">.</span><span class="n">SENTRY</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="1-1042">        <span class="c1"># type: (str, Any) -&gt; Span</span>
</span><span id="1-1043"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-1044"><span class="sd">        Start a span whose parent is the currently active span or transaction, if any.</span>
</span><span id="1-1045">
</span><span id="1-1046"><span class="sd">        The return value is a :py:class:`sentry_sdk.tracing.Span` instance,</span>
</span><span id="1-1047"><span class="sd">        typically used as a context manager to start and stop timing in a `with`</span>
</span><span id="1-1048"><span class="sd">        block.</span>
</span><span id="1-1049">
</span><span id="1-1050"><span class="sd">        Only spans contained in a transaction are sent to Sentry. Most</span>
</span><span id="1-1051"><span class="sd">        integrations start a transaction at the appropriate time, for example</span>
</span><span id="1-1052"><span class="sd">        for every incoming HTTP request. Use</span>
</span><span id="1-1053"><span class="sd">        :py:meth:`sentry_sdk.start_transaction` to start a new transaction when</span>
</span><span id="1-1054"><span class="sd">        one is not already in progress.</span>
</span><span id="1-1055">
</span><span id="1-1056"><span class="sd">        For supported `**kwargs` see :py:class:`sentry_sdk.tracing.Span`.</span>
</span><span id="1-1057"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1058">        <span class="k">with</span> <span class="n">new_scope</span><span class="p">():</span>
</span><span id="1-1059">            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;scope&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="1-1060">
</span><span id="1-1061">            <span class="n">client</span> <span class="o">=</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span>
</span><span id="1-1062">
</span><span id="1-1063">            <span class="n">configuration_instrumenter</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;instrumenter&quot;</span><span class="p">]</span>
</span><span id="1-1064">
</span><span id="1-1065">            <span class="k">if</span> <span class="n">instrumenter</span> <span class="o">!=</span> <span class="n">configuration_instrumenter</span><span class="p">:</span>
</span><span id="1-1066">                <span class="k">return</span> <span class="n">NoOpSpan</span><span class="p">()</span>
</span><span id="1-1067">
</span><span id="1-1068">            <span class="c1"># get current span or transaction</span>
</span><span id="1-1069">            <span class="n">span</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">span</span> <span class="ow">or</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_isolation_scope</span><span class="p">()</span><span class="o">.</span><span class="n">span</span>
</span><span id="1-1070">
</span><span id="1-1071">            <span class="k">if</span> <span class="n">span</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1072">                <span class="c1"># New spans get the `trace_id`` from the scope</span>
</span><span id="1-1073">                <span class="k">if</span> <span class="s2">&quot;trace_id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="1-1074">
</span><span id="1-1075">                    <span class="n">trace_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_propagation_context</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;trace_id&quot;</span><span class="p">)</span>
</span><span id="1-1076">                    <span class="k">if</span> <span class="n">trace_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1077">                        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;trace_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace_id</span>
</span><span id="1-1078">
</span><span id="1-1079">                <span class="n">span</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="1-1080">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-1081">                <span class="c1"># Children take `trace_id`` from the parent span.</span>
</span><span id="1-1082">                <span class="n">span</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="n">start_child</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="1-1083">
</span><span id="1-1084">            <span class="k">return</span> <span class="n">span</span></div>

</span><span id="1-1085">
<div class="viewcode-block" id="Scope.continue_trace">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.continue_trace">[docs]</a>
</span><span id="1-1086">    <span class="k">def</span> <span class="nf">continue_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ_or_headers</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="1-1087">        <span class="c1"># type: (Dict[str, Any], Optional[str], Optional[str], Optional[str]) -&gt; Transaction</span>
</span><span id="1-1088"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-1089"><span class="sd">        Sets the propagation context from environment or headers and returns a transaction.</span>
</span><span id="1-1090"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1091">        <span class="bp">self</span><span class="o">.</span><span class="n">generate_propagation_context</span><span class="p">(</span><span class="n">environ_or_headers</span><span class="p">)</span>
</span><span id="1-1092">
</span><span id="1-1093">        <span class="n">transaction</span> <span class="o">=</span> <span class="n">Transaction</span><span class="o">.</span><span class="n">continue_from_headers</span><span class="p">(</span>
</span><span id="1-1094">            <span class="n">normalize_incoming_data</span><span class="p">(</span><span class="n">environ_or_headers</span><span class="p">),</span>
</span><span id="1-1095">            <span class="n">op</span><span class="o">=</span><span class="n">op</span><span class="p">,</span>
</span><span id="1-1096">            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="1-1097">            <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
</span><span id="1-1098">        <span class="p">)</span>
</span><span id="1-1099">
</span><span id="1-1100">        <span class="k">return</span> <span class="n">transaction</span></div>

</span><span id="1-1101">
<div class="viewcode-block" id="Scope.capture_event">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.capture_event">[docs]</a>
</span><span id="1-1102">    <span class="k">def</span> <span class="nf">capture_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">scope_kwargs</span><span class="p">):</span>
</span><span id="1-1103">        <span class="c1"># type: (Event, Optional[Hint], Optional[Scope], Any) -&gt; Optional[str]</span>
</span><span id="1-1104"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-1105"><span class="sd">        Captures an event.</span>
</span><span id="1-1106">
</span><span id="1-1107"><span class="sd">        Merges given scope data and calls :py:meth:`sentry_sdk.client._Client.capture_event`.</span>
</span><span id="1-1108">
</span><span id="1-1109"><span class="sd">        :param event: A ready-made event that can be directly sent to Sentry.</span>
</span><span id="1-1110">
</span><span id="1-1111"><span class="sd">        :param hint: Contains metadata about the event that can be read from `before_send`, such as the original exception object or a HTTP request object.</span>
</span><span id="1-1112">
</span><span id="1-1113"><span class="sd">        :param scope: An optional :py:class:`sentry_sdk.Scope` to apply to events.</span>
</span><span id="1-1114"><span class="sd">            The `scope` and `scope_kwargs` parameters are mutually exclusive.</span>
</span><span id="1-1115">
</span><span id="1-1116"><span class="sd">        :param scope_kwargs: Optional data to apply to event.</span>
</span><span id="1-1117"><span class="sd">            For supported `**scope_kwargs` see :py:meth:`sentry_sdk.Scope.update_from_kwargs`.</span>
</span><span id="1-1118"><span class="sd">            The `scope` and `scope_kwargs` parameters are mutually exclusive.</span>
</span><span id="1-1119">
</span><span id="1-1120"><span class="sd">        :returns: An `event_id` if the SDK decided to send the event (see :py:meth:`sentry_sdk.client._Client.capture_event`).</span>
</span><span id="1-1121"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1122">        <span class="n">scope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_merge_scopes</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">scope_kwargs</span><span class="p">)</span>
</span><span id="1-1123">
</span><span id="1-1124">        <span class="k">return</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span><span class="o">.</span><span class="n">capture_event</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="n">hint</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="n">scope</span><span class="p">)</span></div>

</span><span id="1-1125">
<div class="viewcode-block" id="Scope.capture_message">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.capture_message">[docs]</a>
</span><span id="1-1126">    <span class="k">def</span> <span class="nf">capture_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">scope_kwargs</span><span class="p">):</span>
</span><span id="1-1127">        <span class="c1"># type: (str, Optional[LogLevelStr], Optional[Scope], Any) -&gt; Optional[str]</span>
</span><span id="1-1128"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-1129"><span class="sd">        Captures a message.</span>
</span><span id="1-1130">
</span><span id="1-1131"><span class="sd">        :param message: The string to send as the message.</span>
</span><span id="1-1132">
</span><span id="1-1133"><span class="sd">        :param level: If no level is provided, the default level is `info`.</span>
</span><span id="1-1134">
</span><span id="1-1135"><span class="sd">        :param scope: An optional :py:class:`sentry_sdk.Scope` to apply to events.</span>
</span><span id="1-1136"><span class="sd">            The `scope` and `scope_kwargs` parameters are mutually exclusive.</span>
</span><span id="1-1137">
</span><span id="1-1138"><span class="sd">        :param scope_kwargs: Optional data to apply to event.</span>
</span><span id="1-1139"><span class="sd">            For supported `**scope_kwargs` see :py:meth:`sentry_sdk.Scope.update_from_kwargs`.</span>
</span><span id="1-1140"><span class="sd">            The `scope` and `scope_kwargs` parameters are mutually exclusive.</span>
</span><span id="1-1141">
</span><span id="1-1142"><span class="sd">        :returns: An `event_id` if the SDK decided to send the event (see :py:meth:`sentry_sdk.client._Client.capture_event`).</span>
</span><span id="1-1143"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1144">        <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1145">            <span class="n">level</span> <span class="o">=</span> <span class="s2">&quot;info&quot;</span>
</span><span id="1-1146">
</span><span id="1-1147">        <span class="n">event</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="1-1148">            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
</span><span id="1-1149">            <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="n">level</span><span class="p">,</span>
</span><span id="1-1150">        <span class="p">}</span>  <span class="c1"># type: Event</span>
</span><span id="1-1151">
</span><span id="1-1152">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">capture_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="n">scope</span><span class="p">,</span> <span class="o">**</span><span class="n">scope_kwargs</span><span class="p">)</span></div>

</span><span id="1-1153">
<div class="viewcode-block" id="Scope.capture_exception">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.capture_exception">[docs]</a>
</span><span id="1-1154">    <span class="k">def</span> <span class="nf">capture_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">scope_kwargs</span><span class="p">):</span>
</span><span id="1-1155">        <span class="c1"># type: (Optional[Union[BaseException, ExcInfo]], Optional[Scope], Any) -&gt; Optional[str]</span>
</span><span id="1-1156"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Captures an exception.</span>
</span><span id="1-1157">
</span><span id="1-1158"><span class="sd">        :param error: An exception to capture. If `None`, `sys.exc_info()` will be used.</span>
</span><span id="1-1159">
</span><span id="1-1160"><span class="sd">        :param scope: An optional :py:class:`sentry_sdk.Scope` to apply to events.</span>
</span><span id="1-1161"><span class="sd">            The `scope` and `scope_kwargs` parameters are mutually exclusive.</span>
</span><span id="1-1162">
</span><span id="1-1163"><span class="sd">        :param scope_kwargs: Optional data to apply to event.</span>
</span><span id="1-1164"><span class="sd">            For supported `**scope_kwargs` see :py:meth:`sentry_sdk.Scope.update_from_kwargs`.</span>
</span><span id="1-1165"><span class="sd">            The `scope` and `scope_kwargs` parameters are mutually exclusive.</span>
</span><span id="1-1166">
</span><span id="1-1167"><span class="sd">        :returns: An `event_id` if the SDK decided to send the event (see :py:meth:`sentry_sdk.client._Client.capture_event`).</span>
</span><span id="1-1168"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1169">        <span class="k">if</span> <span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1170">            <span class="n">exc_info</span> <span class="o">=</span> <span class="n">exc_info_from_error</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
</span><span id="1-1171">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-1172">            <span class="n">exc_info</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
</span><span id="1-1173">
</span><span id="1-1174">        <span class="n">event</span><span class="p">,</span> <span class="n">hint</span> <span class="o">=</span> <span class="n">event_from_exception</span><span class="p">(</span>
</span><span id="1-1175">            <span class="n">exc_info</span><span class="p">,</span> <span class="n">client_options</span><span class="o">=</span><span class="n">Scope</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span><span class="o">.</span><span class="n">options</span>
</span><span id="1-1176">        <span class="p">)</span>
</span><span id="1-1177">
</span><span id="1-1178">        <span class="k">try</span><span class="p">:</span>
</span><span id="1-1179">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">capture_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="n">hint</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="n">scope</span><span class="p">,</span> <span class="o">**</span><span class="n">scope_kwargs</span><span class="p">)</span>
</span><span id="1-1180">        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="1-1181">            <span class="bp">self</span><span class="o">.</span><span class="n">_capture_internal_exception</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())</span>
</span><span id="1-1182">
</span><span id="1-1183">        <span class="k">return</span> <span class="kc">None</span></div>

</span><span id="1-1184">
</span><span id="1-1185">    <span class="k">def</span> <span class="nf">_capture_internal_exception</span><span class="p">(</span>
</span><span id="1-1186">        <span class="bp">self</span><span class="p">,</span> <span class="n">exc_info</span>  <span class="c1"># type: Any</span>
</span><span id="1-1187">    <span class="p">):</span>
</span><span id="1-1188">        <span class="c1"># type: (...) -&gt; Any</span>
</span><span id="1-1189"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-1190"><span class="sd">        Capture an exception that is likely caused by a bug in the SDK</span>
</span><span id="1-1191"><span class="sd">        itself.</span>
</span><span id="1-1192">
</span><span id="1-1193"><span class="sd">        These exceptions do not end up in Sentry and are just logged instead.</span>
</span><span id="1-1194"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1195">        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Internal error in sentry_sdk&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="n">exc_info</span><span class="p">)</span>
</span><span id="1-1196">
<div class="viewcode-block" id="Scope.start_session">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.start_session">[docs]</a>
</span><span id="1-1197">    <span class="k">def</span> <span class="nf">start_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="1-1198">        <span class="c1"># type: (*Any, **Any) -&gt; None</span>
</span><span id="1-1199"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Starts a new session.&quot;&quot;&quot;</span>
</span><span id="1-1200">        <span class="n">session_mode</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;session_mode&quot;</span><span class="p">,</span> <span class="s2">&quot;application&quot;</span><span class="p">)</span>
</span><span id="1-1201">
</span><span id="1-1202">        <span class="bp">self</span><span class="o">.</span><span class="n">end_session</span><span class="p">()</span>
</span><span id="1-1203">
</span><span id="1-1204">        <span class="n">client</span> <span class="o">=</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span>
</span><span id="1-1205">        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span>
</span><span id="1-1206">            <span class="n">release</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;release&quot;</span><span class="p">),</span>
</span><span id="1-1207">            <span class="n">environment</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;environment&quot;</span><span class="p">),</span>
</span><span id="1-1208">            <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="p">,</span>
</span><span id="1-1209">            <span class="n">session_mode</span><span class="o">=</span><span class="n">session_mode</span><span class="p">,</span>
</span><span id="1-1210">        <span class="p">)</span></div>

</span><span id="1-1211">
<div class="viewcode-block" id="Scope.end_session">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.end_session">[docs]</a>
</span><span id="1-1212">    <span class="k">def</span> <span class="nf">end_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="1-1213">        <span class="c1"># type: (*Any, **Any) -&gt; None</span>
</span><span id="1-1214"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ends the current session if there is one.&quot;&quot;&quot;</span>
</span><span id="1-1215">        <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span>
</span><span id="1-1216">        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-1217">
</span><span id="1-1218">        <span class="k">if</span> <span class="n">session</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1219">            <span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="1-1220">            <span class="n">Scope</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span><span class="o">.</span><span class="n">capture_session</span><span class="p">(</span><span class="n">session</span><span class="p">)</span></div>

</span><span id="1-1221">
<div class="viewcode-block" id="Scope.stop_auto_session_tracking">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.stop_auto_session_tracking">[docs]</a>
</span><span id="1-1222">    <span class="k">def</span> <span class="nf">stop_auto_session_tracking</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="1-1223">        <span class="c1"># type: (*Any, **Any) -&gt; None</span>
</span><span id="1-1224"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stops automatic session tracking.</span>
</span><span id="1-1225">
</span><span id="1-1226"><span class="sd">        This temporarily session tracking for the current scope when called.</span>
</span><span id="1-1227"><span class="sd">        To resume session tracking call `resume_auto_session_tracking`.</span>
</span><span id="1-1228"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1229">        <span class="bp">self</span><span class="o">.</span><span class="n">end_session</span><span class="p">()</span>
</span><span id="1-1230">        <span class="bp">self</span><span class="o">.</span><span class="n">_force_auto_session_tracking</span> <span class="o">=</span> <span class="kc">False</span></div>

</span><span id="1-1231">
<div class="viewcode-block" id="Scope.resume_auto_session_tracking">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.resume_auto_session_tracking">[docs]</a>
</span><span id="1-1232">    <span class="k">def</span> <span class="nf">resume_auto_session_tracking</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-1233">        <span class="c1"># type: (...) -&gt; None</span>
</span><span id="1-1234"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Resumes automatic session tracking for the current scope if</span>
</span><span id="1-1235"><span class="sd">        disabled earlier.  This requires that generally automatic session</span>
</span><span id="1-1236"><span class="sd">        tracking is enabled.</span>
</span><span id="1-1237"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1238">        <span class="bp">self</span><span class="o">.</span><span class="n">_force_auto_session_tracking</span> <span class="o">=</span> <span class="kc">None</span></div>

</span><span id="1-1239">
<div class="viewcode-block" id="Scope.add_event_processor">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.add_event_processor">[docs]</a>
</span><span id="1-1240">    <span class="k">def</span> <span class="nf">add_event_processor</span><span class="p">(</span>
</span><span id="1-1241">        <span class="bp">self</span><span class="p">,</span> <span class="n">func</span>  <span class="c1"># type: EventProcessor</span>
</span><span id="1-1242">    <span class="p">):</span>
</span><span id="1-1243">        <span class="c1"># type: (...) -&gt; None</span>
</span><span id="1-1244"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a scope local event processor on the scope.</span>
</span><span id="1-1245">
</span><span id="1-1246"><span class="sd">        :param func: This function behaves like `before_send.`</span>
</span><span id="1-1247"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1248">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_event_processors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
</span><span id="1-1249">            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="1-1250">                <span class="s2">&quot;Too many event processors on scope! Clearing list to free up some memory: </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="1-1251">                <span class="bp">self</span><span class="o">.</span><span class="n">_event_processors</span><span class="p">,</span>
</span><span id="1-1252">            <span class="p">)</span>
</span><span id="1-1253">            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event_processors</span><span class="p">[:]</span>
</span><span id="1-1254">
</span><span id="1-1255">        <span class="bp">self</span><span class="o">.</span><span class="n">_event_processors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></div>

</span><span id="1-1256">
<div class="viewcode-block" id="Scope.add_error_processor">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.add_error_processor">[docs]</a>
</span><span id="1-1257">    <span class="k">def</span> <span class="nf">add_error_processor</span><span class="p">(</span>
</span><span id="1-1258">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1259">        <span class="n">func</span><span class="p">,</span>  <span class="c1"># type: ErrorProcessor</span>
</span><span id="1-1260">        <span class="bp">cls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[Type[BaseException]]</span>
</span><span id="1-1261">    <span class="p">):</span>
</span><span id="1-1262">        <span class="c1"># type: (...) -&gt; None</span>
</span><span id="1-1263"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a scope local error processor on the scope.</span>
</span><span id="1-1264">
</span><span id="1-1265"><span class="sd">        :param func: A callback that works similar to an event processor but is invoked with the original exception info triple as second argument.</span>
</span><span id="1-1266">
</span><span id="1-1267"><span class="sd">        :param cls: Optionally, only process exceptions of this type.</span>
</span><span id="1-1268"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1269">        <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1270">            <span class="n">cls_</span> <span class="o">=</span> <span class="bp">cls</span>  <span class="c1"># For mypy.</span>
</span><span id="1-1271">            <span class="n">real_func</span> <span class="o">=</span> <span class="n">func</span>
</span><span id="1-1272">
</span><span id="1-1273">            <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">exc_info</span><span class="p">):</span>
</span><span id="1-1274">                <span class="c1"># type: (Event, ExcInfo) -&gt; Optional[Event]</span>
</span><span id="1-1275">                <span class="k">try</span><span class="p">:</span>
</span><span id="1-1276">                    <span class="n">is_inst</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc_info</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cls_</span><span class="p">)</span>
</span><span id="1-1277">                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="1-1278">                    <span class="n">is_inst</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-1279">                <span class="k">if</span> <span class="n">is_inst</span><span class="p">:</span>
</span><span id="1-1280">                    <span class="k">return</span> <span class="n">real_func</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">exc_info</span><span class="p">)</span>
</span><span id="1-1281">                <span class="k">return</span> <span class="n">event</span>
</span><span id="1-1282">
</span><span id="1-1283">        <span class="bp">self</span><span class="o">.</span><span class="n">_error_processors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></div>

</span><span id="1-1284">
</span><span id="1-1285">    <span class="k">def</span> <span class="nf">_apply_level_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span id="1-1286">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span id="1-1287">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1288">            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_level</span>
</span><span id="1-1289">
</span><span id="1-1290">    <span class="k">def</span> <span class="nf">_apply_breadcrumbs_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span id="1-1291">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span id="1-1292">        <span class="n">event</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;breadcrumbs&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;values&quot;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
</span><span id="1-1293">            <span class="bp">self</span><span class="o">.</span><span class="n">_breadcrumbs</span>
</span><span id="1-1294">        <span class="p">)</span>
</span><span id="1-1295">
</span><span id="1-1296">    <span class="k">def</span> <span class="nf">_apply_user_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span id="1-1297">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span id="1-1298">        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1299">            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span>
</span><span id="1-1300">
</span><span id="1-1301">    <span class="k">def</span> <span class="nf">_apply_transaction_name_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span id="1-1302">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span id="1-1303">        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;transaction&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transaction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1304">            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;transaction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transaction</span>
</span><span id="1-1305">
</span><span id="1-1306">    <span class="k">def</span> <span class="nf">_apply_transaction_info_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span id="1-1307">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span id="1-1308">        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;transaction_info&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transaction_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1309">            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;transaction_info&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transaction_info</span>
</span><span id="1-1310">
</span><span id="1-1311">    <span class="k">def</span> <span class="nf">_apply_fingerprint_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span id="1-1312">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span id="1-1313">        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fingerprint&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1314">            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;fingerprint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span>
</span><span id="1-1315">
</span><span id="1-1316">    <span class="k">def</span> <span class="nf">_apply_extra_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span id="1-1317">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span id="1-1318">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extras</span><span class="p">:</span>
</span><span id="1-1319">            <span class="n">event</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;extra&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_extras</span><span class="p">)</span>
</span><span id="1-1320">
</span><span id="1-1321">    <span class="k">def</span> <span class="nf">_apply_tags_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span id="1-1322">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span id="1-1323">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="p">:</span>
</span><span id="1-1324">            <span class="n">event</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="p">)</span>
</span><span id="1-1325">
</span><span id="1-1326">    <span class="k">def</span> <span class="nf">_apply_contexts_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span id="1-1327">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span id="1-1328">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="p">:</span>
</span><span id="1-1329">            <span class="n">event</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;contexts&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="p">)</span>
</span><span id="1-1330">
</span><span id="1-1331">        <span class="n">contexts</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;contexts&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="1-1332">
</span><span id="1-1333">        <span class="c1"># Add &quot;trace&quot; context</span>
</span><span id="1-1334">        <span class="k">if</span> <span class="n">contexts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;trace&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1335">            <span class="k">if</span> <span class="n">has_tracing_enabled</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1336">                <span class="n">contexts</span><span class="p">[</span><span class="s2">&quot;trace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span><span class="o">.</span><span class="n">get_trace_context</span><span class="p">()</span>
</span><span id="1-1337">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-1338">                <span class="n">contexts</span><span class="p">[</span><span class="s2">&quot;trace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trace_context</span><span class="p">()</span>
</span><span id="1-1339">
</span><span id="1-1340">    <span class="k">def</span> <span class="nf">_drop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cause</span><span class="p">,</span> <span class="n">ty</span><span class="p">):</span>
</span><span id="1-1341">        <span class="c1"># type: (Any, str) -&gt; Optional[Any]</span>
</span><span id="1-1342">        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">) dropped event&quot;</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="n">cause</span><span class="p">)</span>
</span><span id="1-1343">        <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-1344">
<div class="viewcode-block" id="Scope.run_error_processors">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.run_error_processors">[docs]</a>
</span><span id="1-1345">    <span class="k">def</span> <span class="nf">run_error_processors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">):</span>
</span><span id="1-1346">        <span class="c1"># type: (Event, Hint) -&gt; Optional[Event]</span>
</span><span id="1-1347"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-1348"><span class="sd">        Runs the error processors on the event and returns the modified event.</span>
</span><span id="1-1349"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1350">        <span class="n">exc_info</span> <span class="o">=</span> <span class="n">hint</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;exc_info&quot;</span><span class="p">)</span>
</span><span id="1-1351">        <span class="k">if</span> <span class="n">exc_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1352">            <span class="n">error_processors</span> <span class="o">=</span> <span class="n">chain</span><span class="p">(</span>
</span><span id="1-1353">                <span class="n">Scope</span><span class="o">.</span><span class="n">get_global_scope</span><span class="p">()</span><span class="o">.</span><span class="n">_error_processors</span><span class="p">,</span>
</span><span id="1-1354">                <span class="n">Scope</span><span class="o">.</span><span class="n">get_isolation_scope</span><span class="p">()</span><span class="o">.</span><span class="n">_error_processors</span><span class="p">,</span>
</span><span id="1-1355">                <span class="n">Scope</span><span class="o">.</span><span class="n">get_current_scope</span><span class="p">()</span><span class="o">.</span><span class="n">_error_processors</span><span class="p">,</span>
</span><span id="1-1356">            <span class="p">)</span>
</span><span id="1-1357">
</span><span id="1-1358">            <span class="k">for</span> <span class="n">error_processor</span> <span class="ow">in</span> <span class="n">error_processors</span><span class="p">:</span>
</span><span id="1-1359">                <span class="n">new_event</span> <span class="o">=</span> <span class="n">error_processor</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">exc_info</span><span class="p">)</span>
</span><span id="1-1360">                <span class="k">if</span> <span class="n">new_event</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1361">                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drop</span><span class="p">(</span><span class="n">error_processor</span><span class="p">,</span> <span class="s2">&quot;error processor&quot;</span><span class="p">)</span>
</span><span id="1-1362">
</span><span id="1-1363">                <span class="n">event</span> <span class="o">=</span> <span class="n">new_event</span>
</span><span id="1-1364">
</span><span id="1-1365">        <span class="k">return</span> <span class="n">event</span></div>

</span><span id="1-1366">
<div class="viewcode-block" id="Scope.run_event_processors">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.run_event_processors">[docs]</a>
</span><span id="1-1367">    <span class="k">def</span> <span class="nf">run_event_processors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">):</span>
</span><span id="1-1368">        <span class="c1"># type: (Event, Hint) -&gt; Optional[Event]</span>
</span><span id="1-1369"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-1370"><span class="sd">        Runs the event processors on the event and returns the modified event.</span>
</span><span id="1-1371"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1372">        <span class="n">ty</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
</span><span id="1-1373">        <span class="n">is_check_in</span> <span class="o">=</span> <span class="n">ty</span> <span class="o">==</span> <span class="s2">&quot;check_in&quot;</span>
</span><span id="1-1374">
</span><span id="1-1375">        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_check_in</span><span class="p">:</span>
</span><span id="1-1376">            <span class="c1"># Get scopes without creating them to prevent infinite recursion</span>
</span><span id="1-1377">            <span class="n">isolation_scope</span> <span class="o">=</span> <span class="n">_isolation_scope</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="1-1378">            <span class="n">current_scope</span> <span class="o">=</span> <span class="n">_current_scope</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="1-1379">
</span><span id="1-1380">            <span class="n">event_processors</span> <span class="o">=</span> <span class="n">chain</span><span class="p">(</span>
</span><span id="1-1381">                <span class="n">global_event_processors</span><span class="p">,</span>
</span><span id="1-1382">                <span class="n">_global_scope</span> <span class="ow">and</span> <span class="n">_global_scope</span><span class="o">.</span><span class="n">_event_processors</span> <span class="ow">or</span> <span class="p">[],</span>
</span><span id="1-1383">                <span class="n">isolation_scope</span> <span class="ow">and</span> <span class="n">isolation_scope</span><span class="o">.</span><span class="n">_event_processors</span> <span class="ow">or</span> <span class="p">[],</span>
</span><span id="1-1384">                <span class="n">current_scope</span> <span class="ow">and</span> <span class="n">current_scope</span><span class="o">.</span><span class="n">_event_processors</span> <span class="ow">or</span> <span class="p">[],</span>
</span><span id="1-1385">            <span class="p">)</span>
</span><span id="1-1386">
</span><span id="1-1387">            <span class="k">for</span> <span class="n">event_processor</span> <span class="ow">in</span> <span class="n">event_processors</span><span class="p">:</span>
</span><span id="1-1388">                <span class="n">new_event</span> <span class="o">=</span> <span class="n">event</span>
</span><span id="1-1389">                <span class="k">with</span> <span class="n">capture_internal_exceptions</span><span class="p">():</span>
</span><span id="1-1390">                    <span class="n">new_event</span> <span class="o">=</span> <span class="n">event_processor</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">)</span>
</span><span id="1-1391">                <span class="k">if</span> <span class="n">new_event</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1392">                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drop</span><span class="p">(</span><span class="n">event_processor</span><span class="p">,</span> <span class="s2">&quot;event processor&quot;</span><span class="p">)</span>
</span><span id="1-1393">                <span class="n">event</span> <span class="o">=</span> <span class="n">new_event</span>
</span><span id="1-1394">
</span><span id="1-1395">        <span class="k">return</span> <span class="n">event</span></div>

</span><span id="1-1396">
<div class="viewcode-block" id="Scope.apply_to_event">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.apply_to_event">[docs]</a>
</span><span id="1-1397">    <span class="nd">@_disable_capture</span>
</span><span id="1-1398">    <span class="k">def</span> <span class="nf">apply_to_event</span><span class="p">(</span>
</span><span id="1-1399">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1400">        <span class="n">event</span><span class="p">,</span>  <span class="c1"># type: Event</span>
</span><span id="1-1401">        <span class="n">hint</span><span class="p">,</span>  <span class="c1"># type: Hint</span>
</span><span id="1-1402">        <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[Dict[str, Any]]</span>
</span><span id="1-1403">    <span class="p">):</span>
</span><span id="1-1404">        <span class="c1"># type: (...) -&gt; Optional[Event]</span>
</span><span id="1-1405"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Applies the information contained on the scope to the given event.&quot;&quot;&quot;</span>
</span><span id="1-1406">        <span class="n">ty</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
</span><span id="1-1407">        <span class="n">is_transaction</span> <span class="o">=</span> <span class="n">ty</span> <span class="o">==</span> <span class="s2">&quot;transaction&quot;</span>
</span><span id="1-1408">        <span class="n">is_check_in</span> <span class="o">=</span> <span class="n">ty</span> <span class="o">==</span> <span class="s2">&quot;check_in&quot;</span>
</span><span id="1-1409">
</span><span id="1-1410">        <span class="c1"># put all attachments into the hint. This lets callbacks play around</span>
</span><span id="1-1411">        <span class="c1"># with attachments. We also later pull this out of the hint when we</span>
</span><span id="1-1412">        <span class="c1"># create the envelope.</span>
</span><span id="1-1413">        <span class="n">attachments_to_send</span> <span class="o">=</span> <span class="n">hint</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attachments&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span>
</span><span id="1-1414">        <span class="k">for</span> <span class="n">attachment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attachments</span><span class="p">:</span>
</span><span id="1-1415">            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_transaction</span> <span class="ow">or</span> <span class="n">attachment</span><span class="o">.</span><span class="n">add_to_transactions</span><span class="p">:</span>
</span><span id="1-1416">                <span class="n">attachments_to_send</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attachment</span><span class="p">)</span>
</span><span id="1-1417">        <span class="n">hint</span><span class="p">[</span><span class="s2">&quot;attachments&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">attachments_to_send</span>
</span><span id="1-1418">
</span><span id="1-1419">        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_contexts_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span id="1-1420">
</span><span id="1-1421">        <span class="k">if</span> <span class="n">is_check_in</span><span class="p">:</span>
</span><span id="1-1422">            <span class="c1"># Check-ins only support the trace context, strip all others</span>
</span><span id="1-1423">            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;contexts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="1-1424">                <span class="s2">&quot;trace&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;contexts&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;trace&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="1-1425">            <span class="p">}</span>
</span><span id="1-1426">
</span><span id="1-1427">        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_check_in</span><span class="p">:</span>
</span><span id="1-1428">            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_level_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span id="1-1429">            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_fingerprint_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span id="1-1430">            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_user_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span id="1-1431">            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_transaction_name_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span id="1-1432">            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_transaction_info_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span id="1-1433">            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_tags_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span id="1-1434">            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_extra_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span id="1-1435">
</span><span id="1-1436">        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_transaction</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_check_in</span><span class="p">:</span>
</span><span id="1-1437">            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_breadcrumbs_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span id="1-1438">
</span><span id="1-1439">        <span class="n">event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_error_processors</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">)</span>
</span><span id="1-1440">        <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1441">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-1442">
</span><span id="1-1443">        <span class="n">event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_event_processors</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">)</span>
</span><span id="1-1444">        <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1445">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-1446">
</span><span id="1-1447">        <span class="k">return</span> <span class="n">event</span></div>

</span><span id="1-1448">
<div class="viewcode-block" id="Scope.update_from_scope">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.update_from_scope">[docs]</a>
</span><span id="1-1449">    <span class="k">def</span> <span class="nf">update_from_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">):</span>
</span><span id="1-1450">        <span class="c1"># type: (Scope) -&gt; None</span>
</span><span id="1-1451"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the scope with another scope&#39;s data.&quot;&quot;&quot;</span>
</span><span id="1-1452">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1453">            <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">_level</span>
</span><span id="1-1454">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_fingerprint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1455">            <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">_fingerprint</span>
</span><span id="1-1456">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_transaction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1457">            <span class="bp">self</span><span class="o">.</span><span class="n">_transaction</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">_transaction</span>
</span><span id="1-1458">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_transaction_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1459">            <span class="bp">self</span><span class="o">.</span><span class="n">_transaction_info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">_transaction_info</span><span class="p">)</span>
</span><span id="1-1460">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1461">            <span class="bp">self</span><span class="o">.</span><span class="n">_user</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">_user</span>
</span><span id="1-1462">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_tags</span><span class="p">:</span>
</span><span id="1-1463">            <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">_tags</span><span class="p">)</span>
</span><span id="1-1464">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_contexts</span><span class="p">:</span>
</span><span id="1-1465">            <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">_contexts</span><span class="p">)</span>
</span><span id="1-1466">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_extras</span><span class="p">:</span>
</span><span id="1-1467">            <span class="bp">self</span><span class="o">.</span><span class="n">_extras</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">_extras</span><span class="p">)</span>
</span><span id="1-1468">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_breadcrumbs</span><span class="p">:</span>
</span><span id="1-1469">            <span class="bp">self</span><span class="o">.</span><span class="n">_breadcrumbs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">_breadcrumbs</span><span class="p">)</span>
</span><span id="1-1470">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_span</span><span class="p">:</span>
</span><span id="1-1471">            <span class="bp">self</span><span class="o">.</span><span class="n">_span</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">_span</span>
</span><span id="1-1472">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_attachments</span><span class="p">:</span>
</span><span id="1-1473">            <span class="bp">self</span><span class="o">.</span><span class="n">_attachments</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">_attachments</span><span class="p">)</span>
</span><span id="1-1474">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_profile</span><span class="p">:</span>
</span><span id="1-1475">            <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">_profile</span>
</span><span id="1-1476">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_propagation_context</span><span class="p">:</span>
</span><span id="1-1477">            <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">_propagation_context</span>
</span><span id="1-1478">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_session</span><span class="p">:</span>
</span><span id="1-1479">            <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">_session</span></div>

</span><span id="1-1480">
<div class="viewcode-block" id="Scope.update_from_kwargs">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.api.Scope.update_from_kwargs">[docs]</a>
</span><span id="1-1481">    <span class="k">def</span> <span class="nf">update_from_kwargs</span><span class="p">(</span>
</span><span id="1-1482">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1483">        <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[Any]</span>
</span><span id="1-1484">        <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[LogLevelStr]</span>
</span><span id="1-1485">        <span class="n">extras</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[Dict[str, Any]]</span>
</span><span id="1-1486">        <span class="n">contexts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[Dict[str, Any]]</span>
</span><span id="1-1487">        <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[Dict[str, str]]</span>
</span><span id="1-1488">        <span class="n">fingerprint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[List[str]]</span>
</span><span id="1-1489">    <span class="p">):</span>
</span><span id="1-1490">        <span class="c1"># type: (...) -&gt; None</span>
</span><span id="1-1491"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the scope&#39;s attributes.&quot;&quot;&quot;</span>
</span><span id="1-1492">        <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1493">            <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="n">level</span>
</span><span id="1-1494">        <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1495">            <span class="bp">self</span><span class="o">.</span><span class="n">_user</span> <span class="o">=</span> <span class="n">user</span>
</span><span id="1-1496">        <span class="k">if</span> <span class="n">extras</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1497">            <span class="bp">self</span><span class="o">.</span><span class="n">_extras</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">extras</span><span class="p">)</span>
</span><span id="1-1498">        <span class="k">if</span> <span class="n">contexts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1499">            <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">contexts</span><span class="p">)</span>
</span><span id="1-1500">        <span class="k">if</span> <span class="n">tags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1501">            <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
</span><span id="1-1502">        <span class="k">if</span> <span class="n">fingerprint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1503">            <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span> <span class="o">=</span> <span class="n">fingerprint</span></div>

</span><span id="1-1504">
</span><span id="1-1505">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-1506">        <span class="c1"># type: () -&gt; str</span>
</span><span id="1-1507">        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2"> id=</span><span class="si">%s</span><span class="s2"> name=</span><span class="si">%s</span><span class="s2"> type=</span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span>
</span><span id="1-1508">            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
</span><span id="1-1509">            <span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)),</span>
</span><span id="1-1510">            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span>
</span><span id="1-1511">            <span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="p">,</span>
</span><span id="1-1512">        <span class="p">)</span></div>

</span><span id="1-1513">
</span><span id="1-1514">
<div class="viewcode-block" id="new_scope">
<a class="viewcode-back" href="../../api.html#sentry_sdk.api.new_scope">[docs]</a>
</span><span id="1-1515"><span class="nd">@contextmanager</span>
</span><span id="1-1516"><span class="k">def</span> <span class="nf">new_scope</span><span class="p">():</span>
</span><span id="1-1517">    <span class="c1"># type: () -&gt; Generator[Scope, None, None]</span>
</span><span id="1-1518"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-1519"><span class="sd">    .. versionadded:: 2.0.0</span>
</span><span id="1-1520">
</span><span id="1-1521"><span class="sd">    Context manager that forks the current scope and runs the wrapped code in it.</span>
</span><span id="1-1522"><span class="sd">    After the wrapped code is executed, the original scope is restored.</span>
</span><span id="1-1523">
</span><span id="1-1524"><span class="sd">    Example Usage:</span>
</span><span id="1-1525">
</span><span id="1-1526"><span class="sd">    .. code-block:: python</span>
</span><span id="1-1527">
</span><span id="1-1528"><span class="sd">        import sentry_sdk</span>
</span><span id="1-1529">
</span><span id="1-1530"><span class="sd">        with sentry_sdk.new_scope() as scope:</span>
</span><span id="1-1531"><span class="sd">            scope.set_tag(&quot;color&quot;, &quot;green&quot;)</span>
</span><span id="1-1532"><span class="sd">            sentry_sdk.capture_message(&quot;hello&quot;) # will include `color` tag.</span>
</span><span id="1-1533">
</span><span id="1-1534"><span class="sd">        sentry_sdk.capture_message(&quot;hello, again&quot;) # will NOT include `color` tag.</span>
</span><span id="1-1535">
</span><span id="1-1536"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-1537">    <span class="c1"># fork current scope</span>
</span><span id="1-1538">    <span class="n">current_scope</span> <span class="o">=</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_current_scope</span><span class="p">()</span>
</span><span id="1-1539">    <span class="n">new_scope</span> <span class="o">=</span> <span class="n">current_scope</span><span class="o">.</span><span class="n">fork</span><span class="p">()</span>
</span><span id="1-1540">    <span class="n">token</span> <span class="o">=</span> <span class="n">_current_scope</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">new_scope</span><span class="p">)</span>
</span><span id="1-1541">
</span><span id="1-1542">    <span class="k">try</span><span class="p">:</span>
</span><span id="1-1543">        <span class="k">yield</span> <span class="n">new_scope</span>
</span><span id="1-1544">
</span><span id="1-1545">    <span class="k">finally</span><span class="p">:</span>
</span><span id="1-1546">        <span class="c1"># restore original scope</span>
</span><span id="1-1547">        <span class="n">_current_scope</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">token</span><span class="p">)</span></div>

</span><span id="1-1548">
</span><span id="1-1549">
</span><span id="1-1550"><span class="nd">@contextmanager</span>
</span><span id="1-1551"><span class="k">def</span> <span class="nf">use_scope</span><span class="p">(</span><span class="n">scope</span><span class="p">):</span>
</span><span id="1-1552">    <span class="c1"># type: (Scope) -&gt; Generator[Scope, None, None]</span>
</span><span id="1-1553"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-1554"><span class="sd">    .. versionadded:: 2.0.0</span>
</span><span id="1-1555">
</span><span id="1-1556"><span class="sd">    Context manager that uses the given `scope` and runs the wrapped code in it.</span>
</span><span id="1-1557"><span class="sd">    After the wrapped code is executed, the original scope is restored.</span>
</span><span id="1-1558">
</span><span id="1-1559"><span class="sd">    Example Usage:</span>
</span><span id="1-1560"><span class="sd">    Suppose the variable `scope` contains a `Scope` object, which is not currently</span>
</span><span id="1-1561"><span class="sd">    the active scope.</span>
</span><span id="1-1562">
</span><span id="1-1563"><span class="sd">    .. code-block:: python</span>
</span><span id="1-1564">
</span><span id="1-1565"><span class="sd">        import sentry_sdk</span>
</span><span id="1-1566">
</span><span id="1-1567"><span class="sd">        with sentry_sdk.use_scope(scope):</span>
</span><span id="1-1568"><span class="sd">            scope.set_tag(&quot;color&quot;, &quot;green&quot;)</span>
</span><span id="1-1569"><span class="sd">            sentry_sdk.capture_message(&quot;hello&quot;) # will include `color` tag.</span>
</span><span id="1-1570">
</span><span id="1-1571"><span class="sd">        sentry_sdk.capture_message(&quot;hello, again&quot;) # will NOT include `color` tag.</span>
</span><span id="1-1572">
</span><span id="1-1573"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-1574">    <span class="c1"># set given scope as current scope</span>
</span><span id="1-1575">    <span class="n">token</span> <span class="o">=</span> <span class="n">_current_scope</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>
</span><span id="1-1576">
</span><span id="1-1577">    <span class="k">try</span><span class="p">:</span>
</span><span id="1-1578">        <span class="k">yield</span> <span class="n">scope</span>
</span><span id="1-1579">
</span><span id="1-1580">    <span class="k">finally</span><span class="p">:</span>
</span><span id="1-1581">        <span class="c1"># restore original scope</span>
</span><span id="1-1582">        <span class="n">_current_scope</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span><span id="1-1583">
</span><span id="1-1584">
</span><span id="1-1585"><span class="nd">@contextmanager</span>
</span><span id="1-1586"><span class="k">def</span> <span class="nf">isolation_scope</span><span class="p">():</span>
</span><span id="1-1587">    <span class="c1"># type: () -&gt; Generator[Scope, None, None]</span>
</span><span id="1-1588"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-1589"><span class="sd">    .. versionadded:: 2.0.0</span>
</span><span id="1-1590">
</span><span id="1-1591"><span class="sd">    Context manager that forks the current isolation scope and runs the wrapped code in it.</span>
</span><span id="1-1592"><span class="sd">    The current scope is also forked to not bleed data into the existing current scope.</span>
</span><span id="1-1593"><span class="sd">    After the wrapped code is executed, the original scopes are restored.</span>
</span><span id="1-1594">
</span><span id="1-1595"><span class="sd">    Example Usage:</span>
</span><span id="1-1596">
</span><span id="1-1597"><span class="sd">    .. code-block:: python</span>
</span><span id="1-1598">
</span><span id="1-1599"><span class="sd">        import sentry_sdk</span>
</span><span id="1-1600">
</span><span id="1-1601"><span class="sd">        with sentry_sdk.isolation_scope() as scope:</span>
</span><span id="1-1602"><span class="sd">            scope.set_tag(&quot;color&quot;, &quot;green&quot;)</span>
</span><span id="1-1603"><span class="sd">            sentry_sdk.capture_message(&quot;hello&quot;) # will include `color` tag.</span>
</span><span id="1-1604">
</span><span id="1-1605"><span class="sd">        sentry_sdk.capture_message(&quot;hello, again&quot;) # will NOT include `color` tag.</span>
</span><span id="1-1606">
</span><span id="1-1607"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-1608">    <span class="c1"># fork current scope</span>
</span><span id="1-1609">    <span class="n">current_scope</span> <span class="o">=</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_current_scope</span><span class="p">()</span>
</span><span id="1-1610">    <span class="n">forked_current_scope</span> <span class="o">=</span> <span class="n">current_scope</span><span class="o">.</span><span class="n">fork</span><span class="p">()</span>
</span><span id="1-1611">    <span class="n">current_token</span> <span class="o">=</span> <span class="n">_current_scope</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">forked_current_scope</span><span class="p">)</span>
</span><span id="1-1612">
</span><span id="1-1613">    <span class="c1"># fork isolation scope</span>
</span><span id="1-1614">    <span class="n">isolation_scope</span> <span class="o">=</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_isolation_scope</span><span class="p">()</span>
</span><span id="1-1615">    <span class="n">new_isolation_scope</span> <span class="o">=</span> <span class="n">isolation_scope</span><span class="o">.</span><span class="n">fork</span><span class="p">()</span>
</span><span id="1-1616">    <span class="n">isolation_token</span> <span class="o">=</span> <span class="n">_isolation_scope</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">new_isolation_scope</span><span class="p">)</span>
</span><span id="1-1617">
</span><span id="1-1618">    <span class="k">try</span><span class="p">:</span>
</span><span id="1-1619">        <span class="k">yield</span> <span class="n">new_isolation_scope</span>
</span><span id="1-1620">
</span><span id="1-1621">    <span class="k">finally</span><span class="p">:</span>
</span><span id="1-1622">        <span class="c1"># restore original scopes</span>
</span><span id="1-1623">        <span class="n">_current_scope</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">current_token</span><span class="p">)</span>
</span><span id="1-1624">        <span class="n">_isolation_scope</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">isolation_token</span><span class="p">)</span>
</span><span id="1-1625">
</span><span id="1-1626">
</span><span id="1-1627"><span class="nd">@contextmanager</span>
</span><span id="1-1628"><span class="k">def</span> <span class="nf">use_isolation_scope</span><span class="p">(</span><span class="n">isolation_scope</span><span class="p">):</span>
</span><span id="1-1629">    <span class="c1"># type: (Scope) -&gt; Generator[Scope, None, None]</span>
</span><span id="1-1630"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-1631"><span class="sd">    .. versionadded:: 2.0.0</span>
</span><span id="1-1632">
</span><span id="1-1633"><span class="sd">    Context manager that uses the given `isolation_scope` and runs the wrapped code in it.</span>
</span><span id="1-1634"><span class="sd">    The current scope is also forked to not bleed data into the existing current scope.</span>
</span><span id="1-1635"><span class="sd">    After the wrapped code is executed, the original scopes are restored.</span>
</span><span id="1-1636">
</span><span id="1-1637"><span class="sd">    Example Usage:</span>
</span><span id="1-1638">
</span><span id="1-1639"><span class="sd">    .. code-block:: python</span>
</span><span id="1-1640">
</span><span id="1-1641"><span class="sd">        import sentry_sdk</span>
</span><span id="1-1642">
</span><span id="1-1643"><span class="sd">        with sentry_sdk.isolation_scope() as scope:</span>
</span><span id="1-1644"><span class="sd">            scope.set_tag(&quot;color&quot;, &quot;green&quot;)</span>
</span><span id="1-1645"><span class="sd">            sentry_sdk.capture_message(&quot;hello&quot;) # will include `color` tag.</span>
</span><span id="1-1646">
</span><span id="1-1647"><span class="sd">        sentry_sdk.capture_message(&quot;hello, again&quot;) # will NOT include `color` tag.</span>
</span><span id="1-1648">
</span><span id="1-1649"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-1650">    <span class="c1"># fork current scope</span>
</span><span id="1-1651">    <span class="n">current_scope</span> <span class="o">=</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_current_scope</span><span class="p">()</span>
</span><span id="1-1652">    <span class="n">forked_current_scope</span> <span class="o">=</span> <span class="n">current_scope</span><span class="o">.</span><span class="n">fork</span><span class="p">()</span>
</span><span id="1-1653">    <span class="n">current_token</span> <span class="o">=</span> <span class="n">_current_scope</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">forked_current_scope</span><span class="p">)</span>
</span><span id="1-1654">
</span><span id="1-1655">    <span class="c1"># set given scope as isolation scope</span>
</span><span id="1-1656">    <span class="n">isolation_token</span> <span class="o">=</span> <span class="n">_isolation_scope</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">isolation_scope</span><span class="p">)</span>
</span><span id="1-1657">
</span><span id="1-1658">    <span class="k">try</span><span class="p">:</span>
</span><span id="1-1659">        <span class="k">yield</span> <span class="n">isolation_scope</span>
</span><span id="1-1660">
</span><span id="1-1661">    <span class="k">finally</span><span class="p">:</span>
</span><span id="1-1662">        <span class="c1"># restore original scopes</span>
</span><span id="1-1663">        <span class="n">_current_scope</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">current_token</span><span class="p">)</span>
</span><span id="1-1664">        <span class="n">_isolation_scope</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">isolation_token</span><span class="p">)</span>
</span><span id="1-1665">
</span><span id="1-1666">
</span><span id="1-1667"><span class="k">def</span> <span class="nf">should_send_default_pii</span><span class="p">():</span>
</span><span id="1-1668">    <span class="c1"># type: () -&gt; bool</span>
</span><span id="1-1669"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Shortcut for `Scope.get_client().should_send_default_pii()`.&quot;&quot;&quot;</span>
</span><span id="1-1670">    <span class="k">return</span> <span class="n">Scope</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span><span class="o">.</span><span class="n">should_send_default_pii</span><span class="p">()</span>
</span><span id="1-1671">
</span><span id="1-1672">
</span><span id="1-1673"><span class="c1"># Circular imports</span>
</span><span id="1-1674"><span class="kn">from</span> <span class="nn">sentry_sdk.client</span> <span class="kn">import</span> <span class="n">NonRecordingClient</span>
</span></pre></div>
        </article>
        
        <div class="navigation flex print:hidden">
  
  
</div>
        
      </div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2019-2024, Sentry Team and Contributors</p>
        
        <p>
          Made with
          
          <a href="https://www.sphinx-doc.org/">Sphinx</a> and
          
          <a href="https://shibuya.lepture.com">Shibuya theme</a>.
        </p>
      </div>
      <div class="sy-foot-socials">
          <a href="https://github.com/getsentry/sentry-python" aria-label="GitHub"><i class="i-icon github"></i></a>
      </div>
    </div>
  </div>
</footer></div>
      <script src="../../_static/documentation_options.js?v=aa9da443"></script>
      <script src="../../_static/doctools.js?v=888ff710"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/shibuya.js?v=999236dc"></script>
    
</body>
</html>