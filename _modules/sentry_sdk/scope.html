
  <!DOCTYPE html>
<html lang="en" data-accent-color="violet" data-content_root="../../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>sentry_sdk.scope - sentry-python 1.44.1 documentation</title>
    <link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

  <script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(sessionStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=aecf457f" />
    <link rel="stylesheet" type="text/css" href="../../_static/shibuya.css?v=d42a0c83" />
    <link media="print" rel="stylesheet" type="text/css" href="../../_static/print.css?v=20ff2c19" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="sentry_sdk.scope"/>
<meta name="twitter:card" content="summary"/>
  </head>
<body><div class="document"><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand mr-4" href="../../index.html">
      
      
      <strong>sentry-python</strong>
    </a>
    <div class="sy-head-links" id="NavLinks">
      <nav class="sy-head-nav"></nav>
      <div class="sy-head-extra flex items-center print:hidden">
<form class="searchbox flex items-center" action="../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form>
        
        
        <div class="sy-head-social flex items-center">
            <a class="flex items-center" href="https://github.com/getsentry/sentry-python" aria-label="GitHub">
              <i class="i-icon github"></i>
            </a>
        </div>
      </div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden">
      <button class="js-theme theme-switch flex items-center"
        data-aria-auto="Switch to light color mode"
        data-aria-light="Switch to dark color mode"
        data-aria-dark="Switch to auto color mode">
        <i class="i-icon theme-icon"></i>
      </button>
      <button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="NavLinks" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2 -translate-x-2"></span>
          <span class="hamburger_3 -translate-x-1"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">Top Level API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../integrations.html">Integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../apidocs.html">API Docs</a></li>
</ul>

        </div>
      </div>
      
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-icon close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div>
    </div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
    <div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-icon menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList">
      
      
      <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../../index.html"><span itemprop="name">sentry-python</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li>
      
      <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">Module code</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li>
      
      <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">sentry_sdk.scope</strong>
        <meta itemprop="position" content="3" />
      </li>
      
      
    </ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-icon outdent"></i>
      </button>
    </div>
  </div>
</div>
    <div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <h1>Source code for sentry_sdk.scope</h1><div class="highlight"><pre>
<span></span><span id="1-1"><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
</span><span id="1-2"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>
</span><span id="1-3"><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
</span><span id="1-4"><span class="kn">import</span> <span class="nn">os</span>
</span><span id="1-5"><span class="kn">import</span> <span class="nn">sys</span>
</span><span id="1-6"><span class="kn">import</span> <span class="nn">uuid</span>
</span><span id="1-7">
</span><span id="1-8"><span class="kn">from</span> <span class="nn">sentry_sdk.attachments</span> <span class="kn">import</span> <span class="n">Attachment</span>
</span><span id="1-9"><span class="kn">from</span> <span class="nn">sentry_sdk._compat</span> <span class="kn">import</span> <span class="n">datetime_utcnow</span>
</span><span id="1-10"><span class="kn">from</span> <span class="nn">sentry_sdk.consts</span> <span class="kn">import</span> <span class="n">FALSE_VALUES</span><span class="p">,</span> <span class="n">INSTRUMENTER</span>
</span><span id="1-11"><span class="kn">from</span> <span class="nn">sentry_sdk._functools</span> <span class="kn">import</span> <span class="n">wraps</span>
</span><span id="1-12"><span class="kn">from</span> <span class="nn">sentry_sdk.profiler</span> <span class="kn">import</span> <span class="n">Profile</span>
</span><span id="1-13"><span class="kn">from</span> <span class="nn">sentry_sdk.session</span> <span class="kn">import</span> <span class="n">Session</span>
</span><span id="1-14"><span class="kn">from</span> <span class="nn">sentry_sdk.tracing_utils</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="1-15">    <span class="n">Baggage</span><span class="p">,</span>
</span><span id="1-16">    <span class="n">extract_sentrytrace_data</span><span class="p">,</span>
</span><span id="1-17">    <span class="n">has_tracing_enabled</span><span class="p">,</span>
</span><span id="1-18">    <span class="n">normalize_incoming_data</span><span class="p">,</span>
</span><span id="1-19"><span class="p">)</span>
</span><span id="1-20"><span class="kn">from</span> <span class="nn">sentry_sdk.tracing</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="1-21">    <span class="n">BAGGAGE_HEADER_NAME</span><span class="p">,</span>
</span><span id="1-22">    <span class="n">SENTRY_TRACE_HEADER_NAME</span><span class="p">,</span>
</span><span id="1-23">    <span class="n">NoOpSpan</span><span class="p">,</span>
</span><span id="1-24">    <span class="n">Span</span><span class="p">,</span>
</span><span id="1-25">    <span class="n">Transaction</span><span class="p">,</span>
</span><span id="1-26"><span class="p">)</span>
</span><span id="1-27"><span class="kn">from</span> <span class="nn">sentry_sdk._types</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span>
</span><span id="1-28"><span class="kn">from</span> <span class="nn">sentry_sdk.utils</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="1-29">    <span class="n">event_from_exception</span><span class="p">,</span>
</span><span id="1-30">    <span class="n">exc_info_from_error</span><span class="p">,</span>
</span><span id="1-31">    <span class="n">logger</span><span class="p">,</span>
</span><span id="1-32">    <span class="n">capture_internal_exceptions</span><span class="p">,</span>
</span><span id="1-33"><span class="p">)</span>
</span><span id="1-34">
</span><span id="1-35"><span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="1-36">    <span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableMapping</span>
</span><span id="1-37">
</span><span id="1-38">    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>
</span><span id="1-39">    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span>
</span><span id="1-40">    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Deque</span>
</span><span id="1-41">    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span>
</span><span id="1-42">    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Generator</span>
</span><span id="1-43">    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterator</span>
</span><span id="1-44">    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
</span><span id="1-45">    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>
</span><span id="1-46">    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>
</span><span id="1-47">    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span>
</span><span id="1-48">    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>
</span><span id="1-49">
</span><span id="1-50">    <span class="kn">from</span> <span class="nn">sentry_sdk._types</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="1-51">        <span class="n">Breadcrumb</span><span class="p">,</span>
</span><span id="1-52">        <span class="n">BreadcrumbHint</span><span class="p">,</span>
</span><span id="1-53">        <span class="n">ErrorProcessor</span><span class="p">,</span>
</span><span id="1-54">        <span class="n">Event</span><span class="p">,</span>
</span><span id="1-55">        <span class="n">EventProcessor</span><span class="p">,</span>
</span><span id="1-56">        <span class="n">ExcInfo</span><span class="p">,</span>
</span><span id="1-57">        <span class="n">Hint</span><span class="p">,</span>
</span><span id="1-58">        <span class="n">LogLevelStr</span><span class="p">,</span>
</span><span id="1-59">        <span class="n">Type</span><span class="p">,</span>
</span><span id="1-60">    <span class="p">)</span>
</span><span id="1-61">
</span><span id="1-62">    <span class="kn">import</span> <span class="nn">sentry_sdk</span>
</span><span id="1-63">
</span><span id="1-64">    <span class="n">F</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span>
</span><span id="1-65">    <span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
</span><span id="1-66">
</span><span id="1-67">
</span><span id="1-68"><span class="n">global_event_processors</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[EventProcessor]</span>
</span><span id="1-69">
</span><span id="1-70">
</span><span id="1-71"><span class="k">def</span> <span class="nf">add_global_event_processor</span><span class="p">(</span><span class="n">processor</span><span class="p">):</span>
</span><span id="1-72">    <span class="c1"># type: (EventProcessor) -&gt; None</span>
</span><span id="1-73">    <span class="n">global_event_processors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processor</span><span class="p">)</span>
</span><span id="1-74">
</span><span id="1-75">
</span><span id="1-76"><span class="k">def</span> <span class="nf">_attr_setter</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
</span><span id="1-77">    <span class="c1"># type: (Any) -&gt; Any</span>
</span><span id="1-78">    <span class="k">return</span> <span class="nb">property</span><span class="p">(</span><span class="n">fset</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="n">fn</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</span><span id="1-79">
</span><span id="1-80">
</span><span id="1-81"><span class="k">def</span> <span class="nf">_disable_capture</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
</span><span id="1-82">    <span class="c1"># type: (F) -&gt; F</span>
</span><span id="1-83">    <span class="nd">@wraps</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="1-84">    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="1-85">        <span class="c1"># type: (Any, *Dict[str, Any], **Any) -&gt; Any</span>
</span><span id="1-86">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_capture</span><span class="p">:</span>
</span><span id="1-87">            <span class="k">return</span>
</span><span id="1-88">        <span class="k">try</span><span class="p">:</span>
</span><span id="1-89">            <span class="bp">self</span><span class="o">.</span><span class="n">_should_capture</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-90">            <span class="k">return</span> <span class="n">fn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="1-91">        <span class="k">finally</span><span class="p">:</span>
</span><span id="1-92">            <span class="bp">self</span><span class="o">.</span><span class="n">_should_capture</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-93">
</span><span id="1-94">    <span class="k">return</span> <span class="n">wrapper</span>  <span class="c1"># type: ignore</span>
</span><span id="1-95">
</span><span id="1-96">
</span><span id="1-97"><span class="k">def</span> <span class="nf">_merge_scopes</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">scope_change</span><span class="p">,</span> <span class="n">scope_kwargs</span><span class="p">):</span>
</span><span id="1-98">    <span class="c1"># type: (Scope, Optional[Any], Dict[str, Any]) -&gt; Scope</span>
</span><span id="1-99">    <span class="k">if</span> <span class="n">scope_change</span> <span class="ow">and</span> <span class="n">scope_kwargs</span><span class="p">:</span>
</span><span id="1-100">        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;cannot provide scope and kwargs&quot;</span><span class="p">)</span>
</span><span id="1-101">
</span><span id="1-102">    <span class="k">if</span> <span class="n">scope_change</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-103">        <span class="n">final_scope</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
</span><span id="1-104">        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">scope_change</span><span class="p">):</span>
</span><span id="1-105">            <span class="n">scope_change</span><span class="p">(</span><span class="n">final_scope</span><span class="p">)</span>
</span><span id="1-106">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-107">            <span class="n">final_scope</span><span class="o">.</span><span class="n">update_from_scope</span><span class="p">(</span><span class="n">scope_change</span><span class="p">)</span>
</span><span id="1-108">
</span><span id="1-109">    <span class="k">elif</span> <span class="n">scope_kwargs</span><span class="p">:</span>
</span><span id="1-110">        <span class="n">final_scope</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
</span><span id="1-111">        <span class="n">final_scope</span><span class="o">.</span><span class="n">update_from_kwargs</span><span class="p">(</span><span class="o">**</span><span class="n">scope_kwargs</span><span class="p">)</span>
</span><span id="1-112">
</span><span id="1-113">    <span class="k">else</span><span class="p">:</span>
</span><span id="1-114">        <span class="n">final_scope</span> <span class="o">=</span> <span class="n">base</span>
</span><span id="1-115">
</span><span id="1-116">    <span class="k">return</span> <span class="n">final_scope</span>
</span><span id="1-117">
</span><span id="1-118">
<div class="viewcode-block" id="Scope">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope">[docs]</a>
</span><span id="1-119"><span class="k">class</span> <span class="nc">Scope</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="1-120"><span class="w">    </span><span class="sd">&quot;&quot;&quot;The scope holds extra information that should be sent with all</span>
</span><span id="1-121"><span class="sd">    events that belong to it.</span>
</span><span id="1-122"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="1-123">
</span><span id="1-124">    <span class="c1"># NOTE: Even though it should not happen, the scope needs to not crash when</span>
</span><span id="1-125">    <span class="c1"># accessed by multiple threads. It&#39;s fine if it&#39;s full of races, but those</span>
</span><span id="1-126">    <span class="c1"># races should never make the user application crash.</span>
</span><span id="1-127">    <span class="c1">#</span>
</span><span id="1-128">    <span class="c1"># The same needs to hold for any accesses of the scope the SDK makes.</span>
</span><span id="1-129">
</span><span id="1-130">    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-131">        <span class="s2">&quot;_level&quot;</span><span class="p">,</span>
</span><span id="1-132">        <span class="s2">&quot;_name&quot;</span><span class="p">,</span>
</span><span id="1-133">        <span class="s2">&quot;_fingerprint&quot;</span><span class="p">,</span>
</span><span id="1-134">        <span class="c1"># note that for legacy reasons, _transaction is the transaction *name*,</span>
</span><span id="1-135">        <span class="c1"># not a Transaction object (the object is stored in _span)</span>
</span><span id="1-136">        <span class="s2">&quot;_transaction&quot;</span><span class="p">,</span>
</span><span id="1-137">        <span class="s2">&quot;_transaction_info&quot;</span><span class="p">,</span>
</span><span id="1-138">        <span class="s2">&quot;_user&quot;</span><span class="p">,</span>
</span><span id="1-139">        <span class="s2">&quot;_tags&quot;</span><span class="p">,</span>
</span><span id="1-140">        <span class="s2">&quot;_contexts&quot;</span><span class="p">,</span>
</span><span id="1-141">        <span class="s2">&quot;_extras&quot;</span><span class="p">,</span>
</span><span id="1-142">        <span class="s2">&quot;_breadcrumbs&quot;</span><span class="p">,</span>
</span><span id="1-143">        <span class="s2">&quot;_event_processors&quot;</span><span class="p">,</span>
</span><span id="1-144">        <span class="s2">&quot;_error_processors&quot;</span><span class="p">,</span>
</span><span id="1-145">        <span class="s2">&quot;_should_capture&quot;</span><span class="p">,</span>
</span><span id="1-146">        <span class="s2">&quot;_span&quot;</span><span class="p">,</span>
</span><span id="1-147">        <span class="s2">&quot;_session&quot;</span><span class="p">,</span>
</span><span id="1-148">        <span class="s2">&quot;_attachments&quot;</span><span class="p">,</span>
</span><span id="1-149">        <span class="s2">&quot;_force_auto_session_tracking&quot;</span><span class="p">,</span>
</span><span id="1-150">        <span class="s2">&quot;_profile&quot;</span><span class="p">,</span>
</span><span id="1-151">        <span class="s2">&quot;_propagation_context&quot;</span><span class="p">,</span>
</span><span id="1-152">    <span class="p">)</span>
</span><span id="1-153">
</span><span id="1-154">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-155">        <span class="c1"># type: () -&gt; None</span>
</span><span id="1-156">        <span class="bp">self</span><span class="o">.</span><span class="n">_event_processors</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[EventProcessor]</span>
</span><span id="1-157">        <span class="bp">self</span><span class="o">.</span><span class="n">_error_processors</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[ErrorProcessor]</span>
</span><span id="1-158">
</span><span id="1-159">        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[str]</span>
</span><span id="1-160">        <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[Dict[str, Any]]</span>
</span><span id="1-161">
</span><span id="1-162">        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="1-163">
</span><span id="1-164">        <span class="n">incoming_trace_information</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_trace_data_from_env</span><span class="p">()</span>
</span><span id="1-165">        <span class="bp">self</span><span class="o">.</span><span class="n">generate_propagation_context</span><span class="p">(</span><span class="n">incoming_data</span><span class="o">=</span><span class="n">incoming_trace_information</span><span class="p">)</span>
</span><span id="1-166">
</span><span id="1-167">    <span class="k">def</span> <span class="nf">_load_trace_data_from_env</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-168">        <span class="c1"># type: () -&gt; Optional[Dict[str, str]]</span>
</span><span id="1-169"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-170"><span class="sd">        Load Sentry trace id and baggage from environment variables.</span>
</span><span id="1-171"><span class="sd">        Can be disabled by setting SENTRY_USE_ENVIRONMENT to &quot;false&quot;.</span>
</span><span id="1-172"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-173">        <span class="n">incoming_trace_information</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-174">
</span><span id="1-175">        <span class="n">sentry_use_environment</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-176">            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SENTRY_USE_ENVIRONMENT&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
</span><span id="1-177">        <span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="1-178">        <span class="n">use_environment</span> <span class="o">=</span> <span class="n">sentry_use_environment</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">FALSE_VALUES</span>
</span><span id="1-179">        <span class="k">if</span> <span class="n">use_environment</span><span class="p">:</span>
</span><span id="1-180">            <span class="n">incoming_trace_information</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="1-181">
</span><span id="1-182">            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SENTRY_TRACE&quot;</span><span class="p">):</span>
</span><span id="1-183">                <span class="n">incoming_trace_information</span><span class="p">[</span><span class="n">SENTRY_TRACE_HEADER_NAME</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-184">                    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SENTRY_TRACE&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
</span><span id="1-185">                <span class="p">)</span>
</span><span id="1-186">
</span><span id="1-187">            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SENTRY_BAGGAGE&quot;</span><span class="p">):</span>
</span><span id="1-188">                <span class="n">incoming_trace_information</span><span class="p">[</span><span class="n">BAGGAGE_HEADER_NAME</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-189">                    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SENTRY_BAGGAGE&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
</span><span id="1-190">                <span class="p">)</span>
</span><span id="1-191">
</span><span id="1-192">        <span class="k">return</span> <span class="n">incoming_trace_information</span> <span class="ow">or</span> <span class="kc">None</span>
</span><span id="1-193">
</span><span id="1-194">    <span class="k">def</span> <span class="nf">_extract_propagation_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="1-195">        <span class="c1"># type: (Dict[str, Any]) -&gt; Optional[Dict[str, Any]]</span>
</span><span id="1-196">        <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: Dict[str, Any]</span>
</span><span id="1-197">        <span class="n">normalized_data</span> <span class="o">=</span> <span class="n">normalize_incoming_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="1-198">
</span><span id="1-199">        <span class="n">baggage_header</span> <span class="o">=</span> <span class="n">normalized_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">BAGGAGE_HEADER_NAME</span><span class="p">)</span>
</span><span id="1-200">        <span class="k">if</span> <span class="n">baggage_header</span><span class="p">:</span>
</span><span id="1-201">            <span class="n">context</span><span class="p">[</span><span class="s2">&quot;dynamic_sampling_context&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Baggage</span><span class="o">.</span><span class="n">from_incoming_header</span><span class="p">(</span>
</span><span id="1-202">                <span class="n">baggage_header</span>
</span><span id="1-203">            <span class="p">)</span><span class="o">.</span><span class="n">dynamic_sampling_context</span><span class="p">()</span>
</span><span id="1-204">
</span><span id="1-205">        <span class="n">sentry_trace_header</span> <span class="o">=</span> <span class="n">normalized_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SENTRY_TRACE_HEADER_NAME</span><span class="p">)</span>
</span><span id="1-206">        <span class="k">if</span> <span class="n">sentry_trace_header</span><span class="p">:</span>
</span><span id="1-207">            <span class="n">sentrytrace_data</span> <span class="o">=</span> <span class="n">extract_sentrytrace_data</span><span class="p">(</span><span class="n">sentry_trace_header</span><span class="p">)</span>
</span><span id="1-208">            <span class="k">if</span> <span class="n">sentrytrace_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-209">                <span class="n">context</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sentrytrace_data</span><span class="p">)</span>
</span><span id="1-210">
</span><span id="1-211">        <span class="n">only_baggage_no_sentry_trace</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-212">            <span class="s2">&quot;dynamic_sampling_context&quot;</span> <span class="ow">in</span> <span class="n">context</span> <span class="ow">and</span> <span class="s2">&quot;trace_id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">context</span>
</span><span id="1-213">        <span class="p">)</span>
</span><span id="1-214">        <span class="k">if</span> <span class="n">only_baggage_no_sentry_trace</span><span class="p">:</span>
</span><span id="1-215">            <span class="n">context</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_create_new_propagation_context</span><span class="p">())</span>
</span><span id="1-216">
</span><span id="1-217">        <span class="k">if</span> <span class="n">context</span><span class="p">:</span>
</span><span id="1-218">            <span class="k">if</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;span_id&quot;</span><span class="p">):</span>
</span><span id="1-219">                <span class="n">context</span><span class="p">[</span><span class="s2">&quot;span_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">[</span><span class="mi">16</span><span class="p">:]</span>
</span><span id="1-220">
</span><span id="1-221">            <span class="k">return</span> <span class="n">context</span>
</span><span id="1-222">
</span><span id="1-223">        <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-224">
</span><span id="1-225">    <span class="k">def</span> <span class="nf">_create_new_propagation_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-226">        <span class="c1"># type: () -&gt; Dict[str, Any]</span>
</span><span id="1-227">        <span class="k">return</span> <span class="p">{</span>
</span><span id="1-228">            <span class="s2">&quot;trace_id&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">,</span>
</span><span id="1-229">            <span class="s2">&quot;span_id&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">[</span><span class="mi">16</span><span class="p">:],</span>
</span><span id="1-230">            <span class="s2">&quot;parent_span_id&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-231">            <span class="s2">&quot;dynamic_sampling_context&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-232">        <span class="p">}</span>
</span><span id="1-233">
<div class="viewcode-block" id="Scope.set_new_propagation_context">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.set_new_propagation_context">[docs]</a>
</span><span id="1-234">    <span class="k">def</span> <span class="nf">set_new_propagation_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-235">        <span class="c1"># type: () -&gt; None</span>
</span><span id="1-236"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-237"><span class="sd">        Creates a new propagation context and sets it as `_propagation_context`. Overwriting existing one.</span>
</span><span id="1-238"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-239">        <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_new_propagation_context</span><span class="p">()</span>
</span><span id="1-240">        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="1-241">            <span class="s2">&quot;[Tracing] Create new propagation context: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="1-242">            <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="p">,</span>
</span><span id="1-243">        <span class="p">)</span></div>

</span><span id="1-244">
<div class="viewcode-block" id="Scope.generate_propagation_context">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.generate_propagation_context">[docs]</a>
</span><span id="1-245">    <span class="k">def</span> <span class="nf">generate_propagation_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">incoming_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="1-246">        <span class="c1"># type: (Optional[Dict[str, str]]) -&gt; None</span>
</span><span id="1-247"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-248"><span class="sd">        Makes sure `_propagation_context` is set.</span>
</span><span id="1-249"><span class="sd">        If there is `incoming_data` overwrite existing `_propagation_context`.</span>
</span><span id="1-250"><span class="sd">        if there is no `incoming_data` create new `_propagation_context`, but do NOT overwrite if already existing.</span>
</span><span id="1-251"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-252">        <span class="k">if</span> <span class="n">incoming_data</span><span class="p">:</span>
</span><span id="1-253">            <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_propagation_context</span><span class="p">(</span><span class="n">incoming_data</span><span class="p">)</span>
</span><span id="1-254">
</span><span id="1-255">            <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-256">                <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="o">=</span> <span class="n">context</span>
</span><span id="1-257">                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="1-258">                    <span class="s2">&quot;[Tracing] Extracted propagation context from incoming data: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="1-259">                    <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="p">,</span>
</span><span id="1-260">                <span class="p">)</span>
</span><span id="1-261">
</span><span id="1-262">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-263">            <span class="bp">self</span><span class="o">.</span><span class="n">set_new_propagation_context</span><span class="p">()</span></div>

</span><span id="1-264">
<div class="viewcode-block" id="Scope.get_dynamic_sampling_context">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.get_dynamic_sampling_context">[docs]</a>
</span><span id="1-265">    <span class="k">def</span> <span class="nf">get_dynamic_sampling_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-266">        <span class="c1"># type: () -&gt; Optional[Dict[str, str]]</span>
</span><span id="1-267"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-268"><span class="sd">        Returns the Dynamic Sampling Context from the Propagation Context.</span>
</span><span id="1-269"><span class="sd">        If not existing, creates a new one.</span>
</span><span id="1-270"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-271">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-272">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-273">
</span><span id="1-274">        <span class="n">baggage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_baggage</span><span class="p">()</span>
</span><span id="1-275">        <span class="k">if</span> <span class="n">baggage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-276">            <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="p">[</span><span class="s2">&quot;dynamic_sampling_context&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-277">                <span class="n">baggage</span><span class="o">.</span><span class="n">dynamic_sampling_context</span><span class="p">()</span>
</span><span id="1-278">            <span class="p">)</span>
</span><span id="1-279">
</span><span id="1-280">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="p">[</span><span class="s2">&quot;dynamic_sampling_context&quot;</span><span class="p">]</span></div>

</span><span id="1-281">
<div class="viewcode-block" id="Scope.get_traceparent">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.get_traceparent">[docs]</a>
</span><span id="1-282">    <span class="k">def</span> <span class="nf">get_traceparent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="1-283">        <span class="c1"># type: (Any, Any) -&gt; Optional[str]</span>
</span><span id="1-284"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-285"><span class="sd">        Returns the Sentry &quot;sentry-trace&quot; header (aka the traceparent) from the</span>
</span><span id="1-286"><span class="sd">        currently active span or the scopes Propagation Context.</span>
</span><span id="1-287"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-288">        <span class="n">client</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;client&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-289">
</span><span id="1-290">        <span class="c1"># If we have an active span, return traceparent from there</span>
</span><span id="1-291">        <span class="k">if</span> <span class="p">(</span>
</span><span id="1-292">            <span class="n">client</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="1-293">            <span class="ow">and</span> <span class="n">has_tracing_enabled</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
</span><span id="1-294">            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">span</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="1-295">        <span class="p">):</span>
</span><span id="1-296">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">to_traceparent</span><span class="p">()</span>
</span><span id="1-297">
</span><span id="1-298">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-299">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-300">
</span><span id="1-301">        <span class="n">traceparent</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
</span><span id="1-302">            <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="p">[</span><span class="s2">&quot;trace_id&quot;</span><span class="p">],</span>
</span><span id="1-303">            <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="p">[</span><span class="s2">&quot;span_id&quot;</span><span class="p">],</span>
</span><span id="1-304">        <span class="p">)</span>
</span><span id="1-305">        <span class="k">return</span> <span class="n">traceparent</span></div>

</span><span id="1-306">
</span><span id="1-307">    <span class="k">def</span> <span class="nf">get_baggage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="1-308">        <span class="c1"># type: (Any, Any) -&gt; Optional[Baggage]</span>
</span><span id="1-309">        <span class="n">client</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;client&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-310">
</span><span id="1-311">        <span class="c1"># If we have an active span, return baggage from there</span>
</span><span id="1-312">        <span class="k">if</span> <span class="p">(</span>
</span><span id="1-313">            <span class="n">client</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="1-314">            <span class="ow">and</span> <span class="n">has_tracing_enabled</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
</span><span id="1-315">            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">span</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="1-316">        <span class="p">):</span>
</span><span id="1-317">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">to_baggage</span><span class="p">()</span>
</span><span id="1-318">
</span><span id="1-319">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-320">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-321">
</span><span id="1-322">        <span class="n">dynamic_sampling_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="1-323">            <span class="s2">&quot;dynamic_sampling_context&quot;</span>
</span><span id="1-324">        <span class="p">)</span>
</span><span id="1-325">        <span class="k">if</span> <span class="n">dynamic_sampling_context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-326">            <span class="k">return</span> <span class="n">Baggage</span><span class="o">.</span><span class="n">from_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="1-327">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-328">            <span class="k">return</span> <span class="n">Baggage</span><span class="p">(</span><span class="n">dynamic_sampling_context</span><span class="p">)</span>
</span><span id="1-329">
<div class="viewcode-block" id="Scope.get_trace_context">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.get_trace_context">[docs]</a>
</span><span id="1-330">    <span class="k">def</span> <span class="nf">get_trace_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-331">        <span class="c1"># type: () -&gt; Any</span>
</span><span id="1-332"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-333"><span class="sd">        Returns the Sentry &quot;trace&quot; context from the Propagation Context.</span>
</span><span id="1-334"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-335">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-336">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-337">
</span><span id="1-338">        <span class="n">trace_context</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="1-339">            <span class="s2">&quot;trace_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="p">[</span><span class="s2">&quot;trace_id&quot;</span><span class="p">],</span>
</span><span id="1-340">            <span class="s2">&quot;span_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="p">[</span><span class="s2">&quot;span_id&quot;</span><span class="p">],</span>
</span><span id="1-341">            <span class="s2">&quot;parent_span_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span><span class="p">[</span><span class="s2">&quot;parent_span_id&quot;</span><span class="p">],</span>
</span><span id="1-342">            <span class="s2">&quot;dynamic_sampling_context&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dynamic_sampling_context</span><span class="p">(),</span>
</span><span id="1-343">        <span class="p">}</span>  <span class="c1"># type: Dict[str, Any]</span>
</span><span id="1-344">
</span><span id="1-345">        <span class="k">return</span> <span class="n">trace_context</span></div>

</span><span id="1-346">
<div class="viewcode-block" id="Scope.trace_propagation_meta">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.trace_propagation_meta">[docs]</a>
</span><span id="1-347">    <span class="k">def</span> <span class="nf">trace_propagation_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="1-348">        <span class="c1"># type: (*Any, **Any) -&gt; str</span>
</span><span id="1-349"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-350"><span class="sd">        Return meta tags which should be injected into HTML templates</span>
</span><span id="1-351"><span class="sd">        to allow propagation of trace information.</span>
</span><span id="1-352"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-353">        <span class="n">span</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;span&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-354">        <span class="k">if</span> <span class="n">span</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-355">            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="1-356">                <span class="s2">&quot;The parameter `span` in trace_propagation_meta() is deprecated and will be removed in the future.&quot;</span>
</span><span id="1-357">            <span class="p">)</span>
</span><span id="1-358">
</span><span id="1-359">        <span class="n">client</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;client&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-360">
</span><span id="1-361">        <span class="n">meta</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="1-362">
</span><span id="1-363">        <span class="n">sentry_trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traceparent</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>
</span><span id="1-364">        <span class="k">if</span> <span class="n">sentry_trace</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-365">            <span class="n">meta</span> <span class="o">+=</span> <span class="s1">&#39;&lt;meta name=&quot;</span><span class="si">%s</span><span class="s1">&quot; content=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span>
</span><span id="1-366">                <span class="n">SENTRY_TRACE_HEADER_NAME</span><span class="p">,</span>
</span><span id="1-367">                <span class="n">sentry_trace</span><span class="p">,</span>
</span><span id="1-368">            <span class="p">)</span>
</span><span id="1-369">
</span><span id="1-370">        <span class="n">baggage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_baggage</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>
</span><span id="1-371">        <span class="k">if</span> <span class="n">baggage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-372">            <span class="n">meta</span> <span class="o">+=</span> <span class="s1">&#39;&lt;meta name=&quot;</span><span class="si">%s</span><span class="s1">&quot; content=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span>
</span><span id="1-373">                <span class="n">BAGGAGE_HEADER_NAME</span><span class="p">,</span>
</span><span id="1-374">                <span class="n">baggage</span><span class="o">.</span><span class="n">serialize</span><span class="p">(),</span>
</span><span id="1-375">            <span class="p">)</span>
</span><span id="1-376">
</span><span id="1-377">        <span class="k">return</span> <span class="n">meta</span></div>

</span><span id="1-378">
<div class="viewcode-block" id="Scope.iter_headers">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.iter_headers">[docs]</a>
</span><span id="1-379">    <span class="k">def</span> <span class="nf">iter_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-380">        <span class="c1"># type: () -&gt; Iterator[Tuple[str, str]]</span>
</span><span id="1-381"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-382"><span class="sd">        Creates a generator which returns the `sentry-trace` and `baggage` headers from the Propagation Context.</span>
</span><span id="1-383"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-384">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-385">            <span class="n">traceparent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traceparent</span><span class="p">()</span>
</span><span id="1-386">            <span class="k">if</span> <span class="n">traceparent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-387">                <span class="k">yield</span> <span class="n">SENTRY_TRACE_HEADER_NAME</span><span class="p">,</span> <span class="n">traceparent</span>
</span><span id="1-388">
</span><span id="1-389">            <span class="n">dsc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dynamic_sampling_context</span><span class="p">()</span>
</span><span id="1-390">            <span class="k">if</span> <span class="n">dsc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-391">                <span class="n">baggage</span> <span class="o">=</span> <span class="n">Baggage</span><span class="p">(</span><span class="n">dsc</span><span class="p">)</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span>
</span><span id="1-392">                <span class="k">yield</span> <span class="n">BAGGAGE_HEADER_NAME</span><span class="p">,</span> <span class="n">baggage</span></div>

</span><span id="1-393">
<div class="viewcode-block" id="Scope.iter_trace_propagation_headers">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.iter_trace_propagation_headers">[docs]</a>
</span><span id="1-394">    <span class="k">def</span> <span class="nf">iter_trace_propagation_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="1-395">        <span class="c1"># type: (Any, Any) -&gt; Generator[Tuple[str, str], None, None]</span>
</span><span id="1-396"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-397"><span class="sd">        Return HTTP headers which allow propagation of trace data. Data taken</span>
</span><span id="1-398"><span class="sd">        from the span representing the request, if available, or the current</span>
</span><span id="1-399"><span class="sd">        span on the scope if not.</span>
</span><span id="1-400"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-401">        <span class="n">span</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;span&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-402">        <span class="n">client</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;client&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-403">
</span><span id="1-404">        <span class="n">propagate_traces</span> <span class="o">=</span> <span class="n">client</span> <span class="ow">and</span> <span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;propagate_traces&quot;</span><span class="p">]</span>
</span><span id="1-405">        <span class="k">if</span> <span class="ow">not</span> <span class="n">propagate_traces</span><span class="p">:</span>
</span><span id="1-406">            <span class="k">return</span>
</span><span id="1-407">
</span><span id="1-408">        <span class="n">span</span> <span class="o">=</span> <span class="n">span</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">span</span>
</span><span id="1-409">
</span><span id="1-410">        <span class="k">if</span> <span class="n">client</span> <span class="ow">and</span> <span class="n">has_tracing_enabled</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="p">)</span> <span class="ow">and</span> <span class="n">span</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-411">            <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">span</span><span class="o">.</span><span class="n">iter_headers</span><span class="p">():</span>
</span><span id="1-412">                <span class="k">yield</span> <span class="n">header</span>
</span><span id="1-413">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-414">            <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_headers</span><span class="p">():</span>
</span><span id="1-415">                <span class="k">yield</span> <span class="n">header</span></div>

</span><span id="1-416">
<div class="viewcode-block" id="Scope.clear">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.clear">[docs]</a>
</span><span id="1-417">    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-418">        <span class="c1"># type: () -&gt; None</span>
</span><span id="1-419"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clears the entire scope.&quot;&quot;&quot;</span>
</span><span id="1-420">        <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[LogLevelStr]</span>
</span><span id="1-421">        <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[List[str]]</span>
</span><span id="1-422">        <span class="bp">self</span><span class="o">.</span><span class="n">_transaction</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[str]</span>
</span><span id="1-423">        <span class="bp">self</span><span class="o">.</span><span class="n">_transaction_info</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: MutableMapping[str, str]</span>
</span><span id="1-424">        <span class="bp">self</span><span class="o">.</span><span class="n">_user</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[Dict[str, Any]]</span>
</span><span id="1-425">
</span><span id="1-426">        <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: Dict[str, Any]</span>
</span><span id="1-427">        <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: Dict[str, Dict[str, Any]]</span>
</span><span id="1-428">        <span class="bp">self</span><span class="o">.</span><span class="n">_extras</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: MutableMapping[str, Any]</span>
</span><span id="1-429">        <span class="bp">self</span><span class="o">.</span><span class="n">_attachments</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[Attachment]</span>
</span><span id="1-430">
</span><span id="1-431">        <span class="bp">self</span><span class="o">.</span><span class="n">clear_breadcrumbs</span><span class="p">()</span>
</span><span id="1-432">        <span class="bp">self</span><span class="o">.</span><span class="n">_should_capture</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="1-433">
</span><span id="1-434">        <span class="bp">self</span><span class="o">.</span><span class="n">_span</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[Span]</span>
</span><span id="1-435">        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[Session]</span>
</span><span id="1-436">        <span class="bp">self</span><span class="o">.</span><span class="n">_force_auto_session_tracking</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[bool]</span>
</span><span id="1-437">
</span><span id="1-438">        <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[Profile]</span>
</span><span id="1-439">
</span><span id="1-440">        <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="o">=</span> <span class="kc">None</span></div>

</span><span id="1-441">
</span><span id="1-442">    <span class="nd">@_attr_setter</span>
</span><span id="1-443">    <span class="k">def</span> <span class="nf">level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="1-444">        <span class="c1"># type: (LogLevelStr) -&gt; None</span>
</span><span id="1-445"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-446"><span class="sd">        When set this overrides the level.</span>
</span><span id="1-447">
</span><span id="1-448"><span class="sd">        .. deprecated:: 1.0.0</span>
</span><span id="1-449"><span class="sd">            Use :func:`set_level` instead.</span>
</span><span id="1-450">
</span><span id="1-451"><span class="sd">        :param value: The level to set.</span>
</span><span id="1-452"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-453">        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="1-454">            <span class="s2">&quot;Deprecated: use .set_level() instead. This will be removed in the future.&quot;</span>
</span><span id="1-455">        <span class="p">)</span>
</span><span id="1-456">
</span><span id="1-457">        <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="1-458">
<div class="viewcode-block" id="Scope.set_level">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.set_level">[docs]</a>
</span><span id="1-459">    <span class="k">def</span> <span class="nf">set_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="1-460">        <span class="c1"># type: (LogLevelStr) -&gt; None</span>
</span><span id="1-461"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-462"><span class="sd">        Sets the level for the scope.</span>
</span><span id="1-463">
</span><span id="1-464"><span class="sd">        :param value: The level to set.</span>
</span><span id="1-465"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-466">        <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="n">value</span></div>

</span><span id="1-467">
</span><span id="1-468">    <span class="nd">@_attr_setter</span>
</span><span id="1-469">    <span class="k">def</span> <span class="nf">fingerprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="1-470">        <span class="c1"># type: (Optional[List[str]]) -&gt; None</span>
</span><span id="1-471"><span class="w">        </span><span class="sd">&quot;&quot;&quot;When set this overrides the default fingerprint.&quot;&quot;&quot;</span>
</span><span id="1-472">        <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="1-473">
</span><span id="1-474">    <span class="nd">@property</span>
</span><span id="1-475">    <span class="k">def</span> <span class="nf">transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-476">        <span class="c1"># type: () -&gt; Any</span>
</span><span id="1-477">        <span class="c1"># would be type: () -&gt; Optional[Transaction], see https://github.com/python/mypy/issues/3004</span>
</span><span id="1-478"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the transaction (root span) in the scope, if any.&quot;&quot;&quot;</span>
</span><span id="1-479">
</span><span id="1-480">        <span class="c1"># there is no span/transaction on the scope</span>
</span><span id="1-481">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-482">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-483">
</span><span id="1-484">        <span class="c1"># there is an orphan span on the scope</span>
</span><span id="1-485">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span><span class="o">.</span><span class="n">containing_transaction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-486">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-487">
</span><span id="1-488">        <span class="c1"># there is either a transaction (which is its own containing</span>
</span><span id="1-489">        <span class="c1"># transaction) or a non-orphan span on the scope</span>
</span><span id="1-490">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span><span class="o">.</span><span class="n">containing_transaction</span>
</span><span id="1-491">
</span><span id="1-492">    <span class="nd">@transaction</span><span class="o">.</span><span class="n">setter</span>
</span><span id="1-493">    <span class="k">def</span> <span class="nf">transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="1-494">        <span class="c1"># type: (Any) -&gt; None</span>
</span><span id="1-495">        <span class="c1"># would be type: (Optional[str]) -&gt; None, see https://github.com/python/mypy/issues/3004</span>
</span><span id="1-496"><span class="w">        </span><span class="sd">&quot;&quot;&quot;When set this forces a specific transaction name to be set.</span>
</span><span id="1-497">
</span><span id="1-498"><span class="sd">        Deprecated: use set_transaction_name instead.&quot;&quot;&quot;</span>
</span><span id="1-499">
</span><span id="1-500">        <span class="c1"># XXX: the docstring above is misleading. The implementation of</span>
</span><span id="1-501">        <span class="c1"># apply_to_event prefers an existing value of event.transaction over</span>
</span><span id="1-502">        <span class="c1"># anything set in the scope.</span>
</span><span id="1-503">        <span class="c1"># XXX: note that with the introduction of the Scope.transaction getter,</span>
</span><span id="1-504">        <span class="c1"># there is a semantic and type mismatch between getter and setter. The</span>
</span><span id="1-505">        <span class="c1"># getter returns a Transaction, the setter sets a transaction name.</span>
</span><span id="1-506">        <span class="c1"># Without breaking version compatibility, we could make the setter set a</span>
</span><span id="1-507">        <span class="c1"># transaction name or transaction (self._span) depending on the type of</span>
</span><span id="1-508">        <span class="c1"># the value argument.</span>
</span><span id="1-509">
</span><span id="1-510">        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="1-511">            <span class="s2">&quot;Assigning to scope.transaction directly is deprecated: use scope.set_transaction_name() instead.&quot;</span>
</span><span id="1-512">        <span class="p">)</span>
</span><span id="1-513">        <span class="bp">self</span><span class="o">.</span><span class="n">_transaction</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="1-514">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span><span class="o">.</span><span class="n">containing_transaction</span><span class="p">:</span>
</span><span id="1-515">            <span class="bp">self</span><span class="o">.</span><span class="n">_span</span><span class="o">.</span><span class="n">containing_transaction</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="1-516">
<div class="viewcode-block" id="Scope.set_transaction_name">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.set_transaction_name">[docs]</a>
</span><span id="1-517">    <span class="k">def</span> <span class="nf">set_transaction_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="1-518">        <span class="c1"># type: (str, Optional[str]) -&gt; None</span>
</span><span id="1-519"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the transaction name and optionally the transaction source.&quot;&quot;&quot;</span>
</span><span id="1-520">        <span class="bp">self</span><span class="o">.</span><span class="n">_transaction</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="1-521">
</span><span id="1-522">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span><span class="o">.</span><span class="n">containing_transaction</span><span class="p">:</span>
</span><span id="1-523">            <span class="bp">self</span><span class="o">.</span><span class="n">_span</span><span class="o">.</span><span class="n">containing_transaction</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="1-524">            <span class="k">if</span> <span class="n">source</span><span class="p">:</span>
</span><span id="1-525">                <span class="bp">self</span><span class="o">.</span><span class="n">_span</span><span class="o">.</span><span class="n">containing_transaction</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span>
</span><span id="1-526">
</span><span id="1-527">        <span class="k">if</span> <span class="n">source</span><span class="p">:</span>
</span><span id="1-528">            <span class="bp">self</span><span class="o">.</span><span class="n">_transaction_info</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">source</span></div>

</span><span id="1-529">
</span><span id="1-530">    <span class="nd">@_attr_setter</span>
</span><span id="1-531">    <span class="k">def</span> <span class="nf">user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="1-532">        <span class="c1"># type: (Optional[Dict[str, Any]]) -&gt; None</span>
</span><span id="1-533"><span class="w">        </span><span class="sd">&quot;&quot;&quot;When set a specific user is bound to the scope. Deprecated in favor of set_user.&quot;&quot;&quot;</span>
</span><span id="1-534">        <span class="bp">self</span><span class="o">.</span><span class="n">set_user</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="1-535">
<div class="viewcode-block" id="Scope.set_user">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.set_user">[docs]</a>
</span><span id="1-536">    <span class="k">def</span> <span class="nf">set_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="1-537">        <span class="c1"># type: (Optional[Dict[str, Any]]) -&gt; None</span>
</span><span id="1-538"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets a user for the scope.&quot;&quot;&quot;</span>
</span><span id="1-539">        <span class="bp">self</span><span class="o">.</span><span class="n">_user</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="1-540">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-541">            <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">value</span><span class="p">)</span></div>

</span><span id="1-542">
</span><span id="1-543">    <span class="nd">@property</span>
</span><span id="1-544">    <span class="k">def</span> <span class="nf">span</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-545">        <span class="c1"># type: () -&gt; Optional[Span]</span>
</span><span id="1-546"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get/set current tracing span or transaction.&quot;&quot;&quot;</span>
</span><span id="1-547">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span>
</span><span id="1-548">
</span><span id="1-549">    <span class="nd">@span</span><span class="o">.</span><span class="n">setter</span>
</span><span id="1-550">    <span class="k">def</span> <span class="nf">span</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">span</span><span class="p">):</span>
</span><span id="1-551">        <span class="c1"># type: (Optional[Span]) -&gt; None</span>
</span><span id="1-552">        <span class="bp">self</span><span class="o">.</span><span class="n">_span</span> <span class="o">=</span> <span class="n">span</span>
</span><span id="1-553">        <span class="c1"># XXX: this differs from the implementation in JS, there Scope.setSpan</span>
</span><span id="1-554">        <span class="c1"># does not set Scope._transactionName.</span>
</span><span id="1-555">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">span</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">):</span>
</span><span id="1-556">            <span class="n">transaction</span> <span class="o">=</span> <span class="n">span</span>
</span><span id="1-557">            <span class="k">if</span> <span class="n">transaction</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span id="1-558">                <span class="bp">self</span><span class="o">.</span><span class="n">_transaction</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="n">name</span>
</span><span id="1-559">                <span class="k">if</span> <span class="n">transaction</span><span class="o">.</span><span class="n">source</span><span class="p">:</span>
</span><span id="1-560">                    <span class="bp">self</span><span class="o">.</span><span class="n">_transaction_info</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="n">source</span>
</span><span id="1-561">
</span><span id="1-562">    <span class="nd">@property</span>
</span><span id="1-563">    <span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-564">        <span class="c1"># type: () -&gt; Optional[Profile]</span>
</span><span id="1-565">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span>
</span><span id="1-566">
</span><span id="1-567">    <span class="nd">@profile</span><span class="o">.</span><span class="n">setter</span>
</span><span id="1-568">    <span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">profile</span><span class="p">):</span>
</span><span id="1-569">        <span class="c1"># type: (Optional[Profile]) -&gt; None</span>
</span><span id="1-570">
</span><span id="1-571">        <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="n">profile</span>
</span><span id="1-572">
<div class="viewcode-block" id="Scope.set_tag">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.set_tag">[docs]</a>
</span><span id="1-573">    <span class="k">def</span> <span class="nf">set_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="1-574">        <span class="c1"># type: (str, Any) -&gt; None</span>
</span><span id="1-575"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-576"><span class="sd">        Sets a tag for a key to a specific value.</span>
</span><span id="1-577">
</span><span id="1-578"><span class="sd">        :param key: Key of the tag to set.</span>
</span><span id="1-579">
</span><span id="1-580"><span class="sd">        :param value: Value of the tag to set.</span>
</span><span id="1-581"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-582">        <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

</span><span id="1-583">
<div class="viewcode-block" id="Scope.remove_tag">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.remove_tag">[docs]</a>
</span><span id="1-584">    <span class="k">def</span> <span class="nf">remove_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span id="1-585">        <span class="c1"># type: (str) -&gt; None</span>
</span><span id="1-586"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-587"><span class="sd">        Removes a specific tag.</span>
</span><span id="1-588">
</span><span id="1-589"><span class="sd">        :param key: Key of the tag to remove.</span>
</span><span id="1-590"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-591">        <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

</span><span id="1-592">
<div class="viewcode-block" id="Scope.set_context">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.set_context">[docs]</a>
</span><span id="1-593">    <span class="k">def</span> <span class="nf">set_context</span><span class="p">(</span>
</span><span id="1-594">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-595">        <span class="n">key</span><span class="p">,</span>  <span class="c1"># type: str</span>
</span><span id="1-596">        <span class="n">value</span><span class="p">,</span>  <span class="c1"># type: Dict[str, Any]</span>
</span><span id="1-597">    <span class="p">):</span>
</span><span id="1-598">        <span class="c1"># type: (...) -&gt; None</span>
</span><span id="1-599"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-600"><span class="sd">        Binds a context at a certain key to a specific value.</span>
</span><span id="1-601"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-602">        <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

</span><span id="1-603">
<div class="viewcode-block" id="Scope.remove_context">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.remove_context">[docs]</a>
</span><span id="1-604">    <span class="k">def</span> <span class="nf">remove_context</span><span class="p">(</span>
</span><span id="1-605">        <span class="bp">self</span><span class="p">,</span> <span class="n">key</span>  <span class="c1"># type: str</span>
</span><span id="1-606">    <span class="p">):</span>
</span><span id="1-607">        <span class="c1"># type: (...) -&gt; None</span>
</span><span id="1-608"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Removes a context.&quot;&quot;&quot;</span>
</span><span id="1-609">        <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

</span><span id="1-610">
<div class="viewcode-block" id="Scope.set_extra">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.set_extra">[docs]</a>
</span><span id="1-611">    <span class="k">def</span> <span class="nf">set_extra</span><span class="p">(</span>
</span><span id="1-612">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-613">        <span class="n">key</span><span class="p">,</span>  <span class="c1"># type: str</span>
</span><span id="1-614">        <span class="n">value</span><span class="p">,</span>  <span class="c1"># type: Any</span>
</span><span id="1-615">    <span class="p">):</span>
</span><span id="1-616">        <span class="c1"># type: (...) -&gt; None</span>
</span><span id="1-617"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets an extra key to a specific value.&quot;&quot;&quot;</span>
</span><span id="1-618">        <span class="bp">self</span><span class="o">.</span><span class="n">_extras</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

</span><span id="1-619">
<div class="viewcode-block" id="Scope.remove_extra">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.remove_extra">[docs]</a>
</span><span id="1-620">    <span class="k">def</span> <span class="nf">remove_extra</span><span class="p">(</span>
</span><span id="1-621">        <span class="bp">self</span><span class="p">,</span> <span class="n">key</span>  <span class="c1"># type: str</span>
</span><span id="1-622">    <span class="p">):</span>
</span><span id="1-623">        <span class="c1"># type: (...) -&gt; None</span>
</span><span id="1-624"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Removes a specific extra key.&quot;&quot;&quot;</span>
</span><span id="1-625">        <span class="bp">self</span><span class="o">.</span><span class="n">_extras</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

</span><span id="1-626">
<div class="viewcode-block" id="Scope.clear_breadcrumbs">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.clear_breadcrumbs">[docs]</a>
</span><span id="1-627">    <span class="k">def</span> <span class="nf">clear_breadcrumbs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-628">        <span class="c1"># type: () -&gt; None</span>
</span><span id="1-629"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clears breadcrumb buffer.&quot;&quot;&quot;</span>
</span><span id="1-630">        <span class="bp">self</span><span class="o">.</span><span class="n">_breadcrumbs</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>  <span class="c1"># type: Deque[Breadcrumb]</span></div>

</span><span id="1-631">
<div class="viewcode-block" id="Scope.add_attachment">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.add_attachment">[docs]</a>
</span><span id="1-632">    <span class="k">def</span> <span class="nf">add_attachment</span><span class="p">(</span>
</span><span id="1-633">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-634">        <span class="nb">bytes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[bytes]</span>
</span><span id="1-635">        <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[str]</span>
</span><span id="1-636">        <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[str]</span>
</span><span id="1-637">        <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[str]</span>
</span><span id="1-638">        <span class="n">add_to_transactions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># type: bool</span>
</span><span id="1-639">    <span class="p">):</span>
</span><span id="1-640">        <span class="c1"># type: (...) -&gt; None</span>
</span><span id="1-641"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds an attachment to future events sent.&quot;&quot;&quot;</span>
</span><span id="1-642">        <span class="bp">self</span><span class="o">.</span><span class="n">_attachments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="1-643">            <span class="n">Attachment</span><span class="p">(</span>
</span><span id="1-644">                <span class="nb">bytes</span><span class="o">=</span><span class="nb">bytes</span><span class="p">,</span>
</span><span id="1-645">                <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
</span><span id="1-646">                <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
</span><span id="1-647">                <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span>
</span><span id="1-648">                <span class="n">add_to_transactions</span><span class="o">=</span><span class="n">add_to_transactions</span><span class="p">,</span>
</span><span id="1-649">            <span class="p">)</span>
</span><span id="1-650">        <span class="p">)</span></div>

</span><span id="1-651">
<div class="viewcode-block" id="Scope.add_breadcrumb">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.add_breadcrumb">[docs]</a>
</span><span id="1-652">    <span class="k">def</span> <span class="nf">add_breadcrumb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crumb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="1-653">        <span class="c1"># type: (Optional[Breadcrumb], Optional[BreadcrumbHint], Any) -&gt; None</span>
</span><span id="1-654"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-655"><span class="sd">        Adds a breadcrumb.</span>
</span><span id="1-656">
</span><span id="1-657"><span class="sd">        :param crumb: Dictionary with the data as the sentry v7/v8 protocol expects.</span>
</span><span id="1-658">
</span><span id="1-659"><span class="sd">        :param hint: An optional value that can be used by `before_breadcrumb`</span>
</span><span id="1-660"><span class="sd">            to customize the breadcrumbs that are emitted.</span>
</span><span id="1-661"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-662">        <span class="n">client</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;client&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-663">        <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-664">            <span class="k">return</span>
</span><span id="1-665">
</span><span id="1-666">        <span class="n">before_breadcrumb</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;before_breadcrumb&quot;</span><span class="p">)</span>
</span><span id="1-667">        <span class="n">max_breadcrumbs</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_breadcrumbs&quot;</span><span class="p">)</span>
</span><span id="1-668">
</span><span id="1-669">        <span class="n">crumb</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">crumb</span> <span class="ow">or</span> <span class="p">())</span>  <span class="c1"># type: Breadcrumb</span>
</span><span id="1-670">        <span class="n">crumb</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="1-671">        <span class="k">if</span> <span class="ow">not</span> <span class="n">crumb</span><span class="p">:</span>
</span><span id="1-672">            <span class="k">return</span>
</span><span id="1-673">
</span><span id="1-674">        <span class="n">hint</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">hint</span> <span class="ow">or</span> <span class="p">())</span>  <span class="c1"># type: Hint</span>
</span><span id="1-675">
</span><span id="1-676">        <span class="k">if</span> <span class="n">crumb</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-677">            <span class="n">crumb</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime_utcnow</span><span class="p">()</span>
</span><span id="1-678">        <span class="k">if</span> <span class="n">crumb</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-679">            <span class="n">crumb</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
</span><span id="1-680">
</span><span id="1-681">        <span class="k">if</span> <span class="n">before_breadcrumb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-682">            <span class="n">new_crumb</span> <span class="o">=</span> <span class="n">before_breadcrumb</span><span class="p">(</span><span class="n">crumb</span><span class="p">,</span> <span class="n">hint</span><span class="p">)</span>
</span><span id="1-683">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-684">            <span class="n">new_crumb</span> <span class="o">=</span> <span class="n">crumb</span>
</span><span id="1-685">
</span><span id="1-686">        <span class="k">if</span> <span class="n">new_crumb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-687">            <span class="bp">self</span><span class="o">.</span><span class="n">_breadcrumbs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_crumb</span><span class="p">)</span>
</span><span id="1-688">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-689">            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;before breadcrumb dropped breadcrumb (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">crumb</span><span class="p">)</span>
</span><span id="1-690">
</span><span id="1-691">        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_breadcrumbs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_breadcrumbs</span><span class="p">:</span>
</span><span id="1-692">            <span class="bp">self</span><span class="o">.</span><span class="n">_breadcrumbs</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span></div>

</span><span id="1-693">
<div class="viewcode-block" id="Scope.start_transaction">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.start_transaction">[docs]</a>
</span><span id="1-694">    <span class="k">def</span> <span class="nf">start_transaction</span><span class="p">(</span>
</span><span id="1-695">        <span class="bp">self</span><span class="p">,</span> <span class="n">transaction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">instrumenter</span><span class="o">=</span><span class="n">INSTRUMENTER</span><span class="o">.</span><span class="n">SENTRY</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
</span><span id="1-696">    <span class="p">):</span>
</span><span id="1-697">        <span class="c1"># type: (Optional[Transaction], str, Any) -&gt; Union[Transaction, NoOpSpan]</span>
</span><span id="1-698"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-699"><span class="sd">        Start and return a transaction.</span>
</span><span id="1-700">
</span><span id="1-701"><span class="sd">        Start an existing transaction if given, otherwise create and start a new</span>
</span><span id="1-702"><span class="sd">        transaction with kwargs.</span>
</span><span id="1-703">
</span><span id="1-704"><span class="sd">        This is the entry point to manual tracing instrumentation.</span>
</span><span id="1-705">
</span><span id="1-706"><span class="sd">        A tree structure can be built by adding child spans to the transaction,</span>
</span><span id="1-707"><span class="sd">        and child spans to other spans. To start a new child span within the</span>
</span><span id="1-708"><span class="sd">        transaction or any span, call the respective `.start_child()` method.</span>
</span><span id="1-709">
</span><span id="1-710"><span class="sd">        Every child span must be finished before the transaction is finished,</span>
</span><span id="1-711"><span class="sd">        otherwise the unfinished spans are discarded.</span>
</span><span id="1-712">
</span><span id="1-713"><span class="sd">        When used as context managers, spans and transactions are automatically</span>
</span><span id="1-714"><span class="sd">        finished at the end of the `with` block. If not using context managers,</span>
</span><span id="1-715"><span class="sd">        call the `.finish()` method.</span>
</span><span id="1-716">
</span><span id="1-717"><span class="sd">        When the transaction is finished, it will be sent to Sentry with all its</span>
</span><span id="1-718"><span class="sd">        finished child spans.</span>
</span><span id="1-719">
</span><span id="1-720"><span class="sd">        For supported `**kwargs` see :py:class:`sentry_sdk.tracing.Transaction`.</span>
</span><span id="1-721"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-722">        <span class="n">hub</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;hub&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-723">        <span class="n">client</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;client&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-724">
</span><span id="1-725">        <span class="n">configuration_instrumenter</span> <span class="o">=</span> <span class="n">client</span> <span class="ow">and</span> <span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;instrumenter&quot;</span><span class="p">]</span>
</span><span id="1-726">
</span><span id="1-727">        <span class="k">if</span> <span class="n">instrumenter</span> <span class="o">!=</span> <span class="n">configuration_instrumenter</span><span class="p">:</span>
</span><span id="1-728">            <span class="k">return</span> <span class="n">NoOpSpan</span><span class="p">()</span>
</span><span id="1-729">
</span><span id="1-730">        <span class="n">custom_sampling_context</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;custom_sampling_context&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="1-731">
</span><span id="1-732">        <span class="c1"># if we haven&#39;t been given a transaction, make one</span>
</span><span id="1-733">        <span class="k">if</span> <span class="n">transaction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-734">            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;hub&quot;</span><span class="p">,</span> <span class="n">hub</span><span class="p">)</span>
</span><span id="1-735">            <span class="n">transaction</span> <span class="o">=</span> <span class="n">Transaction</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="1-736">
</span><span id="1-737">        <span class="c1"># use traces_sample_rate, traces_sampler, and/or inheritance to make a</span>
</span><span id="1-738">        <span class="c1"># sampling decision</span>
</span><span id="1-739">        <span class="n">sampling_context</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="1-740">            <span class="s2">&quot;transaction_context&quot;</span><span class="p">:</span> <span class="n">transaction</span><span class="o">.</span><span class="n">to_json</span><span class="p">(),</span>
</span><span id="1-741">            <span class="s2">&quot;parent_sampled&quot;</span><span class="p">:</span> <span class="n">transaction</span><span class="o">.</span><span class="n">parent_sampled</span><span class="p">,</span>
</span><span id="1-742">        <span class="p">}</span>
</span><span id="1-743">        <span class="n">sampling_context</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">custom_sampling_context</span><span class="p">)</span>
</span><span id="1-744">        <span class="n">transaction</span><span class="o">.</span><span class="n">_set_initial_sampling_decision</span><span class="p">(</span><span class="n">sampling_context</span><span class="o">=</span><span class="n">sampling_context</span><span class="p">)</span>
</span><span id="1-745">
</span><span id="1-746">        <span class="n">profile</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">(</span><span class="n">transaction</span><span class="p">,</span> <span class="n">hub</span><span class="o">=</span><span class="n">hub</span><span class="p">)</span>
</span><span id="1-747">        <span class="n">profile</span><span class="o">.</span><span class="n">_set_initial_sampling_decision</span><span class="p">(</span><span class="n">sampling_context</span><span class="o">=</span><span class="n">sampling_context</span><span class="p">)</span>
</span><span id="1-748">
</span><span id="1-749">        <span class="c1"># we don&#39;t bother to keep spans if we already know we&#39;re not going to</span>
</span><span id="1-750">        <span class="c1"># send the transaction</span>
</span><span id="1-751">        <span class="k">if</span> <span class="n">transaction</span><span class="o">.</span><span class="n">sampled</span><span class="p">:</span>
</span><span id="1-752">            <span class="n">max_spans</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-753">                <span class="n">client</span> <span class="ow">and</span> <span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;_experiments&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_spans&quot;</span><span class="p">)</span>
</span><span id="1-754">            <span class="p">)</span> <span class="ow">or</span> <span class="mi">1000</span>
</span><span id="1-755">            <span class="n">transaction</span><span class="o">.</span><span class="n">init_span_recorder</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="n">max_spans</span><span class="p">)</span>
</span><span id="1-756">
</span><span id="1-757">        <span class="k">return</span> <span class="n">transaction</span></div>

</span><span id="1-758">
<div class="viewcode-block" id="Scope.start_span">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.start_span">[docs]</a>
</span><span id="1-759">    <span class="k">def</span> <span class="nf">start_span</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">span</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">instrumenter</span><span class="o">=</span><span class="n">INSTRUMENTER</span><span class="o">.</span><span class="n">SENTRY</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="1-760">        <span class="c1"># type: (Optional[Span], str, Any) -&gt; Span</span>
</span><span id="1-761"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-762"><span class="sd">        Start a span whose parent is the currently active span or transaction, if any.</span>
</span><span id="1-763">
</span><span id="1-764"><span class="sd">        The return value is a :py:class:`sentry_sdk.tracing.Span` instance,</span>
</span><span id="1-765"><span class="sd">        typically used as a context manager to start and stop timing in a `with`</span>
</span><span id="1-766"><span class="sd">        block.</span>
</span><span id="1-767">
</span><span id="1-768"><span class="sd">        Only spans contained in a transaction are sent to Sentry. Most</span>
</span><span id="1-769"><span class="sd">        integrations start a transaction at the appropriate time, for example</span>
</span><span id="1-770"><span class="sd">        for every incoming HTTP request. Use</span>
</span><span id="1-771"><span class="sd">        :py:meth:`sentry_sdk.start_transaction` to start a new transaction when</span>
</span><span id="1-772"><span class="sd">        one is not already in progress.</span>
</span><span id="1-773">
</span><span id="1-774"><span class="sd">        For supported `**kwargs` see :py:class:`sentry_sdk.tracing.Span`.</span>
</span><span id="1-775"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-776">        <span class="n">client</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;client&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-777">
</span><span id="1-778">        <span class="n">configuration_instrumenter</span> <span class="o">=</span> <span class="n">client</span> <span class="ow">and</span> <span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;instrumenter&quot;</span><span class="p">]</span>
</span><span id="1-779">
</span><span id="1-780">        <span class="k">if</span> <span class="n">instrumenter</span> <span class="o">!=</span> <span class="n">configuration_instrumenter</span><span class="p">:</span>
</span><span id="1-781">            <span class="k">return</span> <span class="n">NoOpSpan</span><span class="p">()</span>
</span><span id="1-782">
</span><span id="1-783">        <span class="c1"># THIS BLOCK IS DEPRECATED</span>
</span><span id="1-784">        <span class="c1"># TODO: consider removing this in a future release.</span>
</span><span id="1-785">        <span class="c1"># This is for backwards compatibility with releases before</span>
</span><span id="1-786">        <span class="c1"># start_transaction existed, to allow for a smoother transition.</span>
</span><span id="1-787">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">span</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;transaction&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="1-788">            <span class="n">deprecation_msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="1-789">                <span class="s2">&quot;Deprecated: use start_transaction to start transactions and &quot;</span>
</span><span id="1-790">                <span class="s2">&quot;Transaction.start_child to start spans.&quot;</span>
</span><span id="1-791">            <span class="p">)</span>
</span><span id="1-792">
</span><span id="1-793">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">span</span><span class="p">,</span> <span class="n">Transaction</span><span class="p">):</span>
</span><span id="1-794">                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">deprecation_msg</span><span class="p">)</span>
</span><span id="1-795">                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_transaction</span><span class="p">(</span><span class="n">span</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="1-796">
</span><span id="1-797">            <span class="k">if</span> <span class="s2">&quot;transaction&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="1-798">                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">deprecation_msg</span><span class="p">)</span>
</span><span id="1-799">                <span class="n">name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;transaction&quot;</span><span class="p">)</span>
</span><span id="1-800">                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_transaction</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="1-801">
</span><span id="1-802">        <span class="c1"># THIS BLOCK IS DEPRECATED</span>
</span><span id="1-803">        <span class="c1"># We do not pass a span into start_span in our code base, so I deprecate this.</span>
</span><span id="1-804">        <span class="k">if</span> <span class="n">span</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-805">            <span class="n">deprecation_msg</span> <span class="o">=</span> <span class="s2">&quot;Deprecated: passing a span into `start_span` is deprecated and will be removed in the future.&quot;</span>
</span><span id="1-806">            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">deprecation_msg</span><span class="p">)</span>
</span><span id="1-807">            <span class="k">return</span> <span class="n">span</span>
</span><span id="1-808">
</span><span id="1-809">        <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;client&quot;</span><span class="p">)</span>
</span><span id="1-810">
</span><span id="1-811">        <span class="n">active_span</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">span</span>
</span><span id="1-812">        <span class="k">if</span> <span class="n">active_span</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-813">            <span class="n">new_child_span</span> <span class="o">=</span> <span class="n">active_span</span><span class="o">.</span><span class="n">start_child</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="1-814">            <span class="k">return</span> <span class="n">new_child_span</span>
</span><span id="1-815">
</span><span id="1-816">        <span class="c1"># If there is already a trace_id in the propagation context, use it.</span>
</span><span id="1-817">        <span class="c1"># This does not need to be done for `start_child` above because it takes</span>
</span><span id="1-818">        <span class="c1"># the trace_id from the parent span.</span>
</span><span id="1-819">        <span class="k">if</span> <span class="s2">&quot;trace_id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="1-820">            <span class="n">traceparent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_traceparent</span><span class="p">()</span>
</span><span id="1-821">            <span class="n">trace_id</span> <span class="o">=</span> <span class="n">traceparent</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">traceparent</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="1-822">            <span class="k">if</span> <span class="n">trace_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-823">                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;trace_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace_id</span>
</span><span id="1-824">
</span><span id="1-825">        <span class="k">return</span> <span class="n">Span</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

</span><span id="1-826">
<div class="viewcode-block" id="Scope.continue_trace">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.continue_trace">[docs]</a>
</span><span id="1-827">    <span class="k">def</span> <span class="nf">continue_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ_or_headers</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="1-828">        <span class="c1"># type: (Dict[str, Any], Optional[str], Optional[str], Optional[str]) -&gt; Transaction</span>
</span><span id="1-829"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-830"><span class="sd">        Sets the propagation context from environment or headers and returns a transaction.</span>
</span><span id="1-831"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-832">        <span class="bp">self</span><span class="o">.</span><span class="n">generate_propagation_context</span><span class="p">(</span><span class="n">environ_or_headers</span><span class="p">)</span>
</span><span id="1-833">
</span><span id="1-834">        <span class="n">transaction</span> <span class="o">=</span> <span class="n">Transaction</span><span class="o">.</span><span class="n">continue_from_headers</span><span class="p">(</span>
</span><span id="1-835">            <span class="n">normalize_incoming_data</span><span class="p">(</span><span class="n">environ_or_headers</span><span class="p">),</span>
</span><span id="1-836">            <span class="n">op</span><span class="o">=</span><span class="n">op</span><span class="p">,</span>
</span><span id="1-837">            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="1-838">            <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
</span><span id="1-839">        <span class="p">)</span>
</span><span id="1-840">
</span><span id="1-841">        <span class="k">return</span> <span class="n">transaction</span></div>

</span><span id="1-842">
<div class="viewcode-block" id="Scope.capture_event">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.capture_event">[docs]</a>
</span><span id="1-843">    <span class="k">def</span> <span class="nf">capture_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">scope_kwargs</span><span class="p">):</span>
</span><span id="1-844">        <span class="c1"># type: (Event, Optional[Hint], Optional[sentry_sdk.Client], Optional[Scope], Any) -&gt; Optional[str]</span>
</span><span id="1-845"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-846"><span class="sd">        Captures an event.</span>
</span><span id="1-847">
</span><span id="1-848"><span class="sd">        Merges given scope data and calls :py:meth:`sentry_sdk.Client.capture_event`.</span>
</span><span id="1-849">
</span><span id="1-850"><span class="sd">        :param event: A ready-made event that can be directly sent to Sentry.</span>
</span><span id="1-851">
</span><span id="1-852"><span class="sd">        :param hint: Contains metadata about the event that can be read from `before_send`, such as the original exception object or a HTTP request object.</span>
</span><span id="1-853">
</span><span id="1-854"><span class="sd">        :param client: The client to use for sending the event to Sentry.</span>
</span><span id="1-855">
</span><span id="1-856"><span class="sd">        :param scope: An optional :py:class:`sentry_sdk.Scope` to apply to events.</span>
</span><span id="1-857"><span class="sd">            The `scope` and `scope_kwargs` parameters are mutually exclusive.</span>
</span><span id="1-858">
</span><span id="1-859"><span class="sd">        :param scope_kwargs: Optional data to apply to event.</span>
</span><span id="1-860"><span class="sd">            For supported `**scope_kwargs` see :py:meth:`sentry_sdk.Scope.update_from_kwargs`.</span>
</span><span id="1-861"><span class="sd">            The `scope` and `scope_kwargs` parameters are mutually exclusive.</span>
</span><span id="1-862">
</span><span id="1-863"><span class="sd">        :returns: An `event_id` if the SDK decided to send the event (see :py:meth:`sentry_sdk.Client.capture_event`).</span>
</span><span id="1-864"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-865">        <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-866">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-867">
</span><span id="1-868">        <span class="n">scope</span> <span class="o">=</span> <span class="n">_merge_scopes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span> <span class="n">scope_kwargs</span><span class="p">)</span>
</span><span id="1-869">
</span><span id="1-870">        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">capture_event</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="n">hint</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="n">scope</span><span class="p">)</span></div>

</span><span id="1-871">
<div class="viewcode-block" id="Scope.capture_message">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.capture_message">[docs]</a>
</span><span id="1-872">    <span class="k">def</span> <span class="nf">capture_message</span><span class="p">(</span>
</span><span id="1-873">        <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">scope_kwargs</span>
</span><span id="1-874">    <span class="p">):</span>
</span><span id="1-875">        <span class="c1"># type: (str, Optional[LogLevelStr], Optional[sentry_sdk.Client], Optional[Scope], Any) -&gt; Optional[str]</span>
</span><span id="1-876"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-877"><span class="sd">        Captures a message.</span>
</span><span id="1-878">
</span><span id="1-879"><span class="sd">        :param message: The string to send as the message.</span>
</span><span id="1-880">
</span><span id="1-881"><span class="sd">        :param level: If no level is provided, the default level is `info`.</span>
</span><span id="1-882">
</span><span id="1-883"><span class="sd">        :param client: The client to use for sending the event to Sentry.</span>
</span><span id="1-884">
</span><span id="1-885"><span class="sd">        :param scope: An optional :py:class:`sentry_sdk.Scope` to apply to events.</span>
</span><span id="1-886"><span class="sd">            The `scope` and `scope_kwargs` parameters are mutually exclusive.</span>
</span><span id="1-887">
</span><span id="1-888"><span class="sd">        :param scope_kwargs: Optional data to apply to event.</span>
</span><span id="1-889"><span class="sd">            For supported `**scope_kwargs` see :py:meth:`sentry_sdk.Scope.update_from_kwargs`.</span>
</span><span id="1-890"><span class="sd">            The `scope` and `scope_kwargs` parameters are mutually exclusive.</span>
</span><span id="1-891">
</span><span id="1-892"><span class="sd">        :returns: An `event_id` if the SDK decided to send the event (see :py:meth:`sentry_sdk.Client.capture_event`).</span>
</span><span id="1-893"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-894">        <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-895">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-896">
</span><span id="1-897">        <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-898">            <span class="n">level</span> <span class="o">=</span> <span class="s2">&quot;info&quot;</span>
</span><span id="1-899">
</span><span id="1-900">        <span class="n">event</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="1-901">            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
</span><span id="1-902">            <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="n">level</span><span class="p">,</span>
</span><span id="1-903">        <span class="p">}</span>  <span class="c1"># type: Event</span>
</span><span id="1-904">
</span><span id="1-905">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">capture_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="n">scope</span><span class="p">,</span> <span class="o">**</span><span class="n">scope_kwargs</span><span class="p">)</span></div>

</span><span id="1-906">
<div class="viewcode-block" id="Scope.capture_exception">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.capture_exception">[docs]</a>
</span><span id="1-907">    <span class="k">def</span> <span class="nf">capture_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">scope_kwargs</span><span class="p">):</span>
</span><span id="1-908">        <span class="c1"># type: (Optional[Union[BaseException, ExcInfo]], Optional[sentry_sdk.Client], Optional[Scope], Any) -&gt; Optional[str]</span>
</span><span id="1-909"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Captures an exception.</span>
</span><span id="1-910">
</span><span id="1-911"><span class="sd">        :param error: An exception to capture. If `None`, `sys.exc_info()` will be used.</span>
</span><span id="1-912">
</span><span id="1-913"><span class="sd">        :param client: The client to use for sending the event to Sentry.</span>
</span><span id="1-914">
</span><span id="1-915"><span class="sd">        :param scope: An optional :py:class:`sentry_sdk.Scope` to apply to events.</span>
</span><span id="1-916"><span class="sd">            The `scope` and `scope_kwargs` parameters are mutually exclusive.</span>
</span><span id="1-917">
</span><span id="1-918"><span class="sd">        :param scope_kwargs: Optional data to apply to event.</span>
</span><span id="1-919"><span class="sd">            For supported `**scope_kwargs` see :py:meth:`sentry_sdk.Scope.update_from_kwargs`.</span>
</span><span id="1-920"><span class="sd">            The `scope` and `scope_kwargs` parameters are mutually exclusive.</span>
</span><span id="1-921">
</span><span id="1-922"><span class="sd">        :returns: An `event_id` if the SDK decided to send the event (see :py:meth:`sentry_sdk.Client.capture_event`).</span>
</span><span id="1-923"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-924">        <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-925">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-926">
</span><span id="1-927">        <span class="k">if</span> <span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-928">            <span class="n">exc_info</span> <span class="o">=</span> <span class="n">exc_info_from_error</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
</span><span id="1-929">        <span class="k">else</span><span class="p">:</span>
</span><span id="1-930">            <span class="n">exc_info</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
</span><span id="1-931">
</span><span id="1-932">        <span class="n">event</span><span class="p">,</span> <span class="n">hint</span> <span class="o">=</span> <span class="n">event_from_exception</span><span class="p">(</span><span class="n">exc_info</span><span class="p">,</span> <span class="n">client_options</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
</span><span id="1-933">
</span><span id="1-934">        <span class="k">try</span><span class="p">:</span>
</span><span id="1-935">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">capture_event</span><span class="p">(</span>
</span><span id="1-936">                <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="n">hint</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="n">scope</span><span class="p">,</span> <span class="o">**</span><span class="n">scope_kwargs</span>
</span><span id="1-937">            <span class="p">)</span>
</span><span id="1-938">        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="1-939">            <span class="bp">self</span><span class="o">.</span><span class="n">_capture_internal_exception</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())</span>
</span><span id="1-940">
</span><span id="1-941">        <span class="k">return</span> <span class="kc">None</span></div>

</span><span id="1-942">
</span><span id="1-943">    <span class="k">def</span> <span class="nf">_capture_internal_exception</span><span class="p">(</span>
</span><span id="1-944">        <span class="bp">self</span><span class="p">,</span> <span class="n">exc_info</span>  <span class="c1"># type: Any</span>
</span><span id="1-945">    <span class="p">):</span>
</span><span id="1-946">        <span class="c1"># type: (...) -&gt; Any</span>
</span><span id="1-947"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="1-948"><span class="sd">        Capture an exception that is likely caused by a bug in the SDK</span>
</span><span id="1-949"><span class="sd">        itself.</span>
</span><span id="1-950">
</span><span id="1-951"><span class="sd">        These exceptions do not end up in Sentry and are just logged instead.</span>
</span><span id="1-952"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-953">        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Internal error in sentry_sdk&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="n">exc_info</span><span class="p">)</span>
</span><span id="1-954">
<div class="viewcode-block" id="Scope.start_session">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.start_session">[docs]</a>
</span><span id="1-955">    <span class="k">def</span> <span class="nf">start_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="1-956">        <span class="c1"># type: (*Any, **Any) -&gt; None</span>
</span><span id="1-957"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Starts a new session.&quot;&quot;&quot;</span>
</span><span id="1-958">        <span class="n">client</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;client&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-959">        <span class="n">session_mode</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;session_mode&quot;</span><span class="p">,</span> <span class="s2">&quot;application&quot;</span><span class="p">)</span>
</span><span id="1-960">
</span><span id="1-961">        <span class="bp">self</span><span class="o">.</span><span class="n">end_session</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>
</span><span id="1-962">
</span><span id="1-963">        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span>
</span><span id="1-964">            <span class="n">release</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;release&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">client</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-965">            <span class="n">environment</span><span class="o">=</span><span class="n">client</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;environment&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">client</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="1-966">            <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="p">,</span>
</span><span id="1-967">            <span class="n">session_mode</span><span class="o">=</span><span class="n">session_mode</span><span class="p">,</span>
</span><span id="1-968">        <span class="p">)</span></div>

</span><span id="1-969">
<div class="viewcode-block" id="Scope.end_session">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.end_session">[docs]</a>
</span><span id="1-970">    <span class="k">def</span> <span class="nf">end_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="1-971">        <span class="c1"># type: (*Any, **Any) -&gt; None</span>
</span><span id="1-972"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ends the current session if there is one.&quot;&quot;&quot;</span>
</span><span id="1-973">        <span class="n">client</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;client&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-974">
</span><span id="1-975">        <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span>
</span><span id="1-976">        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-977">
</span><span id="1-978">        <span class="k">if</span> <span class="n">session</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-979">            <span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="1-980">            <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-981">                <span class="n">client</span><span class="o">.</span><span class="n">capture_session</span><span class="p">(</span><span class="n">session</span><span class="p">)</span></div>

</span><span id="1-982">
<div class="viewcode-block" id="Scope.stop_auto_session_tracking">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.stop_auto_session_tracking">[docs]</a>
</span><span id="1-983">    <span class="k">def</span> <span class="nf">stop_auto_session_tracking</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="1-984">        <span class="c1"># type: (*Any, **Any) -&gt; None</span>
</span><span id="1-985"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stops automatic session tracking.</span>
</span><span id="1-986">
</span><span id="1-987"><span class="sd">        This temporarily session tracking for the current scope when called.</span>
</span><span id="1-988"><span class="sd">        To resume session tracking call `resume_auto_session_tracking`.</span>
</span><span id="1-989"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-990">        <span class="n">client</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;client&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="1-991">
</span><span id="1-992">        <span class="bp">self</span><span class="o">.</span><span class="n">end_session</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>
</span><span id="1-993">
</span><span id="1-994">        <span class="bp">self</span><span class="o">.</span><span class="n">_force_auto_session_tracking</span> <span class="o">=</span> <span class="kc">False</span></div>

</span><span id="1-995">
<div class="viewcode-block" id="Scope.resume_auto_session_tracking">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.resume_auto_session_tracking">[docs]</a>
</span><span id="1-996">    <span class="k">def</span> <span class="nf">resume_auto_session_tracking</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-997">        <span class="c1"># type: (...) -&gt; None</span>
</span><span id="1-998"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Resumes automatic session tracking for the current scope if</span>
</span><span id="1-999"><span class="sd">        disabled earlier.  This requires that generally automatic session</span>
</span><span id="1-1000"><span class="sd">        tracking is enabled.</span>
</span><span id="1-1001"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1002">        <span class="bp">self</span><span class="o">.</span><span class="n">_force_auto_session_tracking</span> <span class="o">=</span> <span class="kc">None</span></div>

</span><span id="1-1003">
<div class="viewcode-block" id="Scope.add_event_processor">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.add_event_processor">[docs]</a>
</span><span id="1-1004">    <span class="k">def</span> <span class="nf">add_event_processor</span><span class="p">(</span>
</span><span id="1-1005">        <span class="bp">self</span><span class="p">,</span> <span class="n">func</span>  <span class="c1"># type: EventProcessor</span>
</span><span id="1-1006">    <span class="p">):</span>
</span><span id="1-1007">        <span class="c1"># type: (...) -&gt; None</span>
</span><span id="1-1008"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a scope local event processor on the scope.</span>
</span><span id="1-1009">
</span><span id="1-1010"><span class="sd">        :param func: This function behaves like `before_send.`</span>
</span><span id="1-1011"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1012">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_event_processors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
</span><span id="1-1013">            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="1-1014">                <span class="s2">&quot;Too many event processors on scope! Clearing list to free up some memory: </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="1-1015">                <span class="bp">self</span><span class="o">.</span><span class="n">_event_processors</span><span class="p">,</span>
</span><span id="1-1016">            <span class="p">)</span>
</span><span id="1-1017">            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event_processors</span><span class="p">[:]</span>
</span><span id="1-1018">
</span><span id="1-1019">        <span class="bp">self</span><span class="o">.</span><span class="n">_event_processors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></div>

</span><span id="1-1020">
<div class="viewcode-block" id="Scope.add_error_processor">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.add_error_processor">[docs]</a>
</span><span id="1-1021">    <span class="k">def</span> <span class="nf">add_error_processor</span><span class="p">(</span>
</span><span id="1-1022">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1023">        <span class="n">func</span><span class="p">,</span>  <span class="c1"># type: ErrorProcessor</span>
</span><span id="1-1024">        <span class="bp">cls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[Type[BaseException]]</span>
</span><span id="1-1025">    <span class="p">):</span>
</span><span id="1-1026">        <span class="c1"># type: (...) -&gt; None</span>
</span><span id="1-1027"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a scope local error processor on the scope.</span>
</span><span id="1-1028">
</span><span id="1-1029"><span class="sd">        :param func: A callback that works similar to an event processor but is invoked with the original exception info triple as second argument.</span>
</span><span id="1-1030">
</span><span id="1-1031"><span class="sd">        :param cls: Optionally, only process exceptions of this type.</span>
</span><span id="1-1032"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="1-1033">        <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1034">            <span class="n">cls_</span> <span class="o">=</span> <span class="bp">cls</span>  <span class="c1"># For mypy.</span>
</span><span id="1-1035">            <span class="n">real_func</span> <span class="o">=</span> <span class="n">func</span>
</span><span id="1-1036">
</span><span id="1-1037">            <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">exc_info</span><span class="p">):</span>
</span><span id="1-1038">                <span class="c1"># type: (Event, ExcInfo) -&gt; Optional[Event]</span>
</span><span id="1-1039">                <span class="k">try</span><span class="p">:</span>
</span><span id="1-1040">                    <span class="n">is_inst</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc_info</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cls_</span><span class="p">)</span>
</span><span id="1-1041">                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="1-1042">                    <span class="n">is_inst</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="1-1043">                <span class="k">if</span> <span class="n">is_inst</span><span class="p">:</span>
</span><span id="1-1044">                    <span class="k">return</span> <span class="n">real_func</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">exc_info</span><span class="p">)</span>
</span><span id="1-1045">                <span class="k">return</span> <span class="n">event</span>
</span><span id="1-1046">
</span><span id="1-1047">        <span class="bp">self</span><span class="o">.</span><span class="n">_error_processors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></div>

</span><span id="1-1048">
</span><span id="1-1049">    <span class="k">def</span> <span class="nf">_apply_level_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span id="1-1050">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span id="1-1051">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1052">            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_level</span>
</span><span id="1-1053">
</span><span id="1-1054">    <span class="k">def</span> <span class="nf">_apply_breadcrumbs_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span id="1-1055">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span id="1-1056">        <span class="n">event</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;breadcrumbs&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;values&quot;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
</span><span id="1-1057">            <span class="bp">self</span><span class="o">.</span><span class="n">_breadcrumbs</span>
</span><span id="1-1058">        <span class="p">)</span>
</span><span id="1-1059">
</span><span id="1-1060">    <span class="k">def</span> <span class="nf">_apply_user_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span id="1-1061">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span id="1-1062">        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1063">            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span>
</span><span id="1-1064">
</span><span id="1-1065">    <span class="k">def</span> <span class="nf">_apply_transaction_name_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span id="1-1066">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span id="1-1067">        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;transaction&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transaction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1068">            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;transaction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transaction</span>
</span><span id="1-1069">
</span><span id="1-1070">    <span class="k">def</span> <span class="nf">_apply_transaction_info_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span id="1-1071">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span id="1-1072">        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;transaction_info&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transaction_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1073">            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;transaction_info&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transaction_info</span>
</span><span id="1-1074">
</span><span id="1-1075">    <span class="k">def</span> <span class="nf">_apply_fingerprint_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span id="1-1076">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span id="1-1077">        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fingerprint&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1078">            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;fingerprint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span>
</span><span id="1-1079">
</span><span id="1-1080">    <span class="k">def</span> <span class="nf">_apply_extra_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span id="1-1081">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span id="1-1082">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extras</span><span class="p">:</span>
</span><span id="1-1083">            <span class="n">event</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;extra&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_extras</span><span class="p">)</span>
</span><span id="1-1084">
</span><span id="1-1085">    <span class="k">def</span> <span class="nf">_apply_tags_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span id="1-1086">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span id="1-1087">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="p">:</span>
</span><span id="1-1088">            <span class="n">event</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="p">)</span>
</span><span id="1-1089">
</span><span id="1-1090">    <span class="k">def</span> <span class="nf">_apply_contexts_to_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
</span><span id="1-1091">        <span class="c1"># type: (Event, Hint, Optional[Dict[str, Any]]) -&gt; None</span>
</span><span id="1-1092">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="p">:</span>
</span><span id="1-1093">            <span class="n">event</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;contexts&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="p">)</span>
</span><span id="1-1094">
</span><span id="1-1095">        <span class="n">contexts</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;contexts&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="1-1096">
</span><span id="1-1097">        <span class="c1"># Add &quot;trace&quot; context</span>
</span><span id="1-1098">        <span class="k">if</span> <span class="n">contexts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;trace&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1099">            <span class="k">if</span> <span class="n">has_tracing_enabled</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1100">                <span class="n">contexts</span><span class="p">[</span><span class="s2">&quot;trace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span><span class="o">.</span><span class="n">get_trace_context</span><span class="p">()</span>
</span><span id="1-1101">            <span class="k">else</span><span class="p">:</span>
</span><span id="1-1102">                <span class="n">contexts</span><span class="p">[</span><span class="s2">&quot;trace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trace_context</span><span class="p">()</span>
</span><span id="1-1103">
</span><span id="1-1104">        <span class="c1"># Add &quot;reply_id&quot; context</span>
</span><span id="1-1105">        <span class="k">try</span><span class="p">:</span>
</span><span id="1-1106">            <span class="n">replay_id</span> <span class="o">=</span> <span class="n">contexts</span><span class="p">[</span><span class="s2">&quot;trace&quot;</span><span class="p">][</span><span class="s2">&quot;dynamic_sampling_context&quot;</span><span class="p">][</span><span class="s2">&quot;replay_id&quot;</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
</span><span id="1-1107">        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
</span><span id="1-1108">            <span class="n">replay_id</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="1-1109">
</span><span id="1-1110">        <span class="k">if</span> <span class="n">replay_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1111">            <span class="n">contexts</span><span class="p">[</span><span class="s2">&quot;replay&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="1-1112">                <span class="s2">&quot;replay_id&quot;</span><span class="p">:</span> <span class="n">replay_id</span><span class="p">,</span>
</span><span id="1-1113">            <span class="p">}</span>
</span><span id="1-1114">
<div class="viewcode-block" id="Scope.apply_to_event">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.apply_to_event">[docs]</a>
</span><span id="1-1115">    <span class="nd">@_disable_capture</span>
</span><span id="1-1116">    <span class="k">def</span> <span class="nf">apply_to_event</span><span class="p">(</span>
</span><span id="1-1117">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1118">        <span class="n">event</span><span class="p">,</span>  <span class="c1"># type: Event</span>
</span><span id="1-1119">        <span class="n">hint</span><span class="p">,</span>  <span class="c1"># type: Hint</span>
</span><span id="1-1120">        <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[Dict[str, Any]]</span>
</span><span id="1-1121">    <span class="p">):</span>
</span><span id="1-1122">        <span class="c1"># type: (...) -&gt; Optional[Event]</span>
</span><span id="1-1123"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Applies the information contained on the scope to the given event.&quot;&quot;&quot;</span>
</span><span id="1-1124">        <span class="n">ty</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
</span><span id="1-1125">        <span class="n">is_transaction</span> <span class="o">=</span> <span class="n">ty</span> <span class="o">==</span> <span class="s2">&quot;transaction&quot;</span>
</span><span id="1-1126">        <span class="n">is_check_in</span> <span class="o">=</span> <span class="n">ty</span> <span class="o">==</span> <span class="s2">&quot;check_in&quot;</span>
</span><span id="1-1127">
</span><span id="1-1128">        <span class="c1"># put all attachments into the hint. This lets callbacks play around</span>
</span><span id="1-1129">        <span class="c1"># with attachments. We also later pull this out of the hint when we</span>
</span><span id="1-1130">        <span class="c1"># create the envelope.</span>
</span><span id="1-1131">        <span class="n">attachments_to_send</span> <span class="o">=</span> <span class="n">hint</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attachments&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span>
</span><span id="1-1132">        <span class="k">for</span> <span class="n">attachment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attachments</span><span class="p">:</span>
</span><span id="1-1133">            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_transaction</span> <span class="ow">or</span> <span class="n">attachment</span><span class="o">.</span><span class="n">add_to_transactions</span><span class="p">:</span>
</span><span id="1-1134">                <span class="n">attachments_to_send</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attachment</span><span class="p">)</span>
</span><span id="1-1135">        <span class="n">hint</span><span class="p">[</span><span class="s2">&quot;attachments&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">attachments_to_send</span>
</span><span id="1-1136">
</span><span id="1-1137">        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_contexts_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span id="1-1138">
</span><span id="1-1139">        <span class="k">if</span> <span class="n">is_check_in</span><span class="p">:</span>
</span><span id="1-1140">            <span class="c1"># Check-ins only support the trace context, strip all others</span>
</span><span id="1-1141">            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;contexts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="1-1142">                <span class="s2">&quot;trace&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;contexts&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;trace&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="1-1143">            <span class="p">}</span>
</span><span id="1-1144">
</span><span id="1-1145">        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_check_in</span><span class="p">:</span>
</span><span id="1-1146">            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_level_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span id="1-1147">            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_fingerprint_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span id="1-1148">            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_user_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span id="1-1149">            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_transaction_name_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span id="1-1150">            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_transaction_info_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span id="1-1151">            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_tags_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span id="1-1152">            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_extra_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span id="1-1153">
</span><span id="1-1154">        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_transaction</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_check_in</span><span class="p">:</span>
</span><span id="1-1155">            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_breadcrumbs_to_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span id="1-1156">
</span><span id="1-1157">        <span class="k">def</span> <span class="nf">_drop</span><span class="p">(</span><span class="n">cause</span><span class="p">,</span> <span class="n">ty</span><span class="p">):</span>
</span><span id="1-1158">            <span class="c1"># type: (Any, str) -&gt; Optional[Any]</span>
</span><span id="1-1159">            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">) dropped event&quot;</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="n">cause</span><span class="p">)</span>
</span><span id="1-1160">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="1-1161">
</span><span id="1-1162">        <span class="c1"># run error processors</span>
</span><span id="1-1163">        <span class="n">exc_info</span> <span class="o">=</span> <span class="n">hint</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;exc_info&quot;</span><span class="p">)</span>
</span><span id="1-1164">        <span class="k">if</span> <span class="n">exc_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1165">            <span class="k">for</span> <span class="n">error_processor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_error_processors</span><span class="p">:</span>
</span><span id="1-1166">                <span class="n">new_event</span> <span class="o">=</span> <span class="n">error_processor</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">exc_info</span><span class="p">)</span>
</span><span id="1-1167">                <span class="k">if</span> <span class="n">new_event</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1168">                    <span class="k">return</span> <span class="n">_drop</span><span class="p">(</span><span class="n">error_processor</span><span class="p">,</span> <span class="s2">&quot;error processor&quot;</span><span class="p">)</span>
</span><span id="1-1169">
</span><span id="1-1170">                <span class="n">event</span> <span class="o">=</span> <span class="n">new_event</span>
</span><span id="1-1171">
</span><span id="1-1172">        <span class="c1"># run event processors</span>
</span><span id="1-1173">        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_check_in</span><span class="p">:</span>
</span><span id="1-1174">            <span class="k">for</span> <span class="n">event_processor</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">(</span>
</span><span id="1-1175">                <span class="n">global_event_processors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event_processors</span>
</span><span id="1-1176">            <span class="p">):</span>
</span><span id="1-1177">                <span class="n">new_event</span> <span class="o">=</span> <span class="n">event</span>
</span><span id="1-1178">                <span class="k">with</span> <span class="n">capture_internal_exceptions</span><span class="p">():</span>
</span><span id="1-1179">                    <span class="n">new_event</span> <span class="o">=</span> <span class="n">event_processor</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hint</span><span class="p">)</span>
</span><span id="1-1180">                <span class="k">if</span> <span class="n">new_event</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1181">                    <span class="k">return</span> <span class="n">_drop</span><span class="p">(</span><span class="n">event_processor</span><span class="p">,</span> <span class="s2">&quot;event processor&quot;</span><span class="p">)</span>
</span><span id="1-1182">                <span class="n">event</span> <span class="o">=</span> <span class="n">new_event</span>
</span><span id="1-1183">
</span><span id="1-1184">        <span class="k">return</span> <span class="n">event</span></div>

</span><span id="1-1185">
<div class="viewcode-block" id="Scope.update_from_scope">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.update_from_scope">[docs]</a>
</span><span id="1-1186">    <span class="k">def</span> <span class="nf">update_from_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">):</span>
</span><span id="1-1187">        <span class="c1"># type: (Scope) -&gt; None</span>
</span><span id="1-1188"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the scope with another scope&#39;s data.&quot;&quot;&quot;</span>
</span><span id="1-1189">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1190">            <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">_level</span>
</span><span id="1-1191">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_fingerprint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1192">            <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">_fingerprint</span>
</span><span id="1-1193">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_transaction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1194">            <span class="bp">self</span><span class="o">.</span><span class="n">_transaction</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">_transaction</span>
</span><span id="1-1195">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_transaction_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1196">            <span class="bp">self</span><span class="o">.</span><span class="n">_transaction_info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">_transaction_info</span><span class="p">)</span>
</span><span id="1-1197">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1198">            <span class="bp">self</span><span class="o">.</span><span class="n">_user</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">_user</span>
</span><span id="1-1199">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_tags</span><span class="p">:</span>
</span><span id="1-1200">            <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">_tags</span><span class="p">)</span>
</span><span id="1-1201">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_contexts</span><span class="p">:</span>
</span><span id="1-1202">            <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">_contexts</span><span class="p">)</span>
</span><span id="1-1203">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_extras</span><span class="p">:</span>
</span><span id="1-1204">            <span class="bp">self</span><span class="o">.</span><span class="n">_extras</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">_extras</span><span class="p">)</span>
</span><span id="1-1205">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_breadcrumbs</span><span class="p">:</span>
</span><span id="1-1206">            <span class="bp">self</span><span class="o">.</span><span class="n">_breadcrumbs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">_breadcrumbs</span><span class="p">)</span>
</span><span id="1-1207">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_span</span><span class="p">:</span>
</span><span id="1-1208">            <span class="bp">self</span><span class="o">.</span><span class="n">_span</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">_span</span>
</span><span id="1-1209">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_attachments</span><span class="p">:</span>
</span><span id="1-1210">            <span class="bp">self</span><span class="o">.</span><span class="n">_attachments</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">_attachments</span><span class="p">)</span>
</span><span id="1-1211">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_profile</span><span class="p">:</span>
</span><span id="1-1212">            <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">_profile</span>
</span><span id="1-1213">        <span class="k">if</span> <span class="n">scope</span><span class="o">.</span><span class="n">_propagation_context</span><span class="p">:</span>
</span><span id="1-1214">            <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">_propagation_context</span></div>

</span><span id="1-1215">
<div class="viewcode-block" id="Scope.update_from_kwargs">
<a class="viewcode-back" href="../../apidocs.html#sentry_sdk.Scope.update_from_kwargs">[docs]</a>
</span><span id="1-1216">    <span class="k">def</span> <span class="nf">update_from_kwargs</span><span class="p">(</span>
</span><span id="1-1217">        <span class="bp">self</span><span class="p">,</span>
</span><span id="1-1218">        <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[Any]</span>
</span><span id="1-1219">        <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[LogLevelStr]</span>
</span><span id="1-1220">        <span class="n">extras</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[Dict[str, Any]]</span>
</span><span id="1-1221">        <span class="n">contexts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[Dict[str, Any]]</span>
</span><span id="1-1222">        <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[Dict[str, str]]</span>
</span><span id="1-1223">        <span class="n">fingerprint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Optional[List[str]]</span>
</span><span id="1-1224">    <span class="p">):</span>
</span><span id="1-1225">        <span class="c1"># type: (...) -&gt; None</span>
</span><span id="1-1226"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the scope&#39;s attributes.&quot;&quot;&quot;</span>
</span><span id="1-1227">        <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1228">            <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="n">level</span>
</span><span id="1-1229">        <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1230">            <span class="bp">self</span><span class="o">.</span><span class="n">_user</span> <span class="o">=</span> <span class="n">user</span>
</span><span id="1-1231">        <span class="k">if</span> <span class="n">extras</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1232">            <span class="bp">self</span><span class="o">.</span><span class="n">_extras</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">extras</span><span class="p">)</span>
</span><span id="1-1233">        <span class="k">if</span> <span class="n">contexts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1234">            <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">contexts</span><span class="p">)</span>
</span><span id="1-1235">        <span class="k">if</span> <span class="n">tags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1236">            <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
</span><span id="1-1237">        <span class="k">if</span> <span class="n">fingerprint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="1-1238">            <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span> <span class="o">=</span> <span class="n">fingerprint</span></div>

</span><span id="1-1239">
</span><span id="1-1240">    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-1241">        <span class="c1"># type: () -&gt; Scope</span>
</span><span id="1-1242">        <span class="n">rv</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>  <span class="c1"># type: Scope</span>
</span><span id="1-1243">
</span><span id="1-1244">        <span class="n">rv</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_level</span>
</span><span id="1-1245">        <span class="n">rv</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
</span><span id="1-1246">        <span class="n">rv</span><span class="o">.</span><span class="n">_fingerprint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span>
</span><span id="1-1247">        <span class="n">rv</span><span class="o">.</span><span class="n">_transaction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transaction</span>
</span><span id="1-1248">        <span class="n">rv</span><span class="o">.</span><span class="n">_transaction_info</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_transaction_info</span><span class="p">)</span>
</span><span id="1-1249">        <span class="n">rv</span><span class="o">.</span><span class="n">_user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user</span>
</span><span id="1-1250">
</span><span id="1-1251">        <span class="n">rv</span><span class="o">.</span><span class="n">_tags</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="p">)</span>
</span><span id="1-1252">        <span class="n">rv</span><span class="o">.</span><span class="n">_contexts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="p">)</span>
</span><span id="1-1253">        <span class="n">rv</span><span class="o">.</span><span class="n">_extras</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_extras</span><span class="p">)</span>
</span><span id="1-1254">
</span><span id="1-1255">        <span class="n">rv</span><span class="o">.</span><span class="n">_breadcrumbs</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_breadcrumbs</span><span class="p">)</span>
</span><span id="1-1256">        <span class="n">rv</span><span class="o">.</span><span class="n">_event_processors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_event_processors</span><span class="p">)</span>
</span><span id="1-1257">        <span class="n">rv</span><span class="o">.</span><span class="n">_error_processors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_error_processors</span><span class="p">)</span>
</span><span id="1-1258">        <span class="n">rv</span><span class="o">.</span><span class="n">_propagation_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_propagation_context</span>
</span><span id="1-1259">
</span><span id="1-1260">        <span class="n">rv</span><span class="o">.</span><span class="n">_should_capture</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_capture</span>
</span><span id="1-1261">        <span class="n">rv</span><span class="o">.</span><span class="n">_span</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span</span>
</span><span id="1-1262">        <span class="n">rv</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span>
</span><span id="1-1263">        <span class="n">rv</span><span class="o">.</span><span class="n">_force_auto_session_tracking</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_force_auto_session_tracking</span>
</span><span id="1-1264">        <span class="n">rv</span><span class="o">.</span><span class="n">_attachments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attachments</span><span class="p">)</span>
</span><span id="1-1265">
</span><span id="1-1266">        <span class="n">rv</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span>
</span><span id="1-1267">
</span><span id="1-1268">        <span class="k">return</span> <span class="n">rv</span>
</span><span id="1-1269">
</span><span id="1-1270">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="1-1271">        <span class="c1"># type: () -&gt; str</span>
</span><span id="1-1272">        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2"> id=</span><span class="si">%s</span><span class="s2"> name=</span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span>
</span><span id="1-1273">            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
</span><span id="1-1274">            <span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)),</span>
</span><span id="1-1275">            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span>
</span><span id="1-1276">        <span class="p">)</span></div>

</span></pre></div>
        </article>
        
        <div class="navigation flex print:hidden">
  
  
</div>
        
      </div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2019-2024, Sentry Team and Contributors</p>
        
        <p>
          Made with
          
          <a href="https://www.sphinx-doc.org/">Sphinx</a> and
          
          <a href="https://shibuya.lepture.com">Shibuya theme</a>.
        </p>
      </div>
      <div class="sy-foot-socials">
          <a href="https://github.com/getsentry/sentry-python" aria-label="GitHub"><i class="i-icon github"></i></a>
      </div>
    </div>
  </div>
</footer></div>
      <script src="../../_static/documentation_options.js?v=fca6d697"></script>
      <script src="../../_static/doctools.js?v=888ff710"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/shibuya.js?v=999236dc"></script>
    
</body>
</html>